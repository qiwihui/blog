<?xml version="1.0"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Qiwihui&apos;s blog</title><id></id><updated>2024-08-18T06:37:23+00:00</updated><entry><title>Verkle Trie ä» 0 åˆ° 1</title><id>blogs/qiwihui-blog-175.md</id><updated>2024-08-18T06:37:23+00:00</updated><author><name>qiwihui</name><email>qwh005007@gmail.com</email></author><link href="https://qiwihui.com/blogs/qiwihui-blog-175.html" rel="self"/><published>2024-08-18T06:37:23+00:00</published><content type="html">&lt;h1&gt;Verkle Trie ä» 0 åˆ° 1&lt;/h1&gt;
&lt;p&gt;video: &lt;a href="https://youtu.be/yfQ0CUU4zik"&gt;https://youtu.be/yfQ0CUU4zik&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;docs: &lt;a href="https://qiwihui.notion.site/Verkle-trie-8fa545dff5014191bfb6af2765b42e6e?pvs=4"&gt;https://qiwihui.notion.site/Verkle-trie-8fa545dff5014191bfb6af2765b42e6e?pvs=4&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;Problems&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;How to store multiple files remotely and know that those files havenâ€™t been changed?&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Given a starting ğ‘¥, compute ğ‘¥â†¦ğ‘¥^3+5, and repeat that 1 million times. How to prove to someone I computed this, and did so correctly - without he having to re-run the whole thing.&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-bash"&gt;Suppose our starting number is ğ‘¥=2.
- x^2 = 4
- x^3 = x^2 * x = 4 * 2 = 8
- X^3 + 5 = 13
So our trace is {2, 4, 8, 13, ...}
we will produce 3,000,001 numbers in computing the circuit.
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;â†’ How can we verify integrity of a vector of elements?&lt;/p&gt;
&lt;h2&gt;Solution 1: Single file hashing&lt;/h2&gt;
&lt;p&gt;For single file, we can use secure hash functions:&lt;/p&gt;
&lt;p&gt;&lt;img src="imgs/175/hash.png" alt="Untitled" /&gt;&lt;/p&gt;
&lt;p&gt;So a simple scheme for verifying file integrity: hash each file and save the store the hash locally.&lt;/p&gt;
&lt;p&gt;&lt;img src="imgs/175/hash_files.png" alt="Untitled" /&gt;&lt;/p&gt;
&lt;p&gt;Problem: has to store n hashes â†’ we need constant-sized digest&lt;/p&gt;
&lt;h2&gt;Solution 2: Merkle Trees&lt;/h2&gt;
&lt;p&gt;Merkle tree&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;the root is the digest, it is constant sized&lt;/p&gt;
&lt;p&gt;&lt;img src="imgs/175/merkle_tree.png" alt="Untitled" /&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;use merkle proof to verify if the files have been changed.&lt;/p&gt;
&lt;p&gt;&lt;img src="imgs/175/merkle_proof.png" alt="Untitled" /&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Performance&lt;/p&gt;
&lt;p&gt;&lt;img src="imgs/175/merkle_tree_perf.png" alt="Screenshot 2024-05-07 at 10.21.39.png" /&gt;&lt;/p&gt;
&lt;p&gt;Problem: Many small files â‡’ Merkle proofs too large&lt;/p&gt;
&lt;h2&gt;Solution 3: q-ary Merkle Trees&lt;/h2&gt;
&lt;p&gt;&lt;img src="imgs/175/q-ary_merkle_tree.png" alt="Screenshot 2024-05-07 at 11.20.51.png" /&gt;&lt;/p&gt;
&lt;p&gt;problem: Proof size is even bigger&lt;/p&gt;
&lt;p&gt;&lt;img src="imgs/175/problem_of_q-ary_merkle_tree.png" alt="Screenshot 2024-05-07 at 11.22.31.png" /&gt;&lt;/p&gt;
&lt;p&gt;proof size:  $qlog_q{n}$&lt;/p&gt;
&lt;h2&gt;Solution 4: polynomial commitment&lt;/h2&gt;
&lt;p&gt;&lt;img src="imgs/175/polynomial_commitment.png" alt="Screenshot 2024-05-07 at 11.41.06.png" /&gt;&lt;/p&gt;
&lt;h3&gt;What is polynomial commitments?&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;å°†é•¿åº¦ä¸º $n+1$ çš„ vector è½¬æ¢ä¸ºå¤šé¡¹å¼çš„ç‚¹å€¼ $(v_0, v_1, ..., v_n)$â†’$(0, v_0), (1, v_1), ...,(n, v_n)$&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å°†å”¯ä¸€å¯¹åº”çš„ $Degree=n$ çš„å¤šé¡¹å¼$f(x)$ ï¼Œç”Ÿæˆä¸ºCommitmentâ†’ æ‹‰æ ¼æœ—æ—¥æ’å€¼&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Lagrange Interpolation&lt;/p&gt;
&lt;h2&gt;Polynomial&lt;/h2&gt;
&lt;p&gt;$$
f(x) = \sum_{i = 0}^{n} a_i x^i=a_0 + a_1x + ...+a_nx^n
$$&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Degree $deg(f(x))=n$&lt;/li&gt;
&lt;li&gt;$a_n\neq0$&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Encoding data into Polynomial using Lagrange Interpolation&lt;/h2&gt;
&lt;p&gt;Given $(x_i, y_i), x_i \neq x_j, \forall i\neq j$, build a polynomial such that $f(x_i) = y_i$ and degree is $n-1$&lt;/p&gt;
&lt;p&gt;$$
f(x)=\sum_{i=0}^{n-1}y_i \prod_{j=0, j \neq i}^{n-1} \frac{x - x_j}{x_i - x_j}
$$&lt;/p&gt;
&lt;p&gt;$n = 2$&lt;/p&gt;
&lt;p&gt;$$
f(x)=y_0  \frac{x - x_1}{x_0 - x_1} + y_1 \frac{x - x_0}{x_1 - x_0}
$$&lt;/p&gt;
&lt;p&gt;$n = 3$&lt;/p&gt;
&lt;p&gt;$$
f(x)=y_0  \frac{(x - x_1)(x-x_2)}{(x_0 - x_1)(x_0-x_2)} + y_1 \frac{(x - x_0)(x-x_2)}{(x_1 - x_0)(x_1-x_2)} ...
$$&lt;/p&gt;
&lt;p&gt;Example&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Given (0, 3), (1, 6), we have&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;$$
f(x) = 3(x-1)/(0-1) + 6(x-0)/(1-0) = -3x+3+6=3x+3
$$&lt;/p&gt;
&lt;p&gt;(2, 9), (3, 12), (4, 15).  Suppose, given (1,6) and (3,12)&lt;/p&gt;
&lt;p&gt;$$
f(x)= 6(x-3)/(1-3)+12(x-1)/(3-1)=-3x+9+6x-6=3x+3
$$&lt;/p&gt;
&lt;p&gt;n encode to m (m &amp;gt; n), n-of-m data can recover the polynomial &lt;strong&gt;exactly&lt;/strong&gt;!&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Open å…¶ä¸­çš„ä¸€ä¸ªç‚¹ï¼Œæä¾›ä¸€ä¸ª Proof è¯æ˜ç‚¹å€¼$(k,v_k)$ç¬¦åˆå¤šé¡¹å¼$f(k)=v_k$&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src="https://inevitableeth.com/polynomial-commitments-3.jpeg" alt="https://inevitableeth.com/polynomial-commitments-3.jpeg" /&gt;&lt;/p&gt;
&lt;p&gt;STUART â†’ (1, 83), (2, 84), â€¦, (6, 84) â†’ f(x) â†’ choose (4.5, 69.5) as commitment&lt;/p&gt;
&lt;h3&gt;KZG polynomial commitment&lt;/h3&gt;
&lt;pre&gt;&lt;code class="language-jsx"&gt;Knowledge -&amp;gt; Point-Values -&amp;gt; Coefficients -&amp;gt; Commitment -&amp;gt; Open&amp;amp;Prove&amp;amp;Verify
                         FFT             MSM
                                          ^
                                          |
                                    Trusted Setup
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;FFT: Fast Furious Transform&lt;/p&gt;
&lt;p&gt;MSM: multi-scalar multiplication&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;KZG Commitment æ˜¯ Polynomial Commitment çš„ä¸€ç§ç®—æ³•å®ç°&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Elliptic curves + discrete logarithm problem&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Encoding Polynomial in a finite field $\mathbb{F}_q$,  q is prime:&lt;/p&gt;
&lt;p&gt;Polynomial on an elliptic curve $\mathbb{G}_1$&lt;/p&gt;
&lt;p&gt;$\mathbb{G}_1 = [0, G_1, G_1 + G_1 = [2] G_1, [3]G_1, ..., [q]G_1]$ where $[q+1] G_1 = 0$&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;$[n]G_1 =[n]_1$ can be computed very fast&lt;/li&gt;
&lt;li&gt;$[n] X = Y$, given $X$ and $Y$, it is very hard to find $n$ (it is called discrete logarithm algorithm)&lt;/li&gt;
&lt;li&gt;mod 7:
&lt;ul&gt;
&lt;li&gt;1 mod 7, 8 mod 7, 15 mod 7,â€¦.&lt;/li&gt;
&lt;li&gt;[n] mod 7 = 1 mod 7?&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;$$
[f(x)]G_1 = [\sum_{i=0}^{n}a_i x^i] G_1 = \sum_{i=0}^{n} [a_i] ([x^i] G_1) = \sum_{i=0}^{n} [a_i] [x^i]_1
$$&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Trusted setup&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="https://inevitableeth.com/pcs-trusted-setup-1.jpeg" alt="https://inevitableeth.com/pcs-trusted-setup-1.jpeg" /&gt;&lt;/p&gt;
&lt;p&gt;Now we have secret $s \in \mathbb{F}_q$ such that&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Nobody knows $s$ (private key of the â€œgodâ€)&lt;/li&gt;
&lt;li&gt;$[s^i] G_1 = [s^i]_1$, $i = 1, â€¦$ is known to everybody (â€godâ€â€™s public key)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Then, we have the commitment as&lt;/p&gt;
&lt;p&gt;$$
C = [f(s)]&lt;em&gt;1=\sum&lt;/em&gt;{i=0}^n [a_i] [s^i]_1
$$&lt;/p&gt;
&lt;p&gt;Finding another $g(x)$ such that $g(s) = f(s)$ is almost impossible&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Elliptic curves pairings&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Find two elliptic curves, such that&lt;/p&gt;
&lt;p&gt;&lt;img src="https://inevitableeth.com/elliptic-curve-pairings-1.jpeg" alt="https://inevitableeth.com/elliptic-curve-pairings-1.jpeg" /&gt;&lt;/p&gt;
&lt;p&gt;Given $x_i, y_i$, want to prove $f(x_i) = y_i$, &lt;/p&gt;
&lt;p&gt;$$
f(x) - y_i = g(x) = (x - x_i)q(x)
$$&lt;/p&gt;
&lt;p&gt;3x+3 given data points( 1, 6), (4,2)&lt;/p&gt;
&lt;p&gt;$3x+3 - 6 = 3x-3 = 3(x-1)= q(x)(x-1)$&lt;/p&gt;
&lt;p&gt;$$
\begin{aligned}[f(s) - y_i] G_1 &amp;amp;= [(s - x_i)q(s)] G_1 \ C - [y_i]_1 \end{aligned}
$$&lt;/p&gt;
&lt;p&gt;$e: \mathbb{G}_1 \times \mathbb{G}_2 \rightarrow \mathbb{G}_T$&lt;/p&gt;
&lt;p&gt;$$
e(C - [y_i] G_1, G_2) = e([q(s)]_1, [(s - x_i)]_2)
$$&lt;/p&gt;
&lt;p&gt;where $[q(s)]_1$ is the proof (48 bytes as a point on an elliptic curve)&lt;/p&gt;
&lt;p&gt;&lt;img src="imgs/175/kzg_proof_verification.png" alt="Screenshot 2024-05-07 at 13.51.25.png" /&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Polynomial Commitment çš„å…¶ä»–å®ç°&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;KZGï¼šPLONKã€Marlin&lt;/li&gt;
&lt;li&gt;FRIï¼šzkSTARK&lt;/li&gt;
&lt;li&gt;IPAï¼šBulletproof&lt;/li&gt;
&lt;li&gt;IPA + Halo-style aggregationï¼šHalo 2&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src="imgs/175/polynomial_commitment_perf.png" alt="https://vitalik.ca/general/2021/11/05/halo.html" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://vitalik.ca/general/2021/11/05/halo.html"&gt;https://vitalik.ca/general/2021/11/05/halo.html&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;KZG Commitmentçš„ä¼˜ç¼ºç‚¹&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç¼ºç‚¹ï¼šéœ€è¦Trusted Setup&lt;/li&gt;
&lt;li&gt;ä¼˜ç‚¹ï¼šproof é•¿åº¦çŸ­ä¸”æ’å®š&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;Solution 5: Verkle trie&lt;/h2&gt;
&lt;p&gt;Replace Hash Functions in q-ary Merkle tree with Vector commitment Schemes â†’ Verkle Trie&lt;/p&gt;
&lt;p&gt;&lt;img src="imgs/175/verkle_trie.png" alt="Screenshot 2024-05-07 at 13.08.29.png" /&gt;&lt;/p&gt;
&lt;p&gt;Performance comparison:&lt;/p&gt;
&lt;p&gt;&lt;img src="imgs/175/performance_comparison.png" alt="Untitled" /&gt;&lt;/p&gt;
&lt;p&gt;Verkle Trees let us trade off proof-size vs. construction time.&lt;/p&gt;
&lt;h2&gt;Verkle tree structure in Ethereum&lt;/h2&gt;
&lt;h3&gt;MPT(Merkle Patricia Trie) problem&lt;/h3&gt;
&lt;p&gt;Ethereum has a total of four trees:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;the World State Trie&lt;/li&gt;
&lt;li&gt;Receipts Trie&lt;/li&gt;
&lt;li&gt;Transaction Trie&lt;/li&gt;
&lt;li&gt;Account Storage Trie&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src="imgs/175/ethereum_tries.png" alt="Untitled" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="imgs/175/state_trie.png" alt="Untitled" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;MPT is 2-layer structure (Tree-inside-a-tree)&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Complexity&lt;/li&gt;
&lt;li&gt;Imbalance&lt;/li&gt;
&lt;li&gt;Difficulty in understanding interactions between mechanisms such as state expiration&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Vitalik has proposed aÂ &lt;strong&gt;single-layer structure&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src="imgs/175/single_layer_structure.png" alt="Untitled" /&gt;&lt;/p&gt;
&lt;p&gt;maps data to a 32-byte single key at all locations within the state:&lt;/p&gt;
&lt;p&gt;eg. &lt;code&gt;(address, storage_slot)&lt;/code&gt;,Â &lt;code&gt;(address, NONCE)&lt;/code&gt;,Â &lt;code&gt;(address, balance)&lt;/code&gt;,â€¦&lt;/p&gt;
&lt;p&gt;values sharing the first 31 bytes of the key are included in the same bottom-layer commitment.&lt;/p&gt;
&lt;p&gt;&lt;img src="imgs/175/values_sharing.png" alt="Untitled" /&gt;&lt;/p&gt;
&lt;h3&gt;Tree key&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;32 bytes&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;consisting of a 31-byte stem and a 1-byte suffix.Â The suffix allows for distinguishing the state information (account header data, code, storage) stored by the Tree Key.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;31-byte stem: pedersen_hash&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-jsx"&gt;def get_tree_key(address: Address32, tree_index: int, sub_index: int):
    # Asssumes VERKLE_NODE_WIDTH = 256
    return (
        pedersen_hash(address + tree_index.to_bytes(32, 'little'))[:31] +
        bytes([sub_index])
    )
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src="imgs/175/tree_key.png" alt="Untitled" /&gt;&lt;/p&gt;
&lt;p&gt;verkle tree structure:&lt;/p&gt;
&lt;p&gt;&lt;img src="imgs/175/verkle_tree_structure.png" alt="Untitled" /&gt;&lt;/p&gt;
&lt;h3&gt;&lt;strong&gt;Inner Node &amp;amp; Suffix Node(extension node)&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;&lt;em&gt;&lt;strong&gt;Suffix Node&lt;/strong&gt;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;suffix node structure:&lt;/p&gt;
&lt;p&gt;&lt;img src="imgs/175/suffix_node.png" alt="Untitled" /&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;1:&lt;/strong&gt;Â A marker for the suffix node, which is 1 on the elliptic curve but does not literally mean the number 1.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Stem:&lt;/strong&gt;Â The stem refers to the stem in the tree key.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;C1, C2:&lt;/strong&gt;Â Are Pedersen Commitments.&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class="language-jsx"&gt;C = Commit(1, C1, Stem, C2)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;C1 and C2 commitment take the data form:&lt;/p&gt;
&lt;p&gt;&lt;img src="imgs/175/C1_C2.png" alt="Untitled" /&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The reason for this division is that the creation of Pedersen Commitment is limited to committing up to 256 values of maximum 253-bit size, and for 256-bit values, data loss occurs.&lt;/li&gt;
&lt;li&gt;Process of storing 32-byte data under a tree key:
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Depending on the suffix, the data become v0, v1â€¦ v255&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;v0~v127 are included in C1, and v128~v255 are included in C2 to calculate the leaf nodeâ€™s commitment&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;For C1, each 32-byte value of v0~v127 is divided into the upper 16 bytes (v1,0) and the lower 16 bytes (v1, 1) to serve as coefficients in a polynomial. &lt;/p&gt;
&lt;p&gt;â†’ each coefficientâ€™s data being 16 bytes (128-bit)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;256-degree polynomial is committed:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;C1 = commit([(v0,0), (v0,1), (v1,0), (v1,1)â€¦(v127,0),(v127,1)])&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;C2 = commit([(v128,0), (v128,1), (v129,0), (v129,1) â€¦ (v255,0),(v255,1)])&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;C = Commit(1, C1, Stem, C2)&lt;/code&gt; â†’ commitment for the leaf node&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;em&gt;&lt;strong&gt;Inner Node&lt;/strong&gt;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="imgs/175/inner_node.png" alt="Untitled" /&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;holds the stem value of the tree key and stores 256 pointers to sub-nodes&lt;/li&gt;
&lt;li&gt;C0, C1 â€¦ C255 represent the commitments of sub-nodes, and the inner node contains these commitments.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;An example of verkle tree containing 4 tree keys:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;0x00..20&lt;/li&gt;
&lt;li&gt;0xdefeâ€¦64&lt;/li&gt;
&lt;li&gt;0xde03a8..02&lt;/li&gt;
&lt;li&gt;0xde03a8..ff&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src="imgs/175/verkle_trie_example.png" alt="Untitled" /&gt;&lt;/p&gt;
&lt;p&gt;Summary:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The Verkle Trie consists of two types of nodes: leaf nodes and inner nodes.&lt;/li&gt;
&lt;li&gt;A tree key contains a stem and a suffix.&lt;/li&gt;
&lt;li&gt;The same stem corresponds to the same leaf node.&lt;/li&gt;
&lt;li&gt;Data is stored differentiated by the suffix of the tree key.&lt;/li&gt;
&lt;li&gt;The tree key is encoded byte by byte along the path from the root to the leaf node.&lt;/li&gt;
&lt;li&gt;Data is included in the commitment of the leaf node.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href="https://github.com/qiwihui/blog/issues/175"&gt;View on GitHub&lt;/a&gt;&lt;/p&gt;
</content></entry><entry><title>Tornado Cash ä»£ç å®è·µç³»åˆ— | Tornado Cash in practice</title><id>blogs/qiwihui-blog-178.md</id><updated>2024-08-18T04:02:53+00:00</updated><author><name>qiwihui</name><email>qwh005007@gmail.com</email></author><link href="https://qiwihui.com/blogs/qiwihui-blog-178.html" rel="self"/><published>2024-08-18T04:02:53+00:00</published><content type="html">&lt;h1&gt;Tornado Cash ä»£ç å®è·µç³»åˆ— | Tornado Cash in practice&lt;/h1&gt;
&lt;p&gt;è¿™ä¸ªç³»åˆ—çš„è§†é¢‘å°†ä»é›¶åˆ°ä¸€å®ç° Tornado Cash çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬é›¶çŸ¥è¯†è¯æ˜ç”µè·¯ï¼Œæ™ºèƒ½åˆçº¦ä»¥åŠè¯æ˜éªŒè¯ã€‚å¸Œæœ›ä½ èƒ½ä»ä¸­å­¦ä¹ åˆ° Tornado Cash çš„æ‰€ç”¨åˆ°çš„æŠ€æœ¯ï¼Œå¹¶çŸ¥é“å¦‚ä½•æ„å»ºä¸€ä¸ªé›¶çŸ¥è¯†è¯æ˜åº”ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href="https://tornadoeth.cash/"&gt;Tornado Cash&lt;/a&gt;Â æ˜¯ä¸€ä¸ªä»¥å¤ªåŠä¸Šçš„æ··å¸å™¨ï¼Œé€šè¿‡ä½¿ç”¨é›¶çŸ¥è¯†è¯æ˜ï¼ˆZero Knowledge Proofï¼‰ï¼ŒTornado Cash å¯ä»¥æ‰“ç ´åŒºå—é“¾ä¸Šæºåœ°å€å’Œç›®æ ‡åœ°å€ä¹‹é—´çš„å…³è”ï¼Œè§£å†³éšç§æ³„éœ²çš„é—®é¢˜ã€‚Tornado Cash ä½¿ç”¨äº† Merkle æ ‘å’Œé›¶çŸ¥è¯†è¯æ˜ç”µè·¯ï¼Œå¹¶åœ¨æ™ºèƒ½åˆçº¦éªŒè¯é›¶çŸ¥è¯†è¯æ˜ã€‚&lt;/p&gt;
&lt;p&gt;ç³»åˆ—è§†é¢‘ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="https://www.youtube.com/watch?v=Cg1ydjxBz-E"&gt;Tornado Cash ä»£ç å®è·µï¼ˆ1ï¼‰: Tornado Cash ä»‹ç»&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.youtube.com/watch?v=y1y_N-9VQdM"&gt;Tornado Cash ä»£ç å®è·µï¼ˆ2ï¼‰ï¼šé›¶çŸ¥è¯†è¯æ˜ç”µè·¯&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.youtube.com/watch?v=22Cpina52YE"&gt;Tornado Cash ä»£ç å®è·µï¼ˆ3ï¼‰ï¼šå­˜æ¬¾å’Œå–æ¬¾åˆçº¦&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://youtu.be/CBjdLpT22hI"&gt;Tornado Cash ä»£ç å®è·µï¼ˆ4ï¼‰ï¼šé»˜å…‹å°”æ ‘&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://youtu.be/DPJ4ko_kvmk"&gt;Tornado Cash ä»£ç å®è·µï¼ˆ5ï¼‰ï¼šè¯æ˜ç”Ÿæˆå’ŒéªŒè¯&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://youtu.be/RKJ7C5jAtgY"&gt;Tornado Cash ä»£ç å®è·µï¼ˆ6ï¼‰ï¼šç”¨ chatGPT å¸®æˆ‘ç”Ÿæˆäº¤äº’é¡µé¢&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Tornado Cash ä»£ç å®è·µï¼ˆ7ï¼‰ï¼šæµ‹è¯•ç½‘éƒ¨ç½²ï¼ˆTODOï¼‰&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è§†é¢‘ä¸­çš„æ–‡æ¡£ï¼š https://qiwihui.notion.site/Tornado-cash-92055ce981ea46668aa72d836085fd35&lt;/p&gt;
&lt;p&gt;&lt;a href="https://github.com/qiwihui/blog/issues/178"&gt;View on GitHub&lt;/a&gt;&lt;/p&gt;
</content></entry><entry><title>å†™ä¸€ä¸ª pump.fun æ™ºèƒ½åˆçº¦ï¼Œåˆ›å»ºä»¥å¤ªåŠä¸Šçš„Memeå‘å”®å¹³å°</title><id>blogs/qiwihui-blog-177.md</id><updated>2024-08-18T04:02:53+00:00</updated><author><name>qiwihui</name><email>qwh005007@gmail.com</email></author><link href="https://qiwihui.com/blogs/qiwihui-blog-177.html" rel="self"/><published>2024-08-18T04:02:53+00:00</published><content type="html">&lt;h1&gt;å†™ä¸€ä¸ª pump.fun æ™ºèƒ½åˆçº¦ï¼Œåˆ›å»ºä»¥å¤ªåŠä¸Šçš„Memeå‘å”®å¹³å°&lt;/h1&gt;
&lt;p&gt;Pump.fun æ˜¯ Solana ä¸Šçš„ä»£å¸å‘å”®å¹³å°ã€‚åœ¨è¿™ä¸ªè§†é¢‘ä¸­æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª ETH ä¸Š Punp.fun çš„æ™ºèƒ½åˆçº¦ã€‚&lt;/p&gt;
&lt;p&gt;ä»£ç ä»“åº“ï¼š https://github.com/qiwihui/pumpeth&lt;/p&gt;
&lt;h2&gt;ç¬¬ä¸€éƒ¨åˆ†&lt;/h2&gt;
&lt;p&gt;è§†é¢‘é“¾æ¥ï¼š &lt;a href="https://youtu.be/k-LTUa9g1sU"&gt;https://youtu.be/k-LTUa9g1sU&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ä¸»è¦åŒ…å«å¦‚ä¸‹åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åˆ›å»ºä»£å¸&lt;/li&gt;
&lt;li&gt;è´­ä¹°ä»£å¸&lt;/li&gt;
&lt;li&gt;å–å‡ºä»£å¸&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;ç¬¬äºŒéƒ¨åˆ†&lt;/h2&gt;
&lt;p&gt;è§†é¢‘é“¾æ¥ï¼š &lt;a href="https://youtu.be/1zdCAg2d3nk"&gt;https://youtu.be/1zdCAg2d3nk&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ä¸»è¦åŒ…å«å¦‚ä¸‹åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ£€æŸ¥ token çŠ¶æ€&lt;/li&gt;
&lt;li&gt;Fork mainnet ç„¶åæµ‹è¯•&lt;/li&gt;
&lt;li&gt;minimal proxy æ¨¡å¼&lt;/li&gt;
&lt;li&gt;Bonding Curve æ›²çº¿&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;a href="https://github.com/qiwihui/blog/issues/177"&gt;View on GitHub&lt;/a&gt;&lt;/p&gt;
</content></entry><entry><title>Babylon åè®®è„šæœ¬æ¨¡æ‹Ÿ | Babylon script simulation</title><id>blogs/qiwihui-blog-176.md</id><updated>2024-08-18T04:02:53+00:00</updated><author><name>qiwihui</name><email>qwh005007@gmail.com</email></author><link href="https://qiwihui.com/blogs/qiwihui-blog-176.html" rel="self"/><published>2024-08-18T04:02:53+00:00</published><content type="html">&lt;h1&gt;Babylon åè®®è„šæœ¬æ¨¡æ‹Ÿ | Babylon script simulation&lt;/h1&gt;
&lt;p&gt;è§†é¢‘é“¾æ¥ï¼š &lt;a href="https://youtu.be/LoVpMH8-CiQ"&gt;https://youtu.be/LoVpMH8-CiQ&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Babylon æ˜¯ä¸€ä¸ªæ¯”ç‰¹å¸é“¾ä¸Šçš„è´¨æŠ¼åè®®ï¼Œå¯å®ç°åœ¨æ¯”ç‰¹å¸ä¸»ç½‘é”å®šæ¯”ç‰¹å¸æ¥ä¸ºå…¶ä»– PoS æ¶ˆè´¹é“¾æä¾›å®‰å…¨æ€§ï¼ŒåŒæ—¶åœ¨ Babylon ä¸»ç½‘æˆ– PoS æ¶ˆè´¹é“¾è·å¾—è´¨æŠ¼æ”¶ç›Šã€‚
ç”¨ Python è„šæœ¬æ¨¡æ‹Ÿäº† Babylon åè®®çš„è´¨æŠ¼ï¼Œtimelockï¼Œunbonding å’Œ slashing çš„è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;Jupyter notebook: https://github.com/qiwihui/taproot-workshop/blob/master/babylon.ipynb&lt;/p&gt;
&lt;p&gt;&lt;a href="https://github.com/qiwihui/blog/issues/176"&gt;View on GitHub&lt;/a&gt;&lt;/p&gt;
</content></entry><entry><title>Babylon è´¨æŠ¼åè®®</title><id>blogs/qiwihui-blog-174.md</id><updated>2024-08-18T03:45:14+00:00</updated><author><name>qiwihui</name><email>qwh005007@gmail.com</email></author><link href="https://qiwihui.com/blogs/qiwihui-blog-174.html" rel="self"/><published>2024-05-25T09:37:50+00:00</published><content type="html">&lt;h1&gt;Babylon è´¨æŠ¼åè®®&lt;/h1&gt;
&lt;p&gt;video: https://youtu.be/LoVpMH8-CiQ&lt;/p&gt;
&lt;p&gt;Babylon æ˜¯ä¸€ä¸ªæ¯”ç‰¹å¸é“¾ä¸Šçš„è´¨æŠ¼åè®®ï¼Œå¯å®ç°åœ¨æ¯”ç‰¹å¸ä¸»ç½‘é”å®šæ¯”ç‰¹å¸æ¥ä¸ºå…¶ä»– PoS æ¶ˆè´¹é“¾æä¾›å®‰å…¨æ€§ï¼ŒåŒæ—¶åœ¨ Babylon ä¸»ç½‘æˆ– PoS æ¶ˆè´¹é“¾è·å¾—è´¨æŠ¼æ”¶ç›Šã€‚è¿™ä¸ªè§†é¢‘ä¸»è¦åˆ†äº« Babylon è´¨æŠ¼åè®®çš„åŸç†ï¼ŒåŒ…æ‹¬æ¯”ç‰¹å¸æ—¶é—´æˆ³åè®®å’Œè´¨æŠ¼æµç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;åˆ†äº«æ–‡æ¡£é“¾æ¥ï¼š https://qiwihui.notion.site/Babylon-bitcoin-staking-protocol-b07554e575424f13b3ddf240bbbf2657&lt;/p&gt;
&lt;p&gt;&lt;a href="https://github.com/qiwihui/blog/issues/174"&gt;View on GitHub&lt;/a&gt;&lt;/p&gt;
</content></entry><entry><title>Bitcoin é“­æ–‡åŸç†</title><id>blogs/qiwihui-blog-173.md</id><updated>2024-08-18T03:45:14+00:00</updated><author><name>qiwihui</name><email>qwh005007@gmail.com</email></author><link href="https://qiwihui.com/blogs/qiwihui-blog-173.html" rel="self"/><published>2024-05-25T09:37:50+00:00</published><content type="html">&lt;h1&gt;Bitcoin é“­æ–‡åŸç†&lt;/h1&gt;
&lt;p&gt;video: https://youtu.be/ADaKhkkQa_E&lt;/p&gt;
&lt;p&gt;docs: https://qiwihui.notion.site/Bitcoin-08d37baeabce47fcb72f6195bb38a25c?pvs=4&lt;/p&gt;
&lt;p&gt;&lt;a href="https://github.com/qiwihui/blog/issues/173"&gt;View on GitHub&lt;/a&gt;&lt;/p&gt;
</content></entry><entry><title>Sui æ•°æ®ç±»å‹è®²è§£</title><id>blogs/qiwihui-blog-172.md</id><updated>2024-08-18T03:45:14+00:00</updated><author><name>qiwihui</name><email>qwh005007@gmail.com</email></author><link href="https://qiwihui.com/blogs/qiwihui-blog-172.html" rel="self"/><published>2024-05-25T09:37:50+00:00</published><content type="html">&lt;h1&gt;Sui æ•°æ®ç±»å‹è®²è§£&lt;/h1&gt;
&lt;p&gt;è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç» Sui ä¸­å¸¸è§çš„æ•°æ®ç»“æ„ï¼Œè¿™äº›ç»“æ„åŒ…å« Sui Move å’Œ Sui Framework ä¸­æä¾›çš„åŸºç¡€ç±»å‹å’Œæ•°æ®ç»“æ„ï¼Œç†è§£å’Œç†Ÿæ‚‰è¿™äº›æ•°æ®ç»“æ„å¯¹äº Sui Move çš„ç†è§£å’Œåº”ç”¨å¤§æœ‰è£¨ç›Šã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆå¿«é€Ÿå¤ä¹ ä¸€ä¸‹ Sui Move ä¸­ä½¿ç”¨åˆ°çš„åŸºç¡€ç±»å‹ã€‚&lt;/p&gt;
&lt;h3&gt;æ— ç¬¦å·æ•´å‹ï¼ˆIntegerï¼‰&lt;/h3&gt;
&lt;p&gt;Move åŒ…å«å…­ç§æ— ç¬¦å·æ•´å‹ï¼š&lt;code&gt;u8&lt;/code&gt;ï¼Œ&lt;code&gt;u16&lt;/code&gt; &lt;code&gt;u32&lt;/code&gt;ï¼Œ&lt;code&gt;u64&lt;/code&gt;ï¼Œ&lt;code&gt;u128&lt;/code&gt;å’Œ &lt;code&gt;u256&lt;/code&gt;ã€‚å€¼çš„èŒƒå›´ä» 0 åˆ° ä¸ç±»å‹å¤§å°ç›¸å…³çš„æœ€å¤§å€¼ã€‚&lt;/p&gt;
&lt;p&gt;è¿™äº›ç±»å‹çš„å­—é¢å€¼ä¸ºæ•°å­—åºåˆ—ï¼ˆä¾‹å¦‚ 112ï¼‰æˆ–åå…­è¿›åˆ¶æ–‡å­—ï¼Œä¾‹å¦‚ &lt;code&gt;0xFF&lt;/code&gt;ã€‚ å­—é¢å€¼çš„ç±»å‹å¯ä»¥é€‰æ‹©æ·»åŠ ä¸ºåç¼€ï¼Œä¾‹å¦‚ &lt;code&gt;112u8&lt;/code&gt;ã€‚ å¦‚æœæœªæŒ‡å®šç±»å‹ï¼Œç¼–è¯‘å™¨å°†å°è¯•ä»ä½¿ç”¨æ–‡å­—çš„ä¸Šä¸‹æ–‡ä¸­æ¨æ–­ç±»å‹ã€‚ å¦‚æœæ— æ³•æ¨æ–­ç±»å‹ï¼Œåˆ™å‡å®šä¸º &lt;code&gt;u64&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹æ— ç¬¦å·æ•´å‹æ”¯æŒçš„è¿ç®—åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç®—æ•°è¿ç®—ï¼š &lt;code&gt;+&lt;/code&gt; &lt;code&gt;-&lt;/code&gt;  &lt;code&gt;*&lt;/code&gt;  &lt;code&gt;%&lt;/code&gt; &lt;code&gt;/&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;ä½è¿ç®—ï¼š &lt;code&gt;&amp;amp;&lt;/code&gt; &lt;code&gt;|&lt;/code&gt; &lt;code&gt;^&lt;/code&gt;  &lt;code&gt;&amp;gt;&amp;gt;&lt;/code&gt; &lt;code&gt;&amp;lt;&amp;lt;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æ¯”è¾ƒè¿ç®—ï¼š &lt;code&gt;&amp;gt;&lt;/code&gt; &lt;code&gt;&amp;lt;&lt;/code&gt; &lt;code&gt;&amp;gt;=&lt;/code&gt; &lt;code&gt;&amp;lt;=&lt;/code&gt;  &lt;code&gt;==&lt;/code&gt; &lt;code&gt;!=&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;ç±»å‹è½¬æ¢ï¼š &lt;code&gt;as&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;æ³¨æ„ï¼Œç±»å‹è½¬æ¢ä¸ä¼šæˆªæ–­ï¼Œå› æ­¤å¦‚æœç»“æœå¯¹äºæŒ‡å®šç±»å‹è€Œè¨€å¤ªå¤§ï¼Œè½¬æ¢å°†ä¸­æ­¢ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç®€å•ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-rust"&gt;let a: u64 = 4;
let b = 2u64;
let hex_u64: u64 = 0xCAFE;

assert!(a+b==6, 0);
assert!(a-b==2, 0);
assert!(a*b==8, 0);
assert!(a/b==2, 0);

let complex_u8 = 1;
let _unused = 10 &amp;lt;&amp;lt; complex_u8;

(b as u128)
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;å¸ƒå°”ç±»å‹ï¼ˆBoolï¼‰&lt;/h3&gt;
&lt;p&gt;Move å¸ƒå°”å€¼åŒ…å«ä¸¤ç§ï¼Œ&lt;code&gt;true&lt;/code&gt; å’Œ &lt;code&gt;false&lt;/code&gt; ã€‚æ”¯æŒä¸ &lt;code&gt;&amp;amp;&amp;amp;&lt;/code&gt;ï¼Œæˆ–&lt;code&gt;||&lt;/code&gt;  å’Œé &lt;code&gt;!&lt;/code&gt; è¿ç®—ã€‚å¯ä»¥ç”¨äº Move çš„æ§åˆ¶æµå’Œ &lt;code&gt;assert!&lt;/code&gt; ä¸­ã€‚ &lt;code&gt;assert!&lt;/code&gt; æ˜¯ Move æä¾›çš„ç”¨äºæ–­è¨€ï¼Œå½“åˆ¤æ–­çš„å€¼æ˜¯ &lt;code&gt;false&lt;/code&gt; æ—¶ï¼Œç¨‹åºä¼šæŠ›å‡ºé”™è¯¯å¹¶åœæ­¢ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-rust"&gt;if (bool) { ... }
while (bool) { .. }
assert!(bool, u64)
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;åœ°å€ï¼ˆAddressï¼‰&lt;/h3&gt;
&lt;p&gt;address ä¹Ÿæ˜¯ Move çš„åŸç”Ÿç±»å‹ï¼Œå¯ä»¥åœ¨åœ°å€ä¸‹ä¿å­˜æ¨¡å—å’Œèµ„æºã€‚Sui ä¸­åœ°å€çš„é•¿åº¦ä¸º 20 å­—èŠ‚ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¡¨è¾¾å¼ä¸­ï¼Œåœ°å€éœ€è¦ä½¿ç”¨å‰ç¼€ &lt;code&gt;@&lt;/code&gt; ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-rust"&gt;let a1: address = @0xDEADBEEF; // shorthand for 0x00000000000000000000000000000000DEADBEEF
let a2: address = @0x0000000000000000000000000000000000000002;
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;Tuples å’Œ Unit&lt;/h3&gt;
&lt;p&gt;Tuples å’Œ Unit &lt;code&gt;()&lt;/code&gt; åœ¨ Move ä¸­ä¸»è¦ç”¨ä½œå‡½æ•°è¿”å›å€¼ã€‚åªæ”¯æŒè§£æ„ï¼ˆdestructuringï¼‰è¿ç®—ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-rust"&gt;module ds::tuples {
    // all 3 of these functions are equivalent
    fun returns_unit() {}
    fun returns_2_values(): (bool, bool) { (true, false) }
    fun returns_4_values(x: &amp;amp;u64): (&amp;amp;u64, u8, u128, vector&amp;lt;u8&amp;gt;) { (x, 0, 1, b&amp;quot;foobar&amp;quot;) }

    fun examples(cond: bool) {
        let () = ();
        let (x, y): (u8, u64) = (0, 1);
        let (a, b, c, d) = (@0x0, 0, false, b&amp;quot;&amp;quot;);

        () = ();
        (x, y) = if (cond) (1, 2) else (3, 4);
        (a, b, c, d) = (@0x1, 1, true, b&amp;quot;1&amp;quot;);
    }

    fun examples_with_function_calls() {
        let () = returns_unit();
        let (x, y): (bool, bool) = returns_2_values();
        let (a, b, c, d) = returns_4_values(&amp;amp;0);

        () = returns_unit();
        (x, y) = returns_2_values();
        (a, b, c, d) = returns_4_values(&amp;amp;1);
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä» Vector å¼€å§‹ï¼Œä»‹ç» Sui å’Œ Sui Framework ä¸­æ”¯æŒçš„é›†åˆç±»å‹ã€‚&lt;/p&gt;
&lt;h3&gt;æ•°ç»„ï¼ˆVectorï¼‰&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;vector&amp;lt;T&amp;gt;&lt;/code&gt; æ˜¯ Move æä¾›çš„å”¯ä¸€çš„åŸç”Ÿé›†åˆç±»å‹ã€‚&lt;code&gt;vector&amp;lt;T&amp;gt;&lt;/code&gt; æ˜¯ç”±ä¸€ç»„ç›¸åŒç±»å‹çš„å€¼ç»„æˆçš„æ•°ç»„ï¼Œæ¯”å¦‚ &lt;code&gt;vector&amp;lt;u64&amp;gt;&lt;/code&gt;ï¼Œ &lt;code&gt;vector&amp;lt;address&amp;gt;&lt;/code&gt; ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;vector&lt;/code&gt; æ”¯æŒçš„ä¸»è¦æ“ä½œæœ‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æœ«å°¾æ·»åŠ å…ƒç´ ï¼š&lt;code&gt;push_back&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æœ«å°¾åˆ é™¤å…ƒç´ ï¼š &lt;code&gt;pop_back&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;è¯»å–æˆ–è€…ä¿®æ”¹ï¼š &lt;code&gt;borrow&lt;/code&gt; ï¼Œ&lt;code&gt;borrow_mut&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;åˆ¤æ–­æ˜¯å¦åŒ…å«ï¼š &lt;code&gt;contains&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;äº¤æ¢å…ƒç´ ï¼š &lt;code&gt;swap&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;è¯»å–å…ƒç´ ç´¢å¼•ï¼š &lt;code&gt;index_of&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class="language-rust"&gt;module ds::vectors {
    use std::vector;

    public entry fun example() {
        let v = vector::empty&amp;lt;u64&amp;gt;();
        vector::push_back(&amp;amp;mut v, 5);
        vector::push_back(&amp;amp;mut v, 6);

        assert!(vector::contains(&amp;amp;mut v, &amp;amp;5), 42);
        
        let (exists, index) = vector::index_of(&amp;amp;mut v, &amp;amp;5);
        assert!(exists, 42);
        assert!(index == 0, 42);

        assert!(*vector::borrow(&amp;amp;v, 0) == 5, 42);
        assert!(*vector::borrow(&amp;amp;v, 1) == 6, 42);

        vector::swap(&amp;amp;mut v, 0, 1);

        assert!(vector::pop_back(&amp;amp;mut v) == 5, 42);
        assert!(vector::pop_back(&amp;amp;mut v) == 6, 42);
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç¼–è¯‘å¹¶è¿è¡Œç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-bash"&gt;# ç¼–è¯‘å¹¶å‘å¸ƒ
sui client publish . --gas-budget 300000

# è·å–ä¸Šä¸€æ­¥ç¼–è¯‘å¾—åˆ°çš„åŒ…çš„ID
export package_id=0xee2961ee26916285ebef57c68caaa5f67a3d8dbd

sui client call \
  --function example \
  --module vectors \
  --package ${package_id} \
  --gas-budget 30000
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä¸‹é¢æˆ‘ä»¬ä»‹ç»å‡ ç§åŸºäº &lt;code&gt;vector&lt;/code&gt;  çš„æ•°æ®ç±»å‹ã€‚&lt;/p&gt;
&lt;h3&gt;å­—ç¬¦ä¸²ï¼ˆStringï¼‰&lt;/h3&gt;
&lt;p&gt;Move æ²¡æœ‰å­—ç¬¦ä¸²çš„åŸç”Ÿç±»å‹ï¼Œä½†å®ƒä½¿ç”¨ &lt;code&gt;vector&amp;lt;u8&amp;gt;&lt;/code&gt; è¡¨ç¤ºå­—èŠ‚æ•°ç»„ã€‚ç›®å‰ï¼Œ &lt;code&gt;vector&amp;lt;u8&amp;gt;&lt;/code&gt; å­—é¢é‡æœ‰ä¸¤ç§ï¼šå­—èŠ‚å­—ç¬¦ä¸²ï¼ˆbyte stringsï¼‰å’Œåå…­è¿›åˆ¶å­—ç¬¦ä¸²ï¼ˆhex stringsï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;å­—èŠ‚å­—ç¬¦ä¸²æ˜¯ä»¥ &lt;code&gt;b&lt;/code&gt; ä¸ºå‰ç¼€çš„å­—ç¬¦ä¸²æ–‡å­—ï¼Œä¾‹å¦‚ &lt;code&gt;b&amp;quot;Hello!\n&amp;quot;&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;åå…­è¿›åˆ¶å­—ç¬¦ä¸²æ˜¯ä»¥ &lt;code&gt;x&lt;/code&gt; ä¸ºå‰ç¼€çš„å­—ç¬¦ä¸²æ–‡å­—ï¼Œä¾‹å¦‚ &lt;code&gt;x&amp;quot;48656C6C6F210A&amp;quot;&lt;/code&gt; ã€‚æ¯ä¸€å¯¹å­—èŠ‚çš„èŒƒå›´ä» &lt;code&gt;00&lt;/code&gt; åˆ° &lt;code&gt;FF&lt;/code&gt;ï¼Œè¡¨ç¤ºä¸€ä¸ªåå…­è¿›åˆ¶çš„ &lt;code&gt;u8&lt;/code&gt;ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼š &lt;code&gt;b&amp;quot;Hello&amp;quot; == x&amp;quot;48656C6C6F&amp;quot;&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ &lt;code&gt;vector&amp;lt;u8&amp;gt;&lt;/code&gt; çš„åŸºç¡€ä¸Šï¼ŒMove æä¾›äº† &lt;code&gt;string&lt;/code&gt; åŒ…å¤„ç† UTF8 å­—ç¬¦ä¸²çš„æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ä»¥åˆ›å»º Name NFT çš„ä¸ºä¾‹ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-rust"&gt;module ds::strings {
    use sui::object::{Self, UID};
    use sui::tx_context::{sender, TxContext};
    use sui::transfer;

    // ä½¿ç”¨ std::string ä½œä¸º UTF-8 å­—ç¬¦ä¸²
    use std::string::{Self, String};

    /// ä¿å­˜ String ç±»å‹
    struct Name has key, store {
        id: UID,

        /// String ç±»å‹
        name: String
    }

    fun create_name(
        name_bytes: vector&amp;lt;u8&amp;gt;, ctx: &amp;amp;mut TxContext
    ): Name {
        Name {
            id: object::new(ctx),
            name: string::utf8(name_bytes)
        }
    }

    /// ä¼ å…¥åŸå§‹å­—èŠ‚ï¼ˆraw bytesï¼‰æ¥åˆ›å»º
    public entry fun issue_name_nft(
        name_bytes: vector&amp;lt;u8&amp;gt;, ctx: &amp;amp;mut TxContext
    ) {
        transfer::transfer(
            create_name(name_bytes, ctx),
            sender(ctx)
        );
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç¼–è¯‘åå‘½ä»¤è¡Œä¸­è°ƒç”¨ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-bash"&gt;$ sui client call \
  --function issue_name_nft \
  --module strings \
  --package ${package_id} \
  --args &amp;quot;my_nft&amp;quot; --gas-budget 30000

# éƒ¨åˆ†è¾“å‡ºç»“æœ

----- Transaction Effects ----
Status : Success
Created Objects:
  - ID: 0xf53891c8d200125bcfdba69557b158395bdf9390 , Owner: Account Address ( 0xf28e73e59f2305edf4df88756f78fa1f5d7e78b0 )
Mutated Objects:
  - ID: 0xd1de857a7a5452a73c9c176cd7c9db1b06671723 , Owner: Account Address ( 0xf28e73e59f2305edf4df88756f78fa1f5d7e78b0 )
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¯ä»¥åœ¨ Transaction Effects ä¸­çœ‹åˆ°æ–°åˆ›å»ºçš„å¯¹è±¡ï¼ŒID ä¸º &lt;code&gt;0xf53891c8d200125bcfdba69557b158395bdf9390&lt;/code&gt;ï¼Œé€šè¿‡ Sui æä¾›çš„ RPC-API æ¥å£ &lt;code&gt;sui_getObject&lt;/code&gt; å¯ä»¥çœ‹åˆ°å…¶ä¸­ä¿å­˜çš„å†…å®¹ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-json"&gt;curl -H 'Content-Type: application/json' https://fullnode.devnet.sui.io:443 -d '{
  &amp;quot;jsonrpc&amp;quot;: &amp;quot;2.0&amp;quot;,
  &amp;quot;id&amp;quot;: 1,
  &amp;quot;method&amp;quot;: &amp;quot;sui_getObject&amp;quot;,
  &amp;quot;params&amp;quot;:[
      &amp;quot;0xf53891c8d200125bcfdba69557b158395bdf9390&amp;quot;
  ]
}'
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¾“å‡ºç»“æœ&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-json"&gt;{
    &amp;quot;jsonrpc&amp;quot;: &amp;quot;2.0&amp;quot;,
    &amp;quot;result&amp;quot;: {
        &amp;quot;status&amp;quot;: &amp;quot;Exists&amp;quot;,
        &amp;quot;details&amp;quot;: {
            &amp;quot;data&amp;quot;: {
                &amp;quot;dataType&amp;quot;: &amp;quot;moveObject&amp;quot;,
                &amp;quot;type&amp;quot;: &amp;quot;0xee2961ee26916285ebef57c68caaa5f67a3d8dbd::strings::Name&amp;quot;,
                &amp;quot;has_public_transfer&amp;quot;: true,
                &amp;quot;fields&amp;quot;: {
                    &amp;quot;id&amp;quot;: {
                        &amp;quot;id&amp;quot;: &amp;quot;0xf53891c8d200125bcfdba69557b158395bdf9390&amp;quot;
                    },
                    &amp;quot;name&amp;quot;: &amp;quot;my_nft&amp;quot;
                }
            },
            &amp;quot;owner&amp;quot;: {
                &amp;quot;AddressOwner&amp;quot;: &amp;quot;0xf28e73e59f2305edf4df88756f78fa1f5d7e78b0&amp;quot;
            },
            &amp;quot;previousTransaction&amp;quot;: &amp;quot;7AfcBmJCioSbdZD6ZdYU2iUuGiSc62AuhZn7Yi3TfLDa&amp;quot;,
            &amp;quot;storageRebate&amp;quot;: 13,
            &amp;quot;reference&amp;quot;: {
                &amp;quot;objectId&amp;quot;: &amp;quot;0xf53891c8d200125bcfdba69557b158395bdf9390&amp;quot;,
                &amp;quot;version&amp;quot;: 1614,
                &amp;quot;digest&amp;quot;: &amp;quot;/SEDlnh4xXq//ZGOCZVQM5QfyR2fPzJWaYWELhrSn2o=&amp;quot;
            }
        }
    },
    &amp;quot;id&amp;quot;: 1
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;VecMap å’Œ VecSet&lt;/h3&gt;
&lt;p&gt;Sui åœ¨ &lt;code&gt;vector&lt;/code&gt; çš„åŸºç¡€ä¸Šå®ç°äº†ä¸¤ç§æ•°æ®ç»“æ„ï¼Œæ˜ å°„ &lt;code&gt;vec_map&lt;/code&gt; å’Œé›†åˆ &lt;code&gt;vec_set&lt;/code&gt; ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;vec_map&lt;/code&gt; æ˜¯ä¸€ç§æ˜ å°„ç»“æ„ï¼Œä¿è¯ä¸åŒ…å«é‡å¤çš„é”®ï¼Œä½†æ˜¯æ¡ç›®æŒ‰ç…§æ’å…¥é¡ºåºæ’åˆ—ï¼Œè€Œä¸æ˜¯æŒ‰é”®çš„é¡ºåºã€‚æ‰€æœ‰çš„æ“ä½œæ—¶é—´å¤æ‚åº¦ä¸º &lt;code&gt;0(N)&lt;/code&gt;ï¼ŒN ä¸ºæ˜ å°„çš„å¤§å°ã€‚&lt;code&gt;vec_map&lt;/code&gt; åªæ˜¯ä¸ºäº†æä¾›æ–¹ä¾¿çš„æ“ä½œæ˜ å°„çš„æ¥å£ï¼Œå¦‚æœéœ€è¦ä¿å­˜å¤§å‹çš„æ˜ å°„ï¼Œæˆ–è€…æ˜¯éœ€è¦æŒ‰é”®çš„é¡ºåºæ’åºçš„æ˜ å°„éƒ½éœ€è¦å¦å¤–å¤„ç†ã€‚å¯ä»¥è€ƒè™‘ä½¿ç”¨ä¹‹åä»‹ç»çš„ &lt;code&gt;table&lt;/code&gt; æ•°æ®ç»“æ„ã€‚&lt;/p&gt;
&lt;p&gt;ä¸»è¦æ“ä½œåŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åˆ›å»ºç©ºæ˜ å°„: &lt;code&gt;empty&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æ’å…¥é”®å€¼å¯¹ï¼š &lt;code&gt;insert&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;è·å–é”®å¯¹åº”çš„å€¼ï¼š &lt;code&gt;get&lt;/code&gt;ï¼Œ &lt;code&gt;get_mut&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;åˆ é™¤é”®ï¼š &lt;code&gt;remove&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;åˆ¤æ–­æ˜¯å¦åŒ…å«é”®ï¼š &lt;code&gt;contains&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æ˜ å°„å¤§å°ï¼š &lt;code&gt;size&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;å°†æ˜ å°„è½¬ä¸ºé”®å€¼å¯¹çš„æ•°ç»„ï¼š &lt;code&gt;into_keys_values&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;è·å–æ˜ å°„é”®çš„æ•°ç»„ï¼š &lt;code&gt;keys&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;åˆ é™¤ç©ºæ˜ å°„ï¼š &lt;code&gt;destroy_empty&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;é€šè¿‡æ’å…¥çš„é¡ºåºç´¢å¼•é”®å€¼å¯¹ï¼š &lt;code&gt;get_entry_by_idx&lt;/code&gt;ï¼Œ&lt;code&gt;get_entry_by_idx_mut&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class="language-rust"&gt;module ds::v_map {
    use sui::vec_map;
    use std::vector;

    public entry fun example() {
        let m = vec_map::empty();
        let i = 0;
        while (i &amp;lt; 10) {
            let k = i + 2;
            let v = i + 5;
            vec_map::insert(&amp;amp;mut m, k, v);
            i = i + 1;
        };
        assert!(!vec_map::is_empty(&amp;amp;m), 0);
        assert!(vec_map::size(&amp;amp;m) == 10, 1);
        let i = 0;
        // make sure the elements are as expected in all of the getter APIs we expose
        while (i &amp;lt; 10) {
            let k = i + 2;
            assert!(vec_map::contains(&amp;amp;m, &amp;amp;k), 2);
            let v = *vec_map::get(&amp;amp;m, &amp;amp;k);
            assert!(v == i + 5, 3);
            assert!(vec_map::get_idx(&amp;amp;m, &amp;amp;k) == i, 4);
            let (other_k, other_v) = vec_map::get_entry_by_idx(&amp;amp;m, i);
            assert!(*other_k == k, 5);
            assert!(*other_v == v, 6);
            i = i + 1;
        };
        // ç§»å‡ºæ‰€æœ‰å…ƒç´ 
        let (keys, values) = vec_map::into_keys_values(copy m);
        let i = 0;
        while (i &amp;lt; 10) {
            let k = i + 2;
            let (other_k, v) = vec_map::remove(&amp;amp;mut m, &amp;amp;k);
            assert!(k == other_k, 7);
            assert!(v == i + 5, 8);
            assert!(*vector::borrow(&amp;amp;keys, i) == k, 9);
            assert!(*vector::borrow(&amp;amp;values, i) == v, 10);

            i = i + 1;
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;vec_set&lt;/code&gt; ç»“æ„ä¿è¯å…¶ä¸­ä¸åŒ…å«é‡å¤çš„é”®ã€‚æ‰€æœ‰çš„æ“ä½œæ—¶é—´å¤æ‚åº¦ä¸º &lt;code&gt;O(N)&lt;/code&gt;ï¼ŒN ä¸ºæ˜ å°„çš„å¤§å°ã€‚åŒæ ·ï¼Œ &lt;code&gt;vec_set&lt;/code&gt; æä¾›äº†æ–¹ä¾¿çš„é›†åˆæ“ä½œæ¥å£ï¼ŒæŒ‰æ’å…¥é¡ºåºè¿›è¡Œæ’åºï¼Œå¦‚æœéœ€è¦ä½¿ç”¨æŒ‰é”®è¿›è¡Œæ’åºçš„é›†åˆï¼Œä¹Ÿéœ€è¦å¦å¤–å¤„ç†ã€‚&lt;/p&gt;
&lt;p&gt;ä¸»è¦æ“ä½œåŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åˆ›å»ºç©ºé›†åˆ: &lt;code&gt;empty&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æ’å…¥å…ƒç´ ï¼š &lt;code&gt;insert&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;åˆ é™¤å…ƒç´ ï¼š &lt;code&gt;remove&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;åˆ¤æ–­æ˜¯å¦åŒ…å«å…ƒç´ ï¼š &lt;code&gt;contains&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;é›†åˆå¤§å°ï¼š &lt;code&gt;size&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;å°†é›†åˆè½¬ä¸ºå…ƒç´ çš„æ•°ç»„ï¼š &lt;code&gt;into_keys&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class="language-rust"&gt;module ds::v_set {
    use sui::vec_set;
    use std::vector;

    public entry fun example() {
        let m = vec_set::empty();
        let i = 0;
        while (i &amp;lt; 10) {
            let k = i + 2;
            vec_set::insert(&amp;amp;mut m, k);
            i = i + 1;
        };
        assert!(!vec_set::is_empty(&amp;amp;m), 0);
        assert!(vec_set::size(&amp;amp;m) == 10, 1);
        let i = 0;
        // make sure the elements are as expected in all of the getter APIs we expose
        while (i &amp;lt; 10) {
            let k = i + 2;
            assert!(vec_set::contains(&amp;amp;m, &amp;amp;k), 2);
            i = i + 1;
        };
        // ç§»å‡ºæ‰€æœ‰å…ƒç´ 
        let keys = vec_set::into_keys(copy m);
        let i = 0;
        while (i &amp;lt; 10) {
            let k = i + 2;
            vec_set::remove(&amp;amp;mut m, &amp;amp;k);
            assert!(*vector::borrow(&amp;amp;keys, i) == k, 9);
            i = i + 1;
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;ä¼˜å…ˆé˜Ÿåˆ—ï¼ˆPriorityQueueï¼‰&lt;/h3&gt;
&lt;p&gt;è¿˜æœ‰ä¸€ç§åŸºäº &lt;code&gt;vector&lt;/code&gt; æ„å»ºçš„æ•°æ®ç»“æ„ï¼šä¼˜å…ˆé˜Ÿåˆ—ï¼Œä»–ä½¿ç”¨åŸºäº &lt;code&gt;vector&lt;/code&gt; å®ç°çš„å¤§é¡¶å †ï¼ˆmax heapï¼‰æ¥å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;å¤§é¡¶å †æ˜¯ä¸€ç§äºŒå‰æ ‘ç»“æ„ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½å¤§äºæˆ–ç­‰äºå…¶å·¦å³å­©å­èŠ‚ç‚¹çš„å€¼ï¼Œè¿™æ ·ï¼Œè¿™ä¸ªäºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹å§‹ç»ˆéƒ½æ˜¯æ‰€æœ‰èŠ‚ç‚¹ä¸­å€¼æœ€å¤§çš„èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä¼˜å…ˆé˜Ÿåˆ—ä¸­ï¼Œæˆ‘ä»¬ä¸ºæ¯ä¸€ä¸ªèŠ‚ç‚¹èµ‹äºˆä¸€ä¸ªæƒé‡ï¼Œæˆ‘ä»¬åŸºäºæƒé‡æ„å»ºä¸€ä¸ªå¤§é¡¶å †ï¼Œä»å¤§é¡¶å †é¡¶éƒ¨å¼¹å‡ºæ ¹èŠ‚ç‚¹åˆ™ä¸ºæƒé‡æœ€å¤§çš„èŠ‚ç‚¹ã€‚è¿™æ ·å°±å½¢æˆè¿‡äº†ä¸€ä¸ªæŒ‰ä¼˜å…ˆçº§å¼¹å‡ºçš„é˜Ÿåˆ—ã€‚&lt;/p&gt;
&lt;p&gt;ä¼˜å…ˆé˜Ÿåˆ—ä¸»è¦åŒ…å«çš„æ“ä½œä¸ºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åˆ›å»ºæ¡ç›®åˆ—è¡¨ï¼š &lt;code&gt;create_entries&lt;/code&gt; ï¼Œç»“æœä½œä¸º &lt;code&gt;new&lt;/code&gt; æ–¹æ³•å‚æ•°&lt;/li&gt;
&lt;li&gt;åˆ›å»ºï¼š &lt;code&gt;new&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æ’å…¥ï¼š &lt;code&gt;insert&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;å¼¹å‡ºæœ€å¤§ï¼š &lt;code&gt;pop_max&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-rust"&gt;module ds::pq {
    use sui::priority_queue::{PriorityQueue, pop_max, create_entries, new, insert};

    /// æ£€æŸ¥å¼¹å‡ºçš„æœ€å¤§å€¼åŠå…¶æƒé‡
    fun check_pop_max(h: &amp;amp;mut PriorityQueue&amp;lt;u64&amp;gt;, expected_priority: u64, expected_value: u64) {
        let (priority, value) = pop_max(h);
        assert!(priority == expected_priority, 0);
        assert!(value == expected_value, 0);
    }

    public entry fun example() {
        let h = new(create_entries(vector[3, 1, 4, 2, 5, 2], vector[10, 20, 30, 40, 50, 60]));
        check_pop_max(&amp;amp;mut h, 5, 50);
        check_pop_max(&amp;amp;mut h, 4, 30);
        check_pop_max(&amp;amp;mut h, 3, 10);
        insert(&amp;amp;mut h, 7, 70);
        check_pop_max(&amp;amp;mut h, 7, 70);
        check_pop_max(&amp;amp;mut h, 2, 40);
        insert(&amp;amp;mut h, 0, 80);
        check_pop_max(&amp;amp;mut h, 2, 60);
        check_pop_max(&amp;amp;mut h, 1, 20);
        check_pop_max(&amp;amp;mut h, 0, 80);
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;ç»“æ„ä½“ï¼ˆStructï¼‰&lt;/h3&gt;
&lt;p&gt;Moveè¯­è¨€ä¸­ï¼Œç»“æ„ä½“æ˜¯åŒ…å«ç±»å‹åŒ–å­—æ®µçš„ç”¨æˆ·å®šä¹‰æ•°æ®ç»“æ„ã€‚ ç»“æ„å¯ä»¥å­˜å‚¨ä»»ä½•éå¼•ç”¨ç±»å‹ï¼ŒåŒ…æ‹¬å…¶ä»–ç»“æ„ã€‚ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-rust"&gt;module ds::structs {
    // äºŒç»´å¹³é¢ç‚¹
    struct Point has copy, drop, store {
        x: u64,
        y: u64,
    }
    // åœ†
    struct Circle has copy, drop, store {
        center: Point,
        radius: u64,
    }
    // åˆ›å»ºç»“æ„ä½“
    public fun new_point(x: u64, y: u64): Point {
        Point {
            x, y
        }
    }
    // è®¿é—®ç»“æ„ä½“æ•°æ®
    public fun point_x(p: &amp;amp;Point): u64 {
        p.x
    }

    public fun point_y(p: &amp;amp;Point): u64 {
        p.y
    }

    fun abs_sub(a: u64, b: u64): u64 {
        if (a &amp;lt; b) {
            b - a
        }
        else {
            a - b
        }
    }
    // è®¡ç®—ç‚¹ä¹‹é—´çš„è·ç¦»
    public fun dist_squared(p1: &amp;amp;Point, p2: &amp;amp;Point): u64 {
        let dx = abs_sub(p1.x, p2.x);
        let dy = abs_sub(p1.y, p2.y);
        dx * dx + dy * dy
    }

    public fun new_circle(center: Point, radius: u64): Circle {
        Circle { center, radius }
    }
    // è®¡ç®—ä¸¤ä¸ªåœ†ä¹‹é—´æ˜¯å¦ç›¸äº¤
    public fun overlaps(c1: &amp;amp;Circle, c2: &amp;amp;Circle): bool {
        let d = dist_squared(&amp;amp;c1.center, &amp;amp;c2.center);
        let r1 = c1.radius;
        let r2 = c2.radius;
        d * d &amp;lt;= r1 * r1 + 2 * r1 * r2 + r2 * r2
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;å¯¹è±¡ï¼ˆObjectï¼‰&lt;/h3&gt;
&lt;p&gt;å¯¹è±¡æ˜¯ Sui Move ä¸­æ–°å¼•å…¥çš„æ¦‚å¿µï¼Œä¹Ÿæ˜¯ Sui å®‰å…¨å’Œé«˜å¹¶å‘ç­‰ä¼—å¤šç‰¹æ€§çš„åŸºç¡€ã€‚å®šä¹‰ä¸€ä¸ªå¯¹è±¡ï¼Œéœ€è¦ä¸ºç»“æ„ä½“æ·»åŠ  &lt;code&gt;key&lt;/code&gt; èƒ½åŠ›ï¼ŒåŒæ—¶ç»“æ„ä½“çš„ç¬¬ä¸€ä¸ªå­—æ®µå¿…é¡»æ˜¯ &lt;code&gt;UID&lt;/code&gt; ç±»å‹çš„ idã€‚&lt;/p&gt;
&lt;p&gt;å¯¹è±¡ç»“æ„ä¸­é™¤äº†å¯ä»¥ä½¿ç”¨åŸºç¡€æ•°æ®ç»“æ„å¤–ï¼Œä¹Ÿå¯ä»¥åŒ…å«å¦ä¸€ä¸ªå¯¹è±¡ï¼Œå³å¯¹è±¡å¯ä»¥è¿›è¡ŒåŒ…è£…ï¼Œåœ¨ä¸€ä¸ªå¯¹è±¡ä¸­ä½¿ç”¨å¦ä¸€ä¸ªå¯¹è±¡ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹è±¡æœ‰ä¸åŒçš„æ‰€æœ‰æƒå½¢å¼ï¼Œå¯ä»¥å­˜æ”¾åœ¨ä¸€ä¸ªåœ°å€ä¸‹é¢ï¼Œä¹Ÿå¯ä»¥è®¾ç½®æˆä¸å¯å˜å¯¹è±¡æˆ–è€…å…¨å±€å¯¹è±¡ã€‚ä¸å¯å˜å¯¹è±¡æ°¸è¿œä¸èƒ½è¢«ä¿®æ”¹ï¼Œè½¬ç§»æˆ–è€…åˆ é™¤ï¼Œå› æ­¤å®ƒä¸å±äºä»»ä½•äººï¼Œä½†ä¹Ÿå¯ä»¥è¢«ä»»ä½•äººè®¿é—®ã€‚æ¯”å¦‚åˆçº¦åŒ…å¯¹è±¡ï¼ŒCoin Metadata å¯¹è±¡ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥é€šè¿‡ &lt;code&gt;transfer&lt;/code&gt; åŒ…ä¸­çš„æ–¹æ³•å¯¹å¯¹è±¡è¿›è¡Œå¤„ç†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;transfer&lt;/code&gt;ï¼šå°†å¯¹è±¡æ”¾åˆ°æŸä¸ªåœ°å€ä¸‹&lt;/li&gt;
&lt;li&gt;&lt;code&gt;freeze_object&lt;/code&gt;ï¼šåˆ›å»ºä¸å¯å˜å¯¹è±¡&lt;/li&gt;
&lt;li&gt;&lt;code&gt;share_object&lt;/code&gt;ï¼šåˆ›å»ºå…±äº«å¯¹è±¡&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class="language-rust"&gt;module ds::objects {
    use sui::object::{Self, UID};
    use sui::transfer;
    use sui::tx_context::{Self, TxContext};

    struct ColorObject has key {
        id: UID,
        red: u8,
        green: u8,
        blue: u8,
    }

    fun new(red: u8, green: u8, blue: u8, ctx: &amp;amp;mut TxContext): ColorObject {
        ColorObject {
            id: object::new(ctx),
            red,
            green,
            blue,
        }
    }

    public entry fun create(red: u8, green: u8, blue: u8, ctx: &amp;amp;mut TxContext) {
        let color_object = new(red, green, blue, ctx);
        transfer::transfer(color_object, tx_context::sender(ctx))
    }

    public fun get_color(self: &amp;amp;ColorObject): (u8, u8, u8) {
        (self.red, self.green, self.blue)
    }

    /// Copies the values of `from_object` into `into_object`.
    public entry fun copy_into(from_object: &amp;amp;ColorObject, into_object: &amp;amp;mut ColorObject) {
        into_object.red = from_object.red;
        into_object.green = from_object.green;
        into_object.blue = from_object.blue;
    }

    public entry fun delete(object: ColorObject) {
        let ColorObject { id, red: _, green: _, blue: _ } = object;
        object::delete(id);
    }

    public entry fun transfer(object: ColorObject, recipient: address) {
        transfer::transfer(object, recipient)
    }

    public entry fun freeze_object(object: ColorObject) {
        transfer::freeze_object(object)
    }

    public entry fun create_shareable(red: u8, green: u8, blue: u8, ctx: &amp;amp;mut TxContext) {
        let color_object = new(red, green, blue, ctx);
        transfer::share_object(color_object)
    }

    public entry fun create_immutable(red: u8, green: u8, blue: u8, ctx: &amp;amp;mut TxContext) {
        let color_object = new(red, green, blue, ctx);
        transfer::freeze_object(color_object)
    }

    public entry fun update(
        object: &amp;amp;mut ColorObject,
        red: u8, green: u8, blue: u8,
    ) {
        object.red = red;
        object.green = green;
        object.blue = blue;
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç¼–è¯‘åè°ƒç”¨ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åˆ›å»ºå…±äº«å¯¹è±¡&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class="language-bash"&gt;sui client call \
  --function create_shareable \
  --module objects \
  --package ${package_id} \
  --args 1 2 3 --gas-budget 30000

# ç»“æœè¾“å‡º
----- Transaction Effects ----
Status : Success
Created Objects:
  - ID: 0x3b25eba3bf836088b56bdfd36e39ec440db8bf59 , Owner: Shared
&lt;/code&gt;&lt;/pre&gt;
&lt;ol&gt;
&lt;li&gt;åˆ›å»ºä¸å¯å˜å¯¹è±¡&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class="language-bash"&gt;sui client call \
  --function create_immutable \
  --module objects \
  --package ${package_id} \
  --args 1 2 3 --gas-budget 30000

# ç»“æœè¾“å‡º
----- Transaction Effects ----
Status : Success
Created Objects:
  - ID: 0x88f8f210635af6503a8a07835ef12e147fa60aa3 , Owner: Immutable
&lt;/code&gt;&lt;/pre&gt;
&lt;ol&gt;
&lt;li&gt;å°†å¯¹è±¡æ”¾å…¥æŸä¸ªåœ°å€ä¸‹&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class="language-bash"&gt;sui client call \
  --function create \
  --module objects \
  --package ${package_id} \
  --args 1 2 3 --gas-budget 30000

# ç»“æœè¾“å‡º
----- Transaction Effects ----
Status : Success
Created Objects:
  - ID: 0xf36144c71cde87c1e00f1bf00ee44653bc05228c , Owner: Account Address ( 0xf28e73e59f2305edf4df88756f78fa1f5d7e78b0 )
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼Œä¸åŒæ‰€æœ‰æƒç±»å‹çš„å¯¹è±¡ä¼šåœ¨åˆ›å»ºæ—¶æ˜¾ç¤ºä¸åŒçš„ç±»å‹ç»“æœã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¿®æ”¹å…±äº«å¯¹è±¡æˆ–è€…æ˜¯åœ°å€æ‰€æ‹¥æœ‰çš„å¯¹è±¡ï¼šä¼ å…¥å¯¹è±¡ ID ä½œä¸ºå‚æ•°&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class="language-bash"&gt;sui client call \
  --function update \
  --module objects \
  --package ${package_id} \
  --args 0x3b25eba3bf836088b56bdfd36e39ec440db8bf59 4 5 6 --gas-budget 30000

# ç»“æœè¾“å‡º
----- Transaction Effects ----
Status : Success
Mutated Objects:
  - ID: 0x3b25eba3bf836088b56bdfd36e39ec440db8bf59 , Owner: Shared
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¯ä»¥åœ¨ç»“æœä¸­çœ‹åˆ° &lt;code&gt;Mutated Objects&lt;/code&gt; ä¸­å¯¹è±¡å·²ç»å‘ç”Ÿäº†å˜åŒ–ã€‚&lt;/p&gt;
&lt;h3&gt;Dynamic field å’Œ Dynamic object field&lt;/h3&gt;
&lt;p&gt;å¯¹è±¡è™½ç„¶å¯ä»¥è¿›è¡ŒåŒ…è£…ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¸€äº›å±€é™ï¼Œä¸€æ˜¯å¯¹è±¡ä¸­çš„å­—æ®µæ˜¯æœ‰é™çš„ï¼Œåœ¨ç»“æ„ä½“å®šä¹‰æ˜¯å·²ç»ç¡®å®šï¼›äºŒæ˜¯åŒ…å«å…¶ä»–å¯¹è±¡çš„å¯¹è±¡å¯èƒ½éå¸¸å¤§ï¼Œå¯èƒ½ä¼šå¯¼è‡´äº¤æ˜“ gas å¾ˆé«˜ï¼ŒSui é»˜è®¤ç»“æ„ä½“å¤§å°é™åˆ¶ä¸º 2MBï¼›å†è€…ï¼Œå½“é‡åˆ°è¦å‚¨å­˜ä¸ä¸€æ ·ç±»å‹çš„å¯¹è±¡é›†åˆæ—¶ï¼Œé—®é¢˜å°±ä¼šæ¯”è¾ƒæ£˜æ‰‹ï¼ŒMove ä¸­çš„ &lt;code&gt;vector&lt;/code&gt; åªèƒ½å­˜å‚¨ç›¸åŒçš„ç±»å‹çš„æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤ï¼ŒSui æä¾›äº† dynamic fieldï¼Œå¯ä»¥ä½¿ç”¨ä»»æ„åå­—åšå­—æ®µï¼Œä¹Ÿå¯ä»¥åŠ¨æ€æ·»åŠ å’Œåˆ é™¤ã€‚å”¯ä¸€å½±å“çš„æ˜¯ gas çš„æ¶ˆè€—ã€‚&lt;/p&gt;
&lt;p&gt;dynamic field åŒ…å«ä¸¤ç§ç±»å‹ï¼Œfield å’Œ Object fieldï¼ŒåŒºåˆ«åœ¨äºï¼Œfield å¯ä»¥å­˜å‚¨ä»»ä½•æœ‰ &lt;code&gt;store&lt;/code&gt; èƒ½åŠ›çš„å€¼ï¼Œä½†æ˜¯å¦‚æœæ˜¯å¯¹è±¡çš„è¯ï¼Œå¯¹è±¡ä¼šè¢«è®¤ä¸ºæ˜¯è¢«åŒ…è£…è€Œä¸èƒ½é€šè¿‡ ID è¢«å¤–éƒ¨å·¥å…·ï¼ˆæµè§ˆå™¨ï¼Œé’±åŒ…ç­‰ï¼‰è®¿é—®ï¼›è€Œ Object field çš„å€¼å¿…é¡»æ˜¯å¯¹è±¡ï¼ˆæœ‰ &lt;code&gt;key&lt;/code&gt; èƒ½åŠ›ä¸”ç¬¬ä¸€ä¸ªå­—æ®µæ˜¯ &lt;code&gt;id: UID&lt;/code&gt;ï¼‰ï¼Œå¯¹è±¡ä»ç„¶èƒ½ä»å¤–éƒ¨å·¥å…·é€šè¿‡ ID è®¿é—®ã€‚&lt;/p&gt;
&lt;p&gt;dynamic filed çš„åç§°å¯ä»¥æ˜¯ä»»ä½•æ‹¥æœ‰ &lt;code&gt;copy&lt;/code&gt;ï¼Œ&lt;code&gt;drop&lt;/code&gt; å’Œ &lt;code&gt;store&lt;/code&gt; èƒ½åŠ›çš„å€¼ï¼Œè¿™äº›å€¼åŒ…æ‹¬ Move ä¸­çš„åŸºæœ¬ç±»å‹ï¼ˆæ•´æ•°ï¼Œå¸ƒå°”å€¼ï¼Œå­—èŠ‚ä¸²ï¼‰ï¼Œä»¥åŠæ‹¥æœ‰ &lt;code&gt;copy&lt;/code&gt;ï¼Œ&lt;code&gt;drop&lt;/code&gt; å’Œ &lt;code&gt;store&lt;/code&gt; èƒ½åŠ›çš„ç»“æ„ä½“ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä¾‹å­æ¥çœ‹çœ‹å…·ä½“çš„æ“ä½œï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ·»åŠ å­—æ®µï¼š &lt;code&gt;add&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;è®¿é—®å’Œä¿®æ”¹å­—æ®µï¼š &lt;code&gt;borrow&lt;/code&gt;ï¼Œ &lt;code&gt;borow_mut&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;åˆ é™¤å­—æ®µ&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class="language-rust"&gt;module ds::fields {
    use sui::object::{Self, UID};
    use sui::dynamic_object_field as dof;
    use sui::transfer;
    use sui::tx_context::{Self, TxContext};

    struct Parent has key {
        id: UID,
    }

    struct Child has key, store {
        id: UID,
        count: u64,
    }

    public entry fun initialize(ctx: &amp;amp;mut TxContext) {
        transfer::transfer(Parent { id: object::new(ctx) }, tx_context::sender(ctx));
        transfer::transfer(Child { id: object::new(ctx), count: 0 }, tx_context::sender(ctx));
    }

    public entry fun add_child(parent: &amp;amp;mut Parent, child: Child) {
        dof::add(&amp;amp;mut parent.id, b&amp;quot;child&amp;quot;, child);
    }

    public entry fun mutate_child(child: &amp;amp;mut Child) {
        child.count = child.count + 1;
    }

    public entry fun mutate_child_via_parent(parent: &amp;amp;mut Parent) {
        mutate_child(dof::borrow_mut&amp;lt;vector&amp;lt;u8&amp;gt;, Child&amp;gt;(
            &amp;amp;mut parent.id,
            b&amp;quot;child&amp;quot;,
        ));
    }

    public entry fun delete_child(parent: &amp;amp;mut Parent) {
        let Child { id, count: _ } = dof::remove&amp;lt;vector&amp;lt;u8&amp;gt;, Child&amp;gt;(
            &amp;amp;mut parent.id,
            b&amp;quot;child&amp;quot;,
        );
        object::delete(id);
    }

    public entry fun reclaim_child(parent: &amp;amp;mut Parent, ctx: &amp;amp;mut TxContext) {
        let child = dof::remove&amp;lt;vector&amp;lt;u8&amp;gt;, Child&amp;gt;(
            &amp;amp;mut parent.id,
            b&amp;quot;child&amp;quot;,
        );
        transfer::transfer(child, tx_context::sender(ctx));
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç¼–è¯‘å¹¶è°ƒç”¨ &lt;code&gt;initialize&lt;/code&gt; å’Œ &lt;code&gt;add_child&lt;/code&gt; æ–¹æ³•ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-bash"&gt;sui client call \
  --function initialize \
  --module fields \
  --package ${package_id} \
  --gas-budget 30000

# è¾“å‡ºç»“æœ
----- Transaction Effects ----
Status : Success
Created Objects:
  - ID: 0x55536ca8123ffb606398da9f7d2472888ca5bfd1 , Owner: Account Address ( 0xf28e73e59f2305edf4df88756f78fa1f5d7e78b0 )
  - ID: 0xf1206f0f7d97908aae907c23d69a4cd97120dc82 , Owner: Account Address ( 0xf28e73e59f2305edf4df88756f78fa1f5d7e78b0 )
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class="language-bash"&gt;sui client call \
  --function add_child \
  --module fields \
  --package ${package_id} \
  --args 0xf1206f0f7d97908aae907c23d69a4cd97120dc82 0x55536ca8123ffb606398da9f7d2472888ca5bfd1 --gas-budget 30000

# è¾“å‡ºç»“æœ
----- Transaction Effects ----
Status : Success
Created Objects:
  - ID: 0xdf694f282f739f328325bc922b3083bd45f31cae , Owner: Object ID: ( 0xf1206f0f7d97908aae907c23d69a4cd97120dc82 )
Mutated Objects:
  - ID: 0x55536ca8123ffb606398da9f7d2472888ca5bfd1 , Owner: Object ID: ( 0xdf694f282f739f328325bc922b3083bd45f31cae )
  - ID: 0xf1206f0f7d97908aae907c23d69a4cd97120dc82 , Owner: Account Address ( 0xf28e73e59f2305edf4df88756f78fa1f5d7e78b0 )
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¯ä»¥é€šè¿‡ &lt;code&gt;sui_getDynamicFields&lt;/code&gt; æ–¹æ³•æŸ¥çœ‹æ·»åŠ çš„å­—æ®µï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-bash"&gt;curl -H 'Content-Type: application/json' https://fullnode.devnet.sui.io:443 -d '{
  &amp;quot;jsonrpc&amp;quot;: &amp;quot;2.0&amp;quot;,
  &amp;quot;id&amp;quot;: 1,
  &amp;quot;method&amp;quot;: &amp;quot;sui_getDynamicFields&amp;quot;,
  &amp;quot;params&amp;quot;:[
      &amp;quot;0xf1206f0f7d97908aae907c23d69a4cd97120dc82&amp;quot;
  ]
}'
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç»“æœï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-json"&gt;{
    &amp;quot;jsonrpc&amp;quot;: &amp;quot;2.0&amp;quot;,
    &amp;quot;result&amp;quot;: {
        &amp;quot;data&amp;quot;: [
            {
                &amp;quot;name&amp;quot;: &amp;quot;vector[99u8, 104u8, 105u8, 108u8, 100u8]&amp;quot;,
                &amp;quot;type&amp;quot;: &amp;quot;DynamicObject&amp;quot;,
                &amp;quot;objectType&amp;quot;: &amp;quot;0xee2961ee26916285ebef57c68caaa5f67a3d8dbd::fields::Child&amp;quot;,
                &amp;quot;objectId&amp;quot;: &amp;quot;0x55536ca8123ffb606398da9f7d2472888ca5bfd1&amp;quot;,
                &amp;quot;version&amp;quot;: 1621,
                &amp;quot;digest&amp;quot;: &amp;quot;GNSaPghN+tRBkxKiVhQCn9jVBkjYV4RU4oF+c4CUGJM=&amp;quot;
            }
        ],
        &amp;quot;nextCursor&amp;quot;: null
    },
    &amp;quot;id&amp;quot;: 1
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å…¶ä¸­ &lt;code&gt;name&lt;/code&gt; ä¸º &lt;code&gt;â€œchildâ€&lt;/code&gt; ã€‚åŒæ—¶ï¼Œå¯¹äºå¯¹è±¡ ID &lt;code&gt;0x55536ca8123ffb606398da9f7d2472888ca5bfd1&lt;/code&gt;ï¼Œæˆ‘ä»¬ä»ç„¶èƒ½ä»é“¾ä¸Šè¿½è¸ªå¯¹åº”ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-bash"&gt;curl -H 'Content-Type: application/json' https://fullnode.devnet.sui.io:443 -d '{
  &amp;quot;jsonrpc&amp;quot;: &amp;quot;2.0&amp;quot;,
  &amp;quot;id&amp;quot;: 1,
  &amp;quot;method&amp;quot;: &amp;quot;sui_getObject&amp;quot;,
  &amp;quot;params&amp;quot;:[
      &amp;quot;0x55536ca8123ffb606398da9f7d2472888ca5bfd1&amp;quot;
  ]
}'
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;é›†åˆæ•°æ®ç±»å‹&lt;/h3&gt;
&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä»‹ç»å‡ ç§åŸºäº dynamic field çš„é›†åˆæ•°æ®ç±»å‹ã€‚&lt;/p&gt;
&lt;p&gt;å‰é¢ä»‹ç»è¿‡ï¼Œå¸¦æœ‰ dynamic field çš„å¯¹è±¡å¯ä»¥è¢«åˆ é™¤ï¼Œä½†æ˜¯è¿™å¯¹äºé“¾ä¸Šé›†åˆç±»å‹æ¥è¯´è¿™æ˜¯ä¸å¸Œæœ›å‘ç”Ÿçš„ï¼Œå› ä¸ºé“¾ä¸Šé›†åˆç±»å‹å¯èƒ½å°†æ— é™å¤šçš„é”®å€¼å¯¹ä½œä¸º dynamic field ä¿å­˜ã€‚å› æ­¤ï¼Œåœ¨ Sui æä¾›äº†ä¸¤ç§é›†åˆç±»å‹ï¼š &lt;code&gt;Table&lt;/code&gt; å’Œ &lt;code&gt;Bag&lt;/code&gt;ï¼Œä¸¤è€…éƒ½åŸºäº dynamic field æ„å»ºçš„æ˜ å°„ç±»å‹çš„æ•°æ®ç»“æ„ï¼Œä½†æ˜¯é¢å¤–æ”¯æŒè®¡ç®—å®ƒä»¬åŒ…å«çš„æ¡ç›®æ•°ï¼Œå¹¶é˜²æ­¢åœ¨éç©ºæ—¶æ„å¤–åˆ é™¤ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Table&lt;/code&gt; å’Œ &lt;code&gt;Bag&lt;/code&gt; çš„åŒºåˆ«åœ¨äºï¼ŒTable æ˜¯åŒè´¨ï¼ˆ*homogeneousï¼‰*æ˜ å°„ï¼Œæ‰€ä»¥çš„é”®å¿…é¡»æ˜¯åŒä¸€ä¸ªç±»å‹ï¼Œæ‰€ä»¥çš„å€¼ä¹Ÿå¿…é¡»æ˜¯åŒä¸€ä¸ªç±»å‹ï¼Œè€Œ Bag æ˜¯å¼‚è´¨ï¼ˆ&lt;em&gt;heterogeneous&lt;/em&gt;ï¼‰æ˜ å°„ï¼Œå¯ä»¥å­˜å‚¨ä»»æ„ç±»å‹çš„é”®å€¼å¯¹ã€‚&lt;/p&gt;
&lt;p&gt;åŒæ—¶ï¼ŒSui æ ‡å‡†åº“ä¸­è¿˜åŒ…å«å¯¹è±¡ç‰ˆæœ¬çš„ &lt;code&gt;Table&lt;/code&gt; å’Œ &lt;code&gt;Bag&lt;/code&gt;ï¼š &lt;code&gt;ObjectTable&lt;/code&gt; å’Œ &lt;code&gt;ObjectBag&lt;/code&gt;ï¼ŒåŒºåˆ«åœ¨äºå‰è€…å¯ä»¥å°†ä»»ä½• &lt;code&gt;store&lt;/code&gt; èƒ½åŠ›çš„å€¼ä¿å­˜ï¼Œä½†ä»å¤–éƒ¨å­˜å‚¨æŸ¥çœ‹æ—¶ï¼Œä½œä¸ºå€¼å­˜å‚¨çš„å¯¹è±¡å°†è¢«éšè—ï¼Œåè€…åªèƒ½å°†å¯¹è±¡ä½œä¸ºå€¼å­˜å‚¨ï¼Œä½†å¯ä»¥ä»å¤–éƒ¨å­˜å‚¨ä¸­é€šè¿‡ ID è®¿é—®è¿™äº›å¯¹è±¡ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ä¹‹å‰ä»‹ç»è¿‡çš„ &lt;code&gt;vec_map&lt;/code&gt; ç›¸æ¯”ï¼Œ&lt;code&gt;table&lt;/code&gt; æ›´é€‚åˆç”¨æ¥å¤„ç†åŒ…å«å¤§é‡æ˜ å°„çš„æƒ…å†µã€‚&lt;/p&gt;
&lt;h3&gt;Table&lt;/h3&gt;
&lt;p&gt;ä¸‹é¢æˆ‘ä»¬é€šè¿‡ç¤ºä¾‹æ¥å±•ç¤ºå¯¹ table çš„åŸºæœ¬æ“ä½œï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ·»åŠ å…ƒç´ ï¼š &lt;code&gt;add&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;è¯»å–å’Œä¿®æ”¹å…ƒç´ ï¼š &lt;code&gt;borrow&lt;/code&gt;ï¼Œ&lt;code&gt;borrow_mut&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;åˆ é™¤å…ƒç´ ï¼š &lt;code&gt;delete&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;å…ƒç´ é•¿åº¦ï¼š &lt;code&gt;length&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;åˆ¤æ–­å­˜åœ¨æ€§ï¼š&lt;code&gt;contains&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Object table çš„æ“ä½œä¸ table ç±»ä¼¼ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-rust"&gt;module ds::tables {
    use sui::object::{Self, UID};
    use sui::transfer;
    use sui::tx_context::{Self, TxContext};
    use sui::table::{Self, Table};

    const EChildAlreadyExists: u64 = 0;
    const EChildNotExists: u64 = 1;

    struct Parent has key {
        id: UID,
        children: Table&amp;lt;u64, Child&amp;gt;,
    }

    struct Child has key, store {
        id: UID,
        age: u64
    }
    // åˆ›å»º Parent å¯¹è±¡
    public entry fun initialize(ctx: &amp;amp;mut TxContext) {
        transfer::transfer(
            Parent { id: object::new(ctx), children: table::new(ctx) },
            tx_context::sender(ctx)
        );
    }

    public fun child_age(child: &amp;amp;Child): u64 {
        child.age
    }
    // æŸ¥çœ‹
    public fun child_age_via_parent(parent: &amp;amp;Parent, index: u64): u64 {
        assert!(!table::contains(&amp;amp;parent.children, index), EChildNotExists);
        table::borrow(&amp;amp;parent.children, index).age
    }
    // è·å–é•¿åº¦
    public fun child_size_via_parent(parent: &amp;amp;Parent): u64 {
        table::length(&amp;amp;parent.children)
    }
    // æ·»åŠ 
    public entry fun add_child(parent: &amp;amp;mut Parent, index: u64, ctx: &amp;amp;mut TxContext) {
        assert!(table::contains(&amp;amp;parent.children, index), EChildAlreadyExists);
        table::add(&amp;amp;mut parent.children, index, Child { id: object::new(ctx), value: 0 });
    }
    // ä¿®æ”¹
    public fun mutate_child(child: &amp;amp;mut Child) {
        child.age = child.age + 1;
    }

    public entry fun mutate_child_via_parent(parent: &amp;amp;mut Parent, index: u64) {
        mutate_child(table::borrow_mut(&amp;amp;mut parent.children, index));
    }
    // åˆ é™¤
    public entry fun delete_child(parent: &amp;amp;mut Parent, index: u64) {
        assert!(!table::contains(&amp;amp;parent.children, index), EChildNotExists);
        let Child { id, age: _ } = table::remove(
            &amp;amp;mut parent.children,
            index
        );
        object::delete(id);
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;Bag&lt;/h3&gt;
&lt;p&gt;Bag çš„æ“ä½œä¸ table çš„æ“ä½œæ¥å£ç±»ä¼¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ·»åŠ å…ƒç´ ï¼š &lt;code&gt;add&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;è¯»å–å’Œä¿®æ”¹å…ƒç´ ï¼š &lt;code&gt;borrow&lt;/code&gt;ï¼Œ&lt;code&gt;borrow_mut&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;åˆ é™¤å…ƒç´ ï¼š &lt;code&gt;delete&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;å…ƒç´ é•¿åº¦ï¼š &lt;code&gt;length&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;åˆ¤æ–­å­˜åœ¨æ€§ï¼š&lt;code&gt;contains&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™é‡Œæˆ‘ä»¬ä»…å±•ç¤ºæ·»åŠ ä¸åŒç±»å‹çš„é”®å€¼å¯¹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Object_bag&lt;/code&gt; çš„æ“ä½œä¸ &lt;code&gt;bag&lt;/code&gt; ç±»ä¼¼ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-rust"&gt;module ds::bags {
    use sui::object::{Self, UID};
    use sui::transfer;
    use sui::tx_context::{Self, TxContext};
    use sui::bag::{Self, Bag};

    const EChildAlreadyExists: u64 = 0;
    const EChildNotExists: u64 = 1;

    struct Parent has key {
        id: UID,
        children: Bag,
    }

    struct Child1 has key, store {
        id: UID,
        value: u64
    }

    struct Child2 has key, store {
        id: UID,
        value: u64
    }

    public entry fun initialize(ctx: &amp;amp;mut TxContext) {
        transfer::transfer(
            Parent { id: object::new(ctx), children: bag::new(ctx) },
            tx_context::sender(ctx)
        );
    }
    // æ·»åŠ ç¬¬ä¸€ç§ç±»å‹
    public entry fun add_child1(parent: &amp;amp;mut Parent, index: u64, ctx: &amp;amp;mut TxContext) {
        assert!(bag::contains(&amp;amp;parent.children, index), EChildAlreadyExists);
        bag::add(&amp;amp;mut parent.children, index, Child1 { id: object::new(ctx), value: 0 });
    }
    // æ·»åŠ ç¬¬äºŒç§ç±»å‹
    public entry fun add_child2(parent: &amp;amp;mut Parent, index: u64, ctx: &amp;amp;mut TxContext) {
        assert!(bag::contains(&amp;amp;parent.children, index), EChildAlreadyExists);
        bag::add(&amp;amp;mut parent.children, index, Child2 { id: object::new(ctx), value: 0 });
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;LinkedTable&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;linked_table&lt;/code&gt; æ˜¯å¦ä¸€ç§ä½¿ç”¨ dynamic field å®ç°çš„æ•°æ®ç»“æ„ï¼Œå®ƒä¸ &lt;code&gt;table&lt;/code&gt; ç±»ä¼¼ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå®ƒè¿˜æ”¯æŒå€¼çš„æœ‰åºæ’å…¥å’Œåˆ é™¤ã€‚å› æ­¤ï¼Œé™¤äº† table  ç±»ä¼¼çš„åŸºç¡€æ“ä½œæ–¹æ³•ï¼Œè¿˜åŒ…å« &lt;code&gt;front&lt;/code&gt;ï¼Œ&lt;code&gt;back&lt;/code&gt;ï¼Œ&lt;code&gt;push_front&lt;/code&gt;ï¼Œ&lt;code&gt;push_back&lt;/code&gt;ï¼Œ&lt;code&gt;pop_front&lt;/code&gt;ï¼Œ&lt;code&gt;pop_back&lt;/code&gt;ç­‰æ“ä½œï¼Œå¯¹äºæ¯ä¸€ä¸ªé”®ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ &lt;code&gt;prev&lt;/code&gt; å’Œ &lt;code&gt;next&lt;/code&gt; è·å–å‰ä¸€ä¸ªå’Œåä¸€ä¸ªæ’å…¥çš„é”®ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-rust"&gt;module ds::linked_tables {
    use sui::linked_table::{
        Self,
        push_front,
        push_back,
        borrow,
        borrow_mut,
        remove,
        pop_front,
        pop_back,
        contains,
        is_empty,
        destroy_empty
    };
    use sui::tx_context::TxContext;

    public entry fun simple_all_functions(ctx: &amp;amp;mut TxContext) {
        let table = linked_table::new(ctx);
        // æ·»åŠ å­—æ®µ
        push_back(&amp;amp;mut table, b&amp;quot;hello&amp;quot;, 0);
        push_back(&amp;amp;mut table, b&amp;quot;goodbye&amp;quot;, 1);
        // [b&amp;quot;hello&amp;quot;, b&amp;quot;goodbye&amp;quot;]
        // æ£€æŸ¥æ˜¯å¦å­˜åœ¨
        assert!(contains(&amp;amp;table, b&amp;quot;hello&amp;quot;), 0);
        assert!(contains(&amp;amp;table, b&amp;quot;goodbye&amp;quot;), 0);
        assert!(!is_empty(&amp;amp;table), 0);
        // ä¿®æ”¹
        *borrow_mut(&amp;amp;mut table, b&amp;quot;hello&amp;quot;) = *borrow(&amp;amp;table, b&amp;quot;hello&amp;quot;) * 2;
        *borrow_mut(&amp;amp;mut table, b&amp;quot;goodbye&amp;quot;) = *borrow(&amp;amp;table, b&amp;quot;goodbye&amp;quot;) * 2;
        // æ£€æŸ¥ä¿®æ”¹ä¹‹åçš„å€¼
        assert!(*borrow(&amp;amp;table, b&amp;quot;hello&amp;quot;) == 0, 0);
        assert!(*borrow(&amp;amp;table, b&amp;quot;goodbye&amp;quot;) == 2, 0);
        // æ’å…¥å¤´éƒ¨
        push_front(&amp;amp;mut table, b&amp;quot;!!!&amp;quot;, 2);
        // b&amp;quot;!!!&amp;quot;, b&amp;quot;hello&amp;quot;, b&amp;quot;goodbye&amp;quot;]
        // åœ¨æœ«å°¾æ·»åŠ 
        push_back(&amp;amp;mut table, b&amp;quot;?&amp;quot;, 3);
        // [b&amp;quot;!!!&amp;quot;, b&amp;quot;hello&amp;quot;, b&amp;quot;goodbye&amp;quot;, b&amp;quot;?&amp;quot;]
        // ä»å¤´éƒ¨å¼¹å‡º
        let (front_k, front_v) = pop_front(&amp;amp;mut table);
        assert!(front_k == b&amp;quot;!!!&amp;quot;, 0);
        assert!(front_v == 2, 0);
        // ä»ä¸­é—´åˆ é™¤
        assert!(remove(&amp;amp;mut table, b&amp;quot;goodbye&amp;quot;) == 2, 0);
        // [b&amp;quot;hello&amp;quot;, b&amp;quot;?&amp;quot;]
        // ä»æœ«å°¾åˆ é™¤
        let (back_k, back_v) = pop_back(&amp;amp;mut table);
        assert!(back_k == b&amp;quot;?&amp;quot;, 0);
        assert!(back_v == 3, 0);
        // ç§»å‡ºå€¼å¹¶æ£€æŸ¥
        assert!(remove(&amp;amp;mut table, b&amp;quot;hello&amp;quot;) == 0, 0);
        // æ£€æŸ¥ä¸å­˜åœ¨
        assert!(is_empty(&amp;amp;table), 0);
        destroy_empty(table);
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;TableVec&lt;/h3&gt;
&lt;p&gt;æœ€åï¼Œæˆ‘ä»¬ä»‹ç»ä¸€ç§åŸºäº &lt;code&gt;table&lt;/code&gt; çš„æ•°æ®ç»“æ„ &lt;code&gt;table_vec&lt;/code&gt;ã€‚ä»åå­—å°±å¯ä»¥çœ‹å‡ºï¼Œ&lt;code&gt;table_vec&lt;/code&gt; æ˜¯ä½¿ç”¨ &lt;code&gt;table&lt;/code&gt; å®ç°çš„å¯æ‰©å±• &lt;code&gt;vector&lt;/code&gt;ï¼Œå®ƒä½¿ç”¨å…ƒç´ åœ¨ &lt;code&gt;vector&lt;/code&gt; çš„ç´¢å¼•ä½œä¸º &lt;code&gt;table&lt;/code&gt; ä¸­çš„é”®è¿›è¡Œå­˜å‚¨ã€‚&lt;code&gt;table_vec&lt;/code&gt; æä¾›äº†ä¸ &lt;code&gt;vector&lt;/code&gt; ç±»ä¼¼çš„æ“ä½œæ–¹æ³•ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-rust"&gt;module ds::table_vecs {
    use sui::table_vec;
    use sui::tx_context::TxContext;

    public entry fun example(ctx: &amp;amp;mut TxContext) {
        let vec = table_vec::singleton&amp;lt;u64&amp;gt;(1, ctx);

        table_vec::push_back(&amp;amp;mut vec, 2);
        assert!(table_vec::length(&amp;amp;vec) == 2, 0);

        let v = table_vec::borrow_mut(&amp;amp;mut vec, 1);
        *v = 3;

        assert!(table_vec::pop_back(&amp;amp;mut vec) == 3, 1);
        assert!(table_vec::pop_back(&amp;amp;mut vec) == 1, 1);

        assert!(table_vec::is_empty(&amp;amp;vec), 2);
        table_vec::destroy_empty(vec);
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç¼–è¯‘å¹¶è¿è¡Œç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-bash"&gt;sui client call \
  --function example \
  --module table_vecs \
  --package ${package_id} \
  --gas-budget 30000
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è‡³æ­¤ï¼Œæˆ‘ä»¬ä»‹ç»å®Œäº† Sui Move ä¸­ä¸»è¦çš„æ•°æ®ç±»å‹åŠå…¶ä½¿ç”¨æ–¹æ³•ï¼Œå¸Œæœ›å¤§å®¶å­¦ä¹ å’Œç†è§£ Sui Move æœ‰ä¸€å®šçš„å¸®åŠ©ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href="https://github.com/qiwihui/blog/issues/172"&gt;View on GitHub&lt;/a&gt;&lt;/p&gt;
</content></entry><entry><title>Sui ç±»ç‹¼ç¾Šæ¸¸æˆé¡¹ç›®å¼€å‘å®è·µ</title><id>blogs/qiwihui-blog-171.md</id><updated>2024-08-18T03:45:14+00:00</updated><author><name>qiwihui</name><email>qwh005007@gmail.com</email></author><link href="https://qiwihui.com/blogs/qiwihui-blog-171.html" rel="self"/><published>2024-05-25T09:37:50+00:00</published><content type="html">&lt;h1&gt;Sui ç±»ç‹¼ç¾Šæ¸¸æˆé¡¹ç›®å¼€å‘å®è·µ&lt;/h1&gt;
&lt;p&gt;è¿™ç¯‡æ–‡ç« å°†å‘ä½ ä»‹ç» Sui Move ç‰ˆæœ¬çš„ç±»ç‹¼ç¾Šæ¸¸æˆçš„åˆçº¦å’Œå‰ç«¯ç¼–å†™è¿‡ç¨‹ã€‚é˜…è¯»å‰ï¼Œå»ºè®®å…ˆç†Ÿæ‚‰ä»¥ä¸‹å†…å®¹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Sui å‘½ä»¤è¡Œçš„åŸºæœ¬æ“ä½œï¼›&lt;/li&gt;
&lt;li&gt;Move è¯­æ³•ï¼ˆ&lt;a href="https://mp.weixin.qq.com/s/epwJmR6oXCgtKtSbBqJyAw"&gt;åŸºç¡€&lt;/a&gt;å’Œ&lt;a href="https://mp.weixin.qq.com/s/OXLyiUKzpFzAzc-PVxLvTA"&gt;é«˜çº§&lt;/a&gt;ï¼‰å’Œ Sui Move çš„å¯¹è±¡è¯­æ³•ï¼›&lt;/li&gt;
&lt;li&gt;React åŸºæœ¬è¯­æ³•ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é¡¹ç›®ä»£ç ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åˆçº¦ï¼š&lt;a href="https://github.com/AptosWolfGame/fox_game_contract"&gt;https://github.com/AptosWolfGame/fox_game_contract&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å‰ç«¯ï¼š &lt;a href="https://github.com/AptosWolfGame/fox_game_interface"&gt;https://github.com/AptosWolfGame/fox_game_interface&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨çº¿ Demoï¼š &lt;a href="https://fox-game-interface.vercel.app/"&gt;https://fox-game-interface.vercel.app/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="https://user-images.githubusercontent.com/3297411/215304366-1aeb3308-5859-4613-a61a-f353d0b48877.png" alt="Untitled" /&gt;&lt;/p&gt;
&lt;h2&gt;0x1 ç‹¼ç¾Šæ¸¸æˆçš„è§„åˆ™&lt;/h2&gt;
&lt;p&gt;ç‹¼ç¾Šæ¸¸æˆæ˜¯ä»¥å¤ªåŠä¸Šçš„ NFT æ¸¸æˆï¼Œç©å®¶é€šè¿‡è´­ä¹°NFTï¼Œç„¶åå°† NFT è´¨æŠ¼æ¥è·å–æ¸¸æˆä»£å¸ $WOOLï¼Œæ¸¸æˆä»£å¸ $WOOL å¯ç”¨äºä¹‹åçš„ NFT é“¸é€ ã€‚æœ‰è¶£çš„æ˜¯ï¼Œç‹¼ç¾Šæ¸¸æˆåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å¼•å…¥äº†éšæœºæ€§ï¼Œè®©å•çº¯çš„è´¨æŠ¼è¿‡ç¨‹å¢åŠ äº†ä¸ç¡®å®šæ€§ï¼Œå› è€Œå¸å¼•äº†å¤§é‡ç©å®¶å‚ä¸åˆ°æ¸¸æˆä¸­ï¼Œç‹¼ç¾Šæ¸¸æˆçš„å¯ç©æ€§ä¹Ÿæ˜¯å»ºç«‹åœ¨è¿™ä¸ªåŸºç¡€ä¹‹ä¸Šã€‚å…·ä½“çš„æ¸¸æˆè§„åˆ™ä¸ºï¼š&lt;/p&gt;
&lt;h3&gt;1.1 &lt;strong&gt;ç¾Š&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;ä½ æœ‰90%çš„æ¦‚ç‡é“¸é€ ä¸€åªç¾Šï¼Œæ¯åªç¾Šéƒ½æœ‰ç‹¬ç‰¹çš„ç‰¹å¾ã€‚ä»¥ä¸‹æ˜¯ä»–ä»¬å¯ä»¥é‡‡å–çš„è¡ŒåŠ¨ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;è¿›å…¥è°·ä»“ï¼ˆStakeï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ¯å¤©ç´¯ç§¯ 10,000 ç¾Šæ¯› $WOOL&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å‰ªç¾Šæ¯› $WOOL (Claim)&lt;/p&gt;
&lt;p&gt;æ”¶åˆ°çš„ç¾Šæ¯›80%ç´¯ç§¯åœ¨ç¾Šçš„èº«ä¸Šï¼Œç‹¼å¯¹å‰ªä¸‹çš„ç¾Šæ¯›æ”¶å–20%çš„ç¨ï¼Œä½œä¸ºä¸æ”»å‡»è°·ä»“çš„å›æŠ¥ã€‚å¾ç¨çš„ $WOOL åˆ†é…ç»™ç›®å‰åœ¨è°·ä»“ä¸­è´¨æŠ¼çš„æ‰€æœ‰ç‹¼ï¼Œæ•°é‡ä¸ä»–ä»¬çš„ Alpha åˆ†æ•°æˆæ­£æ¯”ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç¦»å¼€è°·ä»“ï¼ˆUnstakeï¼‰&lt;/p&gt;
&lt;p&gt;ç¾Šè¢«ä»è°·ä»“ä¸­ç§»é™¤ï¼Œæ‰€æœ‰ $WOOL éƒ½è¢«å‰ªæ‰äº†ã€‚åªæœ‰å½“ç¾Šç§¯ç´¯äº†2å¤©ä»·å€¼çš„ $WOOL æ—¶æ‰èƒ½ç¦»å¼€è°·ä»“ï¼Œç¦»å¼€è°·ä»“æ—¶ä½ æ‰€æœ‰ç´¯ç§¯çš„ $WOOL æœ‰50%çš„å‡ ç‡è¢«ç‹¼å…¨éƒ¨å·èµ°ã€‚è¢«ç›— $WOOL åˆ†é…ç»™å½“å‰åœ¨è°·ä»“ä¸­è´¨æŠ¼çš„æ‰€æœ‰ç‹¼ï¼Œæ•°é‡ä¸ä»–ä»¬çš„ Alpha åˆ†æ•°æˆæ­£æ¯”ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨ $WOOL é“¸é€ ä¸€ä¸ªæ–°ç¾Š&lt;/p&gt;
&lt;p&gt;é“¸é€ çš„ NFT æœ‰10%çš„å¯èƒ½æ€§å®é™…ä¸Šæ˜¯ç‹¼ï¼æ–°çš„ç¾Šæˆ–ç‹¼æœ‰10%çš„å‡ ç‡è¢«è´¨æŠ¼çš„ç‹¼å·èµ°ã€‚æ¯åªç‹¼çš„æˆåŠŸæœºä¼šä¸ä»–ä»¬çš„ Alpha åˆ†æ•°æˆæ­£æ¯”ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;1.2 &lt;strong&gt;ç‹¼&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;ä½ æœ‰ 10% çš„æœºä¼šé“¸é€ ä¸€åªç‹¼ï¼Œæ¯åªç‹¼éƒ½æœ‰ç‹¬ç‰¹çš„ç‰¹å¾ï¼ŒåŒ…æ‹¬ 5~8 çš„ Alpha å€¼ã€‚Alphaå€¼è¶Šé«˜ï¼Œç‹¼ä»ç¨æ”¶ä¸­èµšå–çš„ $WOOL éƒ¨åˆ†è¶Šé«˜ï¼Œå·ä¸€åªæ–°é“¸é€ çš„ç¾Šæˆ–ç‹¼çš„æ¦‚ç‡ä¹Ÿè¶Šé«˜ã€‚åªæœ‰è¢«è´¨æŠ¼çš„ç‹¼æ‰èƒ½å·ç¾Šæˆ–èµšå– $WOOL ç¨ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å­ï¼šç‹¼Açš„ Alpha ä¸º8ï¼Œç‹¼Bçš„ Alpha ä¸º6ï¼Œå¹¶ä¸”ä»–ä»¬éƒ½è¢«è´¨æŠ¼ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœç´¯è®¡ 70,000 ç¾Šæ¯›ä½œä¸ºç¨æ¬¾ï¼Œç‹¼Aå°†èƒ½å¤Ÿè·å¾— 40,000 ç¾Šæ¯›ï¼Œç‹¼Bå°†èƒ½å¤Ÿè·å¾— 30,000 ç¾Šæ¯›ï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœæ–°é“¸é€ çš„ç¾Šæˆ–ç‹¼è¢«ç›—ï¼Œç‹¼Aæœ‰57%æ¦‚ç‡è·å¾—ï¼Œç‹¼Bæœ‰43%çš„æ¦‚ç‡è·å¾—ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ¬æ¬¡é¡¹ç›®å®è·µï¼Œæˆ‘ä»¬å°†åœ¨ Sui åŒºå—é“¾ä¸Šé€šè¿‡ Move æ™ºèƒ½åˆçº¦è¯­è¨€æ¥å®ç°æ¸¸æˆé“¸é€ ï¼Œè´¨æŠ¼å’Œè·å– NFT è¿‡ç¨‹ï¼Œå¹¶ä½¿ç”¨æ–°çš„æ¸¸æˆå…ƒç´ ï¼šç‹ç‹¸ï¼Œé¸¡å’Œé¸¡è›‹ï¼Œå…¶ä¸­ç‹ç‹¸å¯¹åº”ç‹¼ï¼Œé¸¡å¯¹åº”ç¾Šï¼Œé¸¡è›‹å¯¹åº”ç¾Šæ¯›ï¼Œå…¶ä»–è¿‡ç¨‹ä¸å˜ï¼Œæˆ‘ä»¬å°†è¿™ä¸ªæ¸¸æˆå‘½åä¸º&lt;strong&gt;ç‹ç‹¸æ¸¸æˆ&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h2&gt;0x2 åˆçº¦å¼€å‘&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬é¦–å…ˆè¿›è¡Œæ™ºèƒ½åˆçº¦çš„ç¼–å†™ï¼Œå¤§è‡´åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åˆ›å»º NFT&lt;/li&gt;
&lt;li&gt;é“¸é€  NFTï¼ˆMintï¼‰&lt;/li&gt;
&lt;li&gt;è´¨æŠ¼ NFT ï¼ˆStakeï¼‰&lt;/li&gt;
&lt;li&gt;é¸¡è›‹ï¼ˆEGGï¼‰ä»£å¸å’Œæ”¶é›†é¸¡è›‹ï¼ˆCollect/Claimï¼‰&lt;/li&gt;
&lt;li&gt;æå– NFTï¼ˆUnstakeï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;2.1 NFT ç»“æ„&lt;/h3&gt;
&lt;p&gt;é¦–å…ˆæˆ‘ä»¬å®šä¹‰ç‹ç‹¸å’Œé¸¡çš„ NFT çš„ç»“æ„ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªç»“æ„ä½“ &lt;code&gt;FoxOrChicken&lt;/code&gt; æ¥è¡¨ç¤ºè¿™ä¸ª NFTï¼Œ é€šè¿‡ &lt;code&gt;is_chicken&lt;/code&gt; æ¥è¿›è¡ŒåŒºåˆ†ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-rust"&gt; // æ–‡ä»¶ï¼štoken_helper.move
    /// Defines a Fox or Chicken attribute. Eg: `pattern: 'panda'`
    struct Attribute has store, copy, drop {
        name: vector&amp;lt;u8&amp;gt;,
        value: vector&amp;lt;u8&amp;gt;,
    }

    struct FoxOrChicken has key, store {
        id: UID,
        index: u64, // ç´¢å¼•
        is_chicken: bool, // æ˜¯å¦æ˜¯é¸¡
        alpha: u8, // ç‹ç‹¸çš„ alpha
        url: Url, // å›¾ç‰‡
        link: Url, // NFT é“¾æ¥
        item_count: u8, // å½“å‰ NFT çš„æ•°é‡
        attributes: vector&amp;lt;Attribute&amp;gt;, // å±æ€§
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å…¶ä¸­ï¼Œ &lt;code&gt;url&lt;/code&gt; æ—¢å¯ä»¥æ˜¯æŒ‡å‘ NFT å›¾ç‰‡çš„é“¾æ¥ï¼Œä¹Ÿå¯ä»¥æ˜¯ base64 ç¼–ç çš„å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚ &lt;code&gt;data:image/svg+xml;base64,PHN2Zy......&lt;/code&gt;ã€‚&lt;code&gt;link&lt;/code&gt; æ˜¯ä¸€ä¸ªæŒ‡å‘ NFT çš„é¡µé¢ã€‚&lt;/p&gt;
&lt;h3&gt;2.2 åˆ›å»º NFT å¯¹è±¡&lt;/h3&gt;
&lt;p&gt;æ•´ä¸ªåˆ›å»º NFT çš„é€»è¾‘å¤§è‡´å°±æ˜¯æ ¹æ®éšæœºç§å­ç”Ÿæˆå¯¹åº”å±æ€§ç´¢å¼•ï¼Œæ ¹æ®å±æ€§ç´¢å¼•æ„å»ºå¯¹åº”çš„å±æ€§åˆ—è¡¨å’Œå›¾ç‰‡ï¼Œä»è€Œåˆ›å»º NFTã€‚&lt;/p&gt;
&lt;p&gt;åˆ›å»º NFT ä½¿ç”¨åˆ° &lt;code&gt;FoCRegistry&lt;/code&gt; ç»“æ„ä½“ï¼Œè¿™ä¸ªæ•°æ®ç»“æ„ç”¨äºè®°å½•å…³äº NFT çš„ä¸€äº›æ•°æ®ï¼Œæ¯”å¦‚ &lt;code&gt;foc_born&lt;/code&gt; è®°å½•ç”Ÿäº§çš„ NFT æ€»æ•°ï¼Œ&lt;code&gt;foc_hash&lt;/code&gt; ç”¨äºåœ¨ç”Ÿäº§ NFT æ—¶äº§ç”Ÿéšæœºæ•°ï¼Œè¯¥éšæœºæ•°ç”¨äºç”Ÿæˆ NFT çš„å±æ€§ï¼Œ&lt;code&gt;foc_hash&lt;/code&gt; å¯ä»¥çœ‹ä½œæ˜¯ NFT çš„åŸºå› ã€‚å…·ä½“çš„å±æ€§å€¼è®°å½•å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-rust"&gt;// æ–‡ä»¶ï¼štoken_helper.move

        struct FoCRegistry has key, store {
        id: UID,
        foc_born: u64, // NFT supply
        foc_hash: vector&amp;lt;u8&amp;gt;, // NFT gene
        rarities: vector&amp;lt;vector&amp;lt;u8&amp;gt;&amp;gt;, // å±æ€§å€¼æ¦‚ç‡
        aliases: vector&amp;lt;vector&amp;lt;u8&amp;gt;&amp;gt;, // å±æ€§å€¼ç´¢å¼•
        types: Table&amp;lt;ID, bool&amp;gt;, // NFT å¯¹è±¡ ID ä¸ç±»å‹ï¼ˆæ˜¯å¦ä¸ºé¸¡ï¼‰çš„å¯¹åº”
        alphas: Table&amp;lt;ID, u8&amp;gt;, // ç‹ç‹¸çš„ Alpha å€¼
        trait_data: Table&amp;lt;u8, Table&amp;lt;u8, Trait&amp;gt;&amp;gt;, // å±æ€§å€¼ï¼Œç¬¬ä¸€ä¸ªu8æ˜¯ç±»å‹ç¼–å·ï¼Œç¬¬äºŒä¸ªu8æ˜¯å±æ€§ç´¢å¼•
        trait_types: vector&amp;lt;vector&amp;lt;u8&amp;gt;&amp;gt;, // å±æ€§ç±»å‹åç§°
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åˆ›å»º NFT æ–¹æ³• &lt;code&gt;create_foc&lt;/code&gt; å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-rust"&gt;// æ–‡ä»¶ï¼štoken_helper.move
        public(friend) fun create_foc(
        reg: &amp;amp;mut FoCRegistry, ctx: &amp;amp;mut TxContext
    ): FoxOrChicken {
        let id = object::new(ctx);
        reg.foc_born = reg.foc_born + 1;
        // æ ¹æ® UID ä¸æ—§ foc_hash ç”Ÿäº§æ–°çš„ foc_hash
        vec::append(&amp;amp;mut reg.foc_hash, object::uid_to_bytes(&amp;amp;id));
        reg.foc_hash = hash(reg.foc_hash);
        // éšæœºäº§ç”Ÿ traitï¼Œå¹¶ç”Ÿæˆå±æ€§å¯¹ attributes
        let fc = generate_traits(reg);
        let attributes = get_attributes(reg, &amp;amp;fc);

        let alpha = *vec::borrow(&amp;amp;ALPHAS, (fc.alpha_index as u64));
        // è®°å½•IDå¯¹åº”ç±»å‹
        table::add(&amp;amp;mut reg.types, object::uid_to_inner(&amp;amp;id), fc.is_chicken);
        if (!fc.is_chicken) {
            table::add(&amp;amp;mut reg.alphas, object::uid_to_inner(&amp;amp;id), alpha);
        };
        // ç”Ÿæˆäº‹ä»¶
        emit(FoCBorn {
            id: object::uid_to_inner(&amp;amp;id),
            index: reg.foc_born,
            attributes: *&amp;amp;attributes,
            created_by: tx_context::sender(ctx),
        });
        // è¿”å›ç”Ÿæˆçš„ FoxOrChicken
        FoxOrChicken {
            id,
            index: reg.foc_born,
            is_chicken: fc.is_chicken,
            alpha: alpha,
            url: img_url(reg, &amp;amp;fc),
            link: link_url(reg.foc_born, fc.is_chicken),
            attributes,
            item_count: 0,
        }
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å…¶ä¸­ &lt;code&gt;genetate_traits&lt;/code&gt; ç”¨äºæ ¹æ® &lt;code&gt;foc_hash&lt;/code&gt; ç”Ÿæˆ NFT çš„å±æ€§å€¼ï¼Œæ­¤å¤„å±æ€§ä¸ºå¯¹åº”å±æ€§å€¼çš„ç´¢å¼•ï¼Œ&lt;code&gt;select_trait&lt;/code&gt; æ ¹æ® A.J. Walker's Alias ç®—æ³•æ ¹æ®é¢„å…ˆè®¾ç½®å¥½çš„æ¯ä¸€ä¸ªå±æ€§çš„éšæœºæ¦‚ç‡ï¼ˆ&lt;code&gt;rarities&lt;/code&gt;ï¼‰æ¥å¿«é€Ÿç”Ÿæˆå¯¹åº”çš„å±æ€§ç´¢å¼•ã€‚è¯¦æƒ…å¯ä»¥å‚è€ƒæ–‡ç«  &lt;a href="https://zhuanlan.zhihu.com/p/436785581"&gt;https://zhuanlan.zhihu.com/p/436785581&lt;/a&gt; ä¸­ A.J. Walker's Alias ç®—æ³•ä¸€èŠ‚****ã€‚****&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-rust"&gt;// æ–‡ä»¶ï¼š token_helper.move
        // generates traits for a specific token, checking to make sure it's unique
    public fun generate_traits(
        reg: &amp;amp;FoCRegistry,
        // seed: &amp;amp;vector&amp;lt;u8&amp;gt;
    ): Traits {
        let seed = reg.foc_hash;
        let is_chicken = *vec::borrow(&amp;amp;seed, 0) &amp;gt;= 26; // 90% 0f 255
        let shift = if (is_chicken) 0 else 9;
        // æ ¹æ®éšæœºç§å­ç”Ÿæˆå±æ€§
                Traits {
            is_chicken,
            fur: select_trait(reg, *vec::borrow(&amp;amp;seed, 1), *vec::borrow(&amp;amp;seed, 10), 0 + shift),
            head: select_trait(reg, *vec::borrow(&amp;amp;seed, 2), *vec::borrow(&amp;amp;seed, 11), 1 + shift),
            ears: select_trait(reg, *vec::borrow(&amp;amp;seed, 3), *vec::borrow(&amp;amp;seed, 12), 2 + shift),
            eyes: select_trait(reg, *vec::borrow(&amp;amp;seed, 4), *vec::borrow(&amp;amp;seed, 13), 3 + shift),
            nose: select_trait(reg, *vec::borrow(&amp;amp;seed, 5), *vec::borrow(&amp;amp;seed, 14), 4 + shift),
            mouth: select_trait(reg, *vec::borrow(&amp;amp;seed, 6), *vec::borrow(&amp;amp;seed, 15), 5 + shift),
            neck: select_trait(reg, *vec::borrow(&amp;amp;seed, 7), *vec::borrow(&amp;amp;seed, 16), 6 + shift),
            feet: select_trait(reg, *vec::borrow(&amp;amp;seed, 8), *vec::borrow(&amp;amp;seed, 17), 7 + shift),
            alpha_index: select_trait(reg, *vec::borrow(&amp;amp;seed, 9), *vec::borrow(&amp;amp;seed, 18), 8 + shift),
        }
    }
    // æ ¹æ® A.J. Walker's Alias ç®—æ³•è®¡ç®—å±æ€§å€¼
        fun select_trait(reg: &amp;amp;FoCRegistry, seed1: u8, seed2: u8, trait_type: u64): u8 {
        let trait = (seed1 as u64) % vec::length(vec::borrow(&amp;amp;reg.rarities, trait_type));
        if (seed2 &amp;lt; *vec::borrow(vec::borrow(&amp;amp;reg.rarities, trait_type), trait)) {
            return (trait as u8)
        };
        *vec::borrow(vec::borrow(&amp;amp;reg.aliases, trait_type), trait)
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è€Œ &lt;code&gt;get_attributes&lt;/code&gt; åˆ™æ˜¯æ ¹æ®å±æ€§ç´¢å¼•å€¼å¯¹åº”ä» &lt;code&gt;trait_types&lt;/code&gt; å’Œ &lt;code&gt;trait_data&lt;/code&gt; ä¸­å°†å±æ€§çš„çœŸå®å€¼å–å‡ºå¹¶æ„å»ºæˆå±æ€§æ•°ç»„ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-rust"&gt;fun get_attributes(reg: &amp;amp;mut FoCRegistry, fc: &amp;amp;Traits): vector&amp;lt;Attribute&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è€Œ &lt;code&gt;img_url&lt;/code&gt; åˆ™é€šè¿‡ä¸Šè¿°ç”Ÿæˆçš„ç‰¹å¾æ„å»ºå‡ºå¯¹åº”çš„ base64 ç¼–ç çš„ svg å›¾ç‰‡ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-rust"&gt;        /// Construct an image URL for the NFT.
    fun img_url(reg:&amp;amp;mut FoCRegistry, fc: &amp;amp;Traits): Url {
        url::new_unsafe_from_bytes(token_uri(reg, fc))
    }
        fun token_uri(reg: &amp;amp;mut FoCRegistry, foc: &amp;amp;Traits): vector&amp;lt;u8&amp;gt; {
        let uri = b&amp;quot;data:image/svg+xml;base64,&amp;quot;;
        vec::append(&amp;amp;mut uri, base64::encode(&amp;amp;draw_svg(reg, foc)));
        uri
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è‡³æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ &lt;code&gt;create_foc&lt;/code&gt; æ–¹æ³•åˆ›å»ºä¸€ä¸ª FoxOrChicken NFTã€‚&lt;/p&gt;
&lt;h3&gt;2.3 é“¸é€  NFT&lt;/h3&gt;
&lt;p&gt;æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹åˆ°é“¸é€  NFT è¿‡ç¨‹ï¼Œå¤§è‡´è¿‡ç¨‹ä¸ºï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åˆ¤æ–­æ€»ä¾›ç»™é‡æ˜¯å¦æ»¡è¶³æ¡ä»¶ï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœåœ¨ SUI ä»£å¸è´­ä¹°é˜¶æ®µï¼Œåˆ™è½¬ç§» SUI ä»£å¸ï¼Œå¦åˆ™ï¼Œéœ€è¦æ”¯ä»˜ EGG ä»£å¸è¿›è¡Œé“¸é€ ï¼ŒEGG çš„é“¸é€ å’Œé”€æ¯åœ¨ä¹‹åçš„ç« èŠ‚ä¸­ä»‹ç»ï¼›&lt;/li&gt;
&lt;li&gt;é“¸é€  NFT å¹¶æ ¹æ®50%æ¦‚ç‡åˆ¤æ–­æ˜¯å¦è¢«è´¨æŠ¼çš„ç‹ç‹¸ç›—èµ°ï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœé€‰æ‹©è´¨æŠ¼åˆ™å°† NFT è½¬å…¥è´¨æŠ¼ï¼Œå¦åˆ™è½¬å…¥é“¸é€ è€…çš„è´¦æˆ·ä¸­ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class="language-rust"&gt;// æ–‡ä»¶ï¼š fox.move
    /// mint a fox or chicken
    public entry fun mint(
        global: &amp;amp;mut Global,
        treasury_cap: &amp;amp;mut TreasuryCap&amp;lt;EGG&amp;gt;,
        amount: u64,
        stake: bool,
        pay_sui: vector&amp;lt;Coin&amp;lt;SUI&amp;gt;&amp;gt;,
        pay_egg: vector&amp;lt;Coin&amp;lt;EGG&amp;gt;&amp;gt;,
        ctx: &amp;amp;mut TxContext,
    ) {
        assert_enabled(global);
        // æ£€æŸ¥ä¾›åº”é‡æ˜¯å¦è¶…å‡ºæ€»ä¾›åº”é‡
        assert!(amount &amp;gt; 0 &amp;amp;&amp;amp; amount &amp;lt;= config::max_single_mint(), EINVALID_MINTING);
        let token_supply = token_helper::total_supply(&amp;amp;global.foc_registry);
        assert!(token_supply + amount &amp;lt;= config::target_max_tokens(), EALL_MINTED);

        let receiver_addr = sender(ctx);
        // å¤„ç† SUI ä»£å¸ä»˜æ¬¾
        if (token_supply &amp;lt; config::paid_tokens()) {
            assert!(vec::length(&amp;amp;pay_sui) &amp;gt; 0, EINSUFFICIENT_SUI_BALANCE);
            assert!(token_supply + amount &amp;lt;= config::paid_tokens(), EALL_MINTED);
            let price = config::mint_price() * amount;
            let (paid, remainder) = merge_and_split(pay_sui, price, ctx);
            coin::put(&amp;amp;mut global.balance, paid);
            transfer(remainder, sender(ctx));
        } else {
            // EGG ä»£å¸ä»˜æ¬¾é˜¶æ®µè¿”è¿˜ SUI ä»£å¸
            if (vec::length(&amp;amp;pay_sui) &amp;gt; 0) {
                transfer(merge(pay_sui, ctx), sender(ctx));
            } else {
                vec::destroy_empty(pay_sui);
            };
        };
        let id = object::new(ctx);
        let seed = hash(object::uid_to_bytes(&amp;amp;id));
        let total_egg_cost: u64 = 0;
        let tokens: vector&amp;lt;FoxOrChicken&amp;gt; = vec::empty&amp;lt;FoxOrChicken&amp;gt;();
        let i = 0;
        while (i &amp;lt; amount) {
            let token_index = token_supply + i + 1;
            // åˆ¤æ–­æ˜¯å¦è¢«ç‹ç‹¸ç›—èµ°
            let recipient: address = select_recipient(&amp;amp;mut global.pack, receiver_addr, seed, token_index);
            let token = token_helper::create_foc(&amp;amp;mut global.foc_registry, ctx);
            if (!stake || recipient != receiver_addr) {
                transfer(token, receiver_addr);
            } else {
                vec::push_back(&amp;amp;mut tokens, token);
            };
            // è®¡ç®— EGG ä»£å¸èŠ±è´¹
            total_egg_cost = total_egg_cost + mint_cost(token_index);
            i = i + 1;
        };
        // å¦‚æœéœ€è¦ EGG ä»£å¸èŠ±è´¹ï¼Œåˆ™è½¬ç§»å¹¶é”€æ¯ EGG ä»£å¸
        if (total_egg_cost &amp;gt; 0) {
            assert!(vec::length(&amp;amp;pay_egg) &amp;gt; 0, EINSUFFICIENT_EGG_BALANCE);
            // burn EGG
            let total_egg = merge(pay_egg, ctx);
            assert!(coin::value(&amp;amp;total_egg) &amp;gt;= total_egg_cost, EINSUFFICIENT_EGG_BALANCE);
            let paid = coin::split(&amp;amp;mut total_egg, total_egg_cost, ctx);
            egg::burn(treasury_cap, paid);
            transfer(total_egg, sender(ctx));
        } else {
            if (vec::length(&amp;amp;pay_egg) &amp;gt; 0) {
                transfer(merge(pay_egg, ctx), sender(ctx));
            } else {
                vec::destroy_empty(pay_egg);
            };
        };
        // é“¸é€ çš„åŒæ—¶è´¨æŠ¼ï¼Œåˆ™å°† NFT è½¬å…¥é‡è¦ä¸­
        if (stake) {
            barn::stake_many_to_barn_and_pack(
                &amp;amp;mut global.barn_registry,
                &amp;amp;mut global.barn,
                &amp;amp;mut global.pack,
                tokens,
                ctx
            );
        } else {
            vec::destroy_empty(tokens);
        };
        object::delete(id);
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;2.4 è´¨æŠ¼ NFT&lt;/h3&gt;
&lt;p&gt;è´¨æŠ¼ NFT æ—¶ï¼Œæˆ‘ä»¬é€šè¿‡ NFT çš„å±æ€§å€¼ &lt;code&gt;is_chicken&lt;/code&gt; æ¥å°†ä¸åŒçš„NFTæ”¾ç½®åˆ°ä¸åŒçš„å®¹å™¨ä¸­ã€‚å…¶ä¸­ï¼Œç‹ç‹¸æ”¾ç½®åœ¨ Pack ä¸­ï¼Œé¸¡æ”¾ç½®åœ¨ Barn ä¸­ã€‚æ¯ä¸€ä¸ª NFT åœ¨æ”¾ç½®çš„åŒæ—¶è®°å½•å¯¹åº”çš„ owner åœ°å€å’Œç”¨äºè®¡ç®—è´¨æŠ¼æ”¶ç›Šçš„æ—¶é—´æˆ³ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äº &lt;code&gt;Barn&lt;/code&gt;ï¼Œé™¤äº†è®°å½• NFT å¯¹è±¡ &lt;code&gt;ID&lt;/code&gt; ä¸ &lt;code&gt;Stake&lt;/code&gt; ä¹‹é—´å¯¹åº”å…³ç³»çš„ &lt;code&gt;items&lt;/code&gt;ï¼Œè¿˜å¢åŠ äº†ä¸€ä¸ª &lt;code&gt;dynamic_field&lt;/code&gt;ï¼Œç”¨äºè®°å½• owner åœ°å€æ‰€æœ‰è´¨æŠ¼çš„ NFT çš„æ•°ç»„ï¼š &lt;code&gt;dynamic_field: &amp;lt;address, vector&amp;lt;ID&amp;gt;&amp;gt;&lt;/code&gt; ã€‚&lt;/p&gt;
&lt;p&gt;åŒç†ï¼Œ&lt;code&gt;Pack&lt;/code&gt; ä¹Ÿç”¨ &lt;code&gt;items&lt;/code&gt; è®°å½•äº†è´¨æŠ¼çš„æ‰€æœ‰ NFTï¼Œç”¨ Alpha è¿›è¡Œäº†åˆ†ç±»å­˜å‚¨ï¼Œåœ¨ &lt;code&gt;ObjectTable&amp;lt;u8, ObjectTable&amp;lt;u64, Stake&amp;gt;&amp;gt;&lt;/code&gt; çš„ç»“æ„ä¸­ï¼Œç¬¬ä¸€ä¸ª &lt;code&gt;u8&lt;/code&gt; å¯¹åº”äº Alpha å€¼ï¼Œç¬¬äºŒä¸ª &lt;code&gt;ObjectTable&amp;lt;u64, Stake&amp;gt;&lt;/code&gt; åˆ™æ˜¯ç”¨ &lt;code&gt;ObjectTable&lt;/code&gt; å®ç°äº† &lt;code&gt;vector&lt;/code&gt; çš„åŠŸèƒ½ï¼Œ&lt;code&gt;u64&lt;/code&gt; å¯¹åº” &lt;code&gt;Stake&lt;/code&gt; çš„ç´¢å¼•ï¼Œå› æ­¤ï¼Œitem_size è¿™ä¸ªå±æ€§è®°å½•äº†æ¯ä¸ª Alpha å€¼å¯¹åº” &lt;code&gt;ObjectTable&lt;/code&gt; çš„å¤§å°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;pack_indices&lt;/code&gt; ç”¨äºè®°å½•æ¯ä¸ª NFT æ‰€åœ¨æ•°ç»„ä¸­çš„ç´¢å¼•ï¼Œæœ€åè¿˜æœ‰ä¸€ä¸ª &lt;code&gt;dynamic_field&lt;/code&gt; è®°å½•äº† owner åœ°å€çš„æ‰€æœ‰è´¨æŠ¼çš„ NFT çš„æ•°ç»„ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸Šå…³äº Barn å’Œ Pack çš„è®¾è®¡ç›®çš„åœ¨äºï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å½“ &lt;code&gt;FoxOrChicken&lt;/code&gt; æˆä¸º &lt;code&gt;Stake&lt;/code&gt; çš„ä¸€ä¸ªå±æ€§æ—¶ï¼Œåœ¨åŒºå—é“¾ä¸Šæ— æ³•è¿½è¸ªï¼Œå› æ­¤ï¼Œåªèƒ½é€šè¿‡ &lt;code&gt;Stake&lt;/code&gt; çš„ Object ID è¿›è¡Œè¿½è¸ªï¼Œitems éƒ½æ˜¯ä¸ºäº†ä¿è¯èƒ½ç›´æ¥é€šè¿‡ NFT çš„ Object ID æ¥å¯¹åº”åˆ° Stakeï¼›&lt;/li&gt;
&lt;li&gt;è®°å½• owner åœ°å€çš„æ‰€æœ‰è´¨æŠ¼çš„ NFT ID çš„æ•°ç»„æ˜¯ä¸ºäº†æ–¹ä¾¿åœ¨ä¸šåŠ¡ä¸­æŸ¥è¯¢æŸä¸ªåœ°å€çš„è´¨æŠ¼çš„ NFTï¼Œ&lt;code&gt;dynamic_field&lt;/code&gt; å¯ä»¥æ–¹ä¾¿æŸ¥è¯¢ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class="language-rust"&gt;        // struct to store a stake's token, owner, and earning values
    struct Stake has key, store {
        id: UID,
        item: FoxOrChicken,
        value: u64, // ç”¨äºè´¨æŠ¼æ”¶ç›Šè®¡ç®—çš„æ—¶é—´æˆ³
        owner: address,
    }

    struct Barn has key, store {
        id: UID,
        items: ObjectTable&amp;lt;ID, Stake&amp;gt;,
        // staked: Table&amp;lt;address, vector&amp;lt;ID&amp;gt;&amp;gt;, // address -&amp;gt; stake_id
    }

    struct Pack has key, store {
        id: UID,
        items: ObjectTable&amp;lt;u8, ObjectTable&amp;lt;u64, Stake&amp;gt;&amp;gt;,
        // alpha -&amp;gt; index -&amp;gt; Stake
        item_size: vector&amp;lt;u64&amp;gt;,
        // size for each alpha
        pack_indices: Table&amp;lt;ID, u64&amp;gt;,
        // staked: Table&amp;lt;address, vector&amp;lt;ID&amp;gt;&amp;gt;, // address -&amp;gt; stake_id
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æˆ‘ä»¬æ¥ä¸‹æ¥çœ‹åˆ°å¦‚ä½•è´¨æŠ¼ä¸€ä¸ª Chicken çš„ NFTï¼Œæ–¹æ³•è°ƒç”¨å±‚çº§ä¸º &lt;code&gt;stake_many_to_barn_and_pack -&amp;gt; stake_chicken_to_barn -&amp;gt; add_chicken_to_barn, record_staked&lt;/code&gt; ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-rust"&gt;// æ–‡ä»¶ï¼š Token_helper.move
        // è´¨æŠ¼å¤šä¸ª NFT
        public fun stake_many_to_barn_and_pack(
        reg: &amp;amp;mut BarnRegistry,
        barn: &amp;amp;mut Barn,
        pack: &amp;amp;mut Pack,
        tokens: vector&amp;lt;FoxOrChicken&amp;gt;,
        ctx: &amp;amp;mut TxContext,
    ) {
        let i = vec::length&amp;lt;FoxOrChicken&amp;gt;(&amp;amp;tokens);
        while (i &amp;gt; 0) {
            let token = vec::pop_back(&amp;amp;mut tokens);
            // é€šè¿‡å±æ€§ is_chicken åˆ¤æ–­è´¨æŠ¼æ–¹å‘
            if (token_helper::is_chicken(&amp;amp;token)) {
                // æ›´æ–°æ”¶ç›Š
                update_earnings(reg, ctx);
                stake_chicken_to_barn(reg, barn, token, ctx);
            } else {
                stake_fox_to_pack(reg, pack, token, ctx);
            };
            i = i - 1;
        };
        vec::destroy_empty(tokens)
    }

        fun stake_chicken_to_barn(reg: &amp;amp;mut BarnRegistry, barn: &amp;amp;mut Barn, item: FoxOrChicken, ctx: &amp;amp;mut TxContext) {
        reg.total_chicken_staked = reg.total_chicken_staked + 1;
        let stake_id = add_chicken_to_barn(reg, barn, item, ctx);
                // è®°å½• owner åœ°å€çš„æ‰€æœ‰è´¨æŠ¼çš„ NFT
        record_staked(&amp;amp;mut barn.id, sender(ctx), stake_id);
    }

        fun add_chicken_to_barn(reg: &amp;amp;mut BarnRegistry, barn: &amp;amp;mut Barn, item: FoxOrChicken, ctx: &amp;amp;mut TxContext): ID {
        let foc_id = object::id(&amp;amp;item);
        // è·å–å½“å‰æ—¶é—´æˆ³
        let value = timestamp_now(reg, ctx);
        let stake = Stake {
            id: object::new(ctx),
            item,
            value,
            owner: sender(ctx),
        };
        // ç”Ÿæˆå¹¶æ·»åŠ è´¨æŠ¼
        let stake_id = object::id(&amp;amp;stake);
        emit(FoCStaked { id: foc_id, owner: sender(ctx), value });
        object_table::add(&amp;amp;mut barn.items, foc_id, stake);
        stake_id
    }

        fun record_staked(staked: &amp;amp;mut UID, account: address, stake_id: ID) {
        if (dof::exists_(staked, account)) {
            vec::push_back(dof::borrow_mut(staked, account), stake_id);
        } else {
            dof::add(staked, account, vec::singleton(stake_id));
        };
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åŒç†ï¼Œè´¨æŠ¼ Fox è¿›å…¥ Pack ä¸­çš„è¿‡ç¨‹ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°ï¼Œæ–¹æ³•è°ƒç”¨å±‚çº§ä¸º &lt;code&gt;stake_many_to_barn_and_pack -&amp;gt;&lt;/code&gt; &lt;code&gt;stake_fox_to_pack -&amp;gt;``add_fox_to_pack, record_staked&lt;/code&gt; ã€‚&lt;/p&gt;
&lt;h3&gt;2.5 æå– NFT&lt;/h3&gt;
&lt;p&gt;æå– Chicken NFT æ—¶ï¼Œæ–¹æ³•è°ƒç”¨å±‚çº§ä¸º &lt;code&gt;claim_many_from_barn_and_pack -&amp;gt; claim_chicken_from_barn -&amp;gt; remove_chicken_from_barn, remove_staked&lt;/code&gt; &lt;/p&gt;
&lt;p&gt;ä¸»è¦çš„è¿‡ç¨‹ä¸ºï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åˆ¤æ–­ NFT ç±»å‹ï¼Œæ ¹æ®ç±»å‹ä»ä¸åŒçš„å®¹å™¨ä¸­æå– NFTï¼›&lt;/li&gt;
&lt;li&gt;åˆ¤æ–­ NFT æ˜¯å¦å­˜åœ¨ï¼Œæ˜¯å¦è¶…è¿‡æœ€å°è´¨æŠ¼æ—¶é—´ï¼›&lt;/li&gt;
&lt;li&gt;è®¡ç®—è´¨æŠ¼æ”¶ç›Šï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœé€‰æ‹©æå– NFTï¼Œåˆ™æ”¶ç›Š50%æ¦‚ç‡è¢«ç‹ç‹¸å…¨éƒ¨æ‹¿èµ°ï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœåªæ”¶é›†é¸¡è›‹ï¼Œåˆ™éœ€è¦äº¤ 20% ä½œä¸ºä¿æŠ¤è´¹ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class="language-rust"&gt;// æ–‡ä»¶ï¼š token_helper.move
    // æå–å¤šä¸ª NFT
        public fun claim_many_from_barn_and_pack(
        foc_reg: &amp;amp;mut FoCRegistry,
        reg: &amp;amp;mut BarnRegistry,
        barn: &amp;amp;mut Barn,
        pack: &amp;amp;mut Pack,
        treasury_cap: &amp;amp;mut TreasuryCap&amp;lt;EGG&amp;gt;,
        tokens: vector&amp;lt;ID&amp;gt;,
        unstake: bool,
        ctx: &amp;amp;mut TxContext,
    ) {
        // æ›´æ–°æ”¶ç›Š
        update_earnings(reg, ctx);
        let i = vec::length&amp;lt;ID&amp;gt;(&amp;amp;tokens);
        let owed: u64 = 0;
        while (i &amp;gt; 0) {
            let token_id = vec::pop_back(&amp;amp;mut tokens);
            // é€šè¿‡ ID åˆ¤æ–­æ˜¯å¦ä¸º chickena
            // è®¡ç®—æå–æ”¶ç›Š owed
            if (token_helper::is_chicken_from_id(foc_reg, token_id)) {
                owed = owed + claim_chicken_from_barn(reg, barn, token_id, unstake, ctx);
            } else {
                owed = owed + claim_fox_from_pack(foc_reg, reg, pack, token_id, unstake, ctx);
            };
            i = i - 1;
        };
        // æ ¹æ® owed çš„æ•°é‡ä¸ºåœ°å€é“¸é€  EGG ä»£å¸
        if (owed == 0) { return };
        egg::mint(treasury_cap, owed, sender(ctx), ctx);
        vec::destroy_empty(tokens)
    }

        fun claim_chicken_from_barn(
        reg: &amp;amp;mut BarnRegistry,
        barn: &amp;amp;mut Barn,
        foc_id: ID,
        unstake: bool,
        ctx: &amp;amp;mut TxContext
    ): u64 {
        // åˆ¤æ–­éœ€è¦æå–çš„ NFT æ˜¯å¦å­˜åœ¨
        assert!(object_table::contains(&amp;amp;barn.items, foc_id), ENOT_IN_PACK_OR_BARN);
        let stake_time = get_chicken_stake_value(barn, foc_id);
        let timenow = timestamp_now(reg, ctx);
        // åˆ¤æ–­æ˜¯å¦è¶…è¿‡äº† 48 å°æ—¶çš„æœ€å°è´¨æŠ¼æ—¶é—´
        assert!(!(unstake &amp;amp;&amp;amp; timenow - stake_time &amp;lt; MINIMUM_TO_EXIT), ESTILL_COLD);
        let owed: u64;
        // åˆ¤æ–­æ˜¯å¦è¶…è¿‡äº†æœ€å¤§ EGG é“¸é€ é‡ï¼Œå¹¶è®¡ç®—è´¨æŠ¼æ‰€å¾—
        if (reg.total_egg_earned &amp;lt; MAXIMUM_GLOBAL_EGG) {
            owed = (timenow - stake_time) * DAILY_EGG_RATE / ONE_DAY_IN_SECOND;
        } else if (stake_time &amp;gt; reg.last_claim_timestamp) {
            owed = 0; // $WOOL production stopped already
        } else {
            // stop earning additional $EGG if it's all been earned
            owed = (reg.last_claim_timestamp - stake_time) * DAILY_EGG_RATE / ONE_DAY_IN_SECOND;
        };
                
        if (unstake) {
            // å¦‚æœè¿›è¡Œæå–ï¼Œåˆ™æœ‰50%çš„æ¦‚ç‡ EGG å…¨éƒ¨è¢«ç›—èµ°
            let id = object::new(ctx);
            // FIXME
            if (random::rand_u64_range_with_seed(hash(object::uid_to_bytes(&amp;amp;id)), 0, 2) == 0) {
                // 50% chance of all $EGG stolen
                pay_fox_tax(reg, owed);
                owed = 0;
            };
            object::delete(id);
            // æ›´æ–°è´¨æŠ¼æ•°æ®ï¼Œå¹¶ç§»é™¤è´¨æŠ¼ï¼Œè½¬ç§» NFT ç»™ owner åœ°å€
            reg.total_chicken_staked = reg.total_chicken_staked - 1;
            let (item, stake_id) = remove_chicken_from_barn(barn, foc_id, ctx);
            remove_staked(&amp;amp;mut barn.id, sender(ctx), stake_id);
            transfer::transfer(item, sender(ctx));
        } else {
             // å¦‚æœåªæ˜¯æ”¶é›† EGGï¼Œåˆ™ 20% ä½œä¸ºä¿æŠ¤è´¹äº¤ç»™ç‹ç‹¸
            // percentage tax to staked foxes
            pay_fox_tax(reg, owed * EGG_CLAIM_TAX_PERCENTAGE / 100);
            // remainder goes to Chicken owner
            owed = owed * (100 - EGG_CLAIM_TAX_PERCENTAGE) / 100;
            // é‡è®¾è´¨æŠ¼çŠ¶æ€
            set_chicken_stake_value(barn, foc_id, timenow);
        };
        emit(FoCClaimed { id: foc_id, earned: owed, unstake });
        owed
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åŒç†ï¼Œä» Pack ä¸­æå– Fox  ä¸­çš„è¿‡ç¨‹ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°ã€‚&lt;/p&gt;
&lt;h3&gt;2.6 åˆ›å»º EGG ä»£å¸å’Œæ”¶é›† EGG ä»£å¸&lt;/h3&gt;
&lt;p&gt;EGG ä»£å¸åˆ›å»ºè¿‡ç¨‹ä½¿ç”¨äº† one-time-witness æ¨¡å¼ï¼Œå…·ä½“å¯ä»¥å‚è€ƒï¼š&lt;a href="https://mp.weixin.qq.com/s/OXLyiUKzpFzAzc-PVxLvTA"&gt;Move é«˜é˜¶è¯­æ³• | å…±å­¦è¯¾ä¼˜ç§€ç¬”è®°&lt;/a&gt; ä¸­çš„ Witness æ¨¡å¼ä¸€èŠ‚ã€‚&lt;/p&gt;
&lt;p&gt;ä»£å¸çš„é“¸é€ èƒ½åŠ› &lt;code&gt;treasury_cap: TreasuryCap&amp;lt;EGG&amp;gt;&lt;/code&gt; ä¿å­˜ä¸ºå…±äº«å¯¹è±¡ï¼Œä½†æ˜¯ &lt;code&gt;mint&lt;/code&gt; å’Œ &lt;code&gt;burn&lt;/code&gt; æ–¹æ³•té€šè¿‡ &lt;code&gt;friend&lt;/code&gt; å…³é”®å­—é™åˆ¶äº†åªèƒ½åœ¨ &lt;code&gt;fox&lt;/code&gt; å’Œ &lt;code&gt;barn&lt;/code&gt; æ¨¡å—ä¸­è°ƒç”¨ï¼Œå› æ­¤æ§åˆ¶äº†ä»£å¸çš„äº§ç”Ÿå’Œé”€æ¯çš„æƒé™ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-rust"&gt;// æ–‡ä»¶ï¼š egg.move
module fox_game::egg {
    use std::option;
    use sui::coin::{Self, Coin, TreasuryCap};
    use sui::transfer;
    use sui::tx_context::TxContext;

    friend fox_game::fox;
    friend fox_game::barn;

    struct EGG has drop {}

    fun init(witness: EGG, ctx: &amp;amp;mut TxContext) {
        let (treasury_cap, metadata) = coin::create_currency&amp;lt;EGG&amp;gt;(
            witness,
            9,
            b&amp;quot;EGG&amp;quot;,
            b&amp;quot;Fox Game Egg&amp;quot;,
            b&amp;quot;Fox game egg coin&amp;quot;,
            option::none(),
            ctx
        );
        transfer::freeze_object(metadata);
        transfer::share_object(treasury_cap)
    }

    /// Manager can mint new coins
    public(friend) fun mint(
        treasury_cap: &amp;amp;mut TreasuryCap&amp;lt;EGG&amp;gt;, amount: u64, recipient: address, ctx: &amp;amp;mut TxContext
    ) {
        coin::mint_and_transfer(treasury_cap, amount, recipient, ctx)
    }

    /// Manager can burn coins
    public(friend) fun burn(treasury_cap: &amp;amp;mut TreasuryCap&amp;lt;EGG&amp;gt;, coin: Coin&amp;lt;EGG&amp;gt;) {
        coin::burn(treasury_cap, coin);
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;2.7 åˆå§‹åŒ–æ–¹æ³•å’Œ entry æ–¹æ³•&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;fox&lt;/code&gt; æ¨¡å—ä½œä¸ºæ•´ä¸ªåŒ…çš„å…¥å£æ¨¡å—ï¼Œå°†å¯¹æ‰€æœ‰æ¨¡å—è¿›è¡Œåˆå§‹åŒ–ï¼Œå¹¶æä¾› entry æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬åœ¨ fox æ¨¡å—ä¸­è®¾ç½®äº† &lt;code&gt;Global&lt;/code&gt; ä½œä¸ºå…¨å±€å‚æ•°çš„ç»“æ„ä½“ï¼Œç”¨æ¥ä¿å­˜ä¸åŒæ¨¡å—éœ€è¦ç”¨åˆ°çš„ä¸åŒå¯¹è±¡ï¼Œä¸€æ¥æ–¹ä¾¿æˆ‘ä»¬çœ‹åˆ°ç³»ç»Ÿéœ€è¦å¤„ç†çš„å¯¹è±¡ä¿¡æ¯ï¼ŒäºŒæ¥å‡å°‘äº†æ–¹æ³•è°ƒç”¨æ—¶éœ€è¦ä¼ å…¥çš„å‚æ•°ä¸ªæ•°ï¼Œé€šè¿‡Globalå¯¹è±¡å°†ä¸åŒæ¨¡å—çš„å¯¹è±¡è¿›è¡Œåˆ†å‘ï¼Œå¯ä»¥æœ‰æ•ˆå‡å°‘ä»£ç å¤æ‚åº¦ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-rust"&gt;// æ–‡ä»¶: fox.move
        struct Global has key {
        id: UID,
        minting_enabled: bool,
        balance: Balance&amp;lt;SUI&amp;gt;,
        pack: Pack,
        barn: Barn,
        barn_registry: BarnRegistry,
        foc_registry: FoCRegistry,
    }

    fun init(ctx: &amp;amp;mut TxContext) {
        // åˆå§‹åŒ– FoC ç®¡ç†æƒé™
        transfer(token_helper::init_foc_manage_cap(ctx), sender(ctx));
        // åˆå§‹åŒ–å…¨å±€è®¾ç½®
        share_object(Global {
            id: object::new(ctx),
            minting_enabled: true,
            balance: balance::zero(),
            barn_registry: barn::init_barn_registry(ctx),
            pack: barn::init_pack(ctx),
            barn: barn::init_barn(ctx),
            foc_registry: token_helper::init_foc_registry(ctx),
        });
        // åˆå§‹åŒ–æ—¶é—´è®¾ç½®æƒé™
        transfer(config::init_time_manager_cap(ctx), @0xa3e46ec682bb5082849c240d2f2d20b0f6e054aa);
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;é™¤äº†ä¹‹å‰ä»‹ç»è¿‡çš„ mint æ–¹æ³•ï¼Œæˆ‘ä»¬è¿˜æä¾›ç”¨äºè´¨æŠ¼å’Œæå– NFT çš„ entry æ–¹æ³•ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-rust"&gt;// æ–‡ä»¶ï¼š fox.move
        public entry fun add_many_to_barn_and_pack(
        global: &amp;amp;mut Global,
        tokens: vector&amp;lt;FoxOrChicken&amp;gt;,
        ctx: &amp;amp;mut TxContext,
    ) {
        barn::stake_many_to_barn_and_pack(&amp;amp;mut global.barn_registry, &amp;amp;mut global.barn, &amp;amp;mut global.pack, tokens, ctx);
    }

    public entry fun claim_many_from_barn_and_pack(
        global: &amp;amp;mut Global,
        treasury_cap: &amp;amp;mut TreasuryCap&amp;lt;EGG&amp;gt;,
        tokens: vector&amp;lt;ID&amp;gt;,
        unstake: bool,
        ctx: &amp;amp;mut TxContext,
    ) {
        barn::claim_many_from_barn_and_pack(
            &amp;amp;mut global.foc_registry,
            &amp;amp;mut global.barn_registry,
            &amp;amp;mut global.barn,
            &amp;amp;mut global.pack,
            treasury_cap,
            tokens,
            unstake,
            ctx
        );
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;2.8 æ—¶é—´æˆ³é—®é¢˜&lt;/h3&gt;
&lt;p&gt;ç›®å‰ Sui åŒºå—é“¾è¿˜æ²¡æœ‰å®Œå…¨å®ç°åŒºå—æ—¶é—´ï¼Œè€Œç›®å‰æä¾›çš„ &lt;code&gt;tx_context::epoch()&lt;/code&gt; çš„ç²¾åº¦ä¸º24å°æ—¶ï¼Œæ— æ³•æ»¡è¶³æ¸¸æˆéœ€æ±‚ã€‚å› æ­¤åœ¨æ¸¸æˆä¸­ï¼Œæˆ‘ä»¬é€šè¿‡æ‰‹åŠ¨è®¾ç½®æ—¶é—´æˆ³æ¥æ¨¡æ‹Ÿæ—¶é—´å¢åŠ ï¼Œä»¥ç¡®ä¿æ¸¸æˆé¡ºåˆ©è¿›è¡Œã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-rust"&gt;// æ–‡ä»¶: barn.move

        struct BarnRegistry has key, store {
        id: UID,
        // å…¶ä»–å±æ€§çœç•¥
        // fake_timestamp
        timestamp: u64,
    }
        public(friend) fun set_timestamp(reg: &amp;amp;mut BarnRegistry, current: u64, _ctx: &amp;amp;mut TxContext) {
        reg.timestamp = current;
    }
        // å½“å‰æ—¶é—´æˆ³
    fun timestamp_now(reg: &amp;amp;mut BarnRegistry, _ctx: &amp;amp;mut TxContext): u64 {
        reg.timestamp
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åœ¨åˆå§‹åŒ–æ—¶ï¼Œå°†è®¾ç½®æ—¶é—´çš„èƒ½åŠ›ç»™åˆ°äº†ä¸€ä¸ªé¢„å…ˆç”Ÿæˆçš„ä¸“é—¨ç”¨äºè®¾ç½®æ—¶é—´æˆ³çš„åœ°å€ &lt;code&gt;0xa3e46ec682bb5082849c240d2f2d20b0f6e054aa&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-rust"&gt;// æ–‡ä»¶: config.move
        // Manager cap to set time
    struct TimeManagerCap has key, store { id: UID }

    public(friend) fun init_time_manager_cap(ctx: &amp;amp;mut TxContext): TimeManagerCap {
        TimeManagerCap { id: object::new(ctx) }
    }

// æ–‡ä»¶: fox.move
        fun init(ctx: &amp;amp;mut TxContext) {
        transfer(config::init_time_manager_cap(ctx), @0xa3e46ec682bb5082849c240d2f2d20b0f6e054aa);
    }

        public entry fun set_timestamp(_: &amp;amp;TimeManagerCap, global: &amp;amp;mut Global, current: u64, ctx: &amp;amp;mut TxContext) {
        barn::set_timestamp(&amp;amp;mut global.barn_registry, current, ctx)
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®å®šæ—¶ä»»åŠ¡è¿›è¡Œæ—¶é—´æˆ³æ›´æ–°ï¼Œé€šè¿‡è°ƒç”¨è®¾ç½®æ—¶é—´çš„å‘½ä»¤è¿›è¡Œï¼Œè¯¦ç»†ç»“æœå¯ä»¥æŸ¥çœ‹ 3.2 èŠ‚åˆçº¦å‘½ä»¤è¡Œè°ƒç”¨ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-bash"&gt;sui client call --function set_timestamp --module fox --package ${fox_game} --args ${time_cap} ${global} \&amp;quot;$(date +%s)\&amp;quot; --gas-budget 30000
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è‡³æ­¤ï¼Œæˆ‘ä»¬ä»‹ç»äº†åˆçº¦éƒ¨åˆ†çš„ä¸»è¦åŠŸèƒ½ï¼Œè¯¦ç»†çš„ä»£ç å¯ä»¥é˜…è¯»é¡¹ç›®ä»“åº“ã€‚&lt;/p&gt;
&lt;h2&gt;0x3 åˆçº¦éƒ¨ç½²å’Œè°ƒç”¨&lt;/h2&gt;
&lt;p&gt;ä¸‹é¢ï¼Œæˆ‘ä»¬é¦–å…ˆå°†éƒ¨ç½²åˆçº¦ï¼Œå¹¶é€šè¿‡å‘½ä»¤è¡Œè¿›è¡Œæ–¹æ³•çš„è°ƒç”¨ã€‚&lt;/p&gt;
&lt;h3&gt;3.1 åˆçº¦éƒ¨ç½²&lt;/h3&gt;
&lt;p&gt;é€šè¿‡ä»¥ä¸‹å‘½ä»¤å¯ä»¥ç¼–è¯‘å’Œéƒ¨ç½²åˆçº¦ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-bash"&gt;sui move build
sui client publish . --gas-budget 300000
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¾“å‡ºç»“æœä¸ºï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-bash"&gt;$ sui client publish . --gas-budget 300000
UPDATING GIT DEPENDENCY https://github.com/MystenLabs/sui.git
INCLUDING DEPENDENCY MoveStdlib
INCLUDING DEPENDENCY Sui
BUILDING fox_game
----- Certificate ----
Transaction Hash: 5FZi4YxiiBJsCj67JSSzkVZvHdJjKKPtMMMrfGbmPXvH
Transaction Signature: AA==@G9yAoybgfIEi7Wj8HFYeEFwG5WPtJ4FlJ+/jaMXFPyjWg4pUun3WQpB4VH5gim/FzqspMY7QAJcd0iTyJ910Dw==@htyihgkhXVia7MCmWeGtDeU96b7w1ivXPKBAV37DZoo=
Signed Authorities Bitmap: RoaringBitmap&amp;lt;[0, 1, 2]&amp;gt;
Transaction Kind : Publish
Sender: 0xefbb0d3f2dc566f1f4fa844621bee76b43c9579a
Gas Payment: Object ID: 0x0942e72397f46a831ce61003601cbb05697e7a83, version: 0x20f, digest: 0xc318f23ac2772738efe1b958be0b51e3c49d9c772d5aede9f41e1dc69edeb2ea
Gas Price: 1
Gas Budget: 300000
----- Transaction Effects ----
Status : Success
Created Objects:
    - çœç•¥äº†å…¶ä»–çš„åˆ›å»ºçš„å¯¹è±¡
  - ID: 0x17db4feb4652b8b5ce9ebf6dc7d29463b08e234e , Owner: Shared
  - ID: 0x1d525318e381f93dd2b2f043d2ed96400b4f16d9 , Owner: Immutable
  - ID: 0x59a85fbef4bc17cd73f8ff89d227fdcd6226c885 , Owner: Immutable
  - ID: 0xe364474bd00b7544b9393f0a2b0af2dbea143fd3 , Owner: Account Address ( 0xa3e46ec682bb5082849c240d2f2d20b0f6e054aa )
  - ID: 0xe4ffefc480e20129ff7893d7fd550b17fda0ab0f , Owner: Shared
  - ID: 0xe572b53c8fa93602ae97baca3a94e231c2917af6 , Owner: Account Address ( 0xefbb0d3f2dc566f1f4fa844621bee76b43c9579a )
Mutated Objects:
  - ID: 0x0942e72397f46a831ce61003601cbb05697e7a83 , Owner: Account Address ( 0xefbb0d3f2dc566f1f4fa844621bee76b43c9579a )
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¯ä»¥é€šè¿‡äº¤æ˜“å“ˆå¸Œ &lt;code&gt;5FZi4YxiiBJsCj67JSSzkVZvHdJjKKPtMMMrfGbmPXvH&lt;/code&gt; åœ¨ sui explorer ä¸­æŸ¥çœ‹éƒ¨ç½²çš„åˆçº¦ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src="https://user-images.githubusercontent.com/3297411/215304390-507211a2-638c-4c97-ae58-56ea419e8fcd.png" alt="Untitled 1" /&gt;&lt;/p&gt;
&lt;p&gt;é€šè¿‡ &lt;code&gt;sui client object &amp;lt;object_id&amp;gt;&lt;/code&gt; å¯ä»¥æŸ¥çœ‹åˆ›å»ºçš„ object çš„å±æ€§ï¼Œå¯ä»¥çŸ¥é“ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;0x17db4feb4652b8b5ce9ebf6dc7d29463b08e234e&lt;/code&gt; ä¸ºä»£å¸ EGG çš„ TreasuryCap çš„ ObjectId&lt;/li&gt;
&lt;li&gt;&lt;code&gt;0x1d525318e381f93dd2b2f043d2ed96400b4f16d9&lt;/code&gt; ä¸º EGG çš„ CoinMetadata&lt;/li&gt;
&lt;li&gt;&lt;code&gt;0x59a85fbef4bc17cd73f8ff89d227fdcd6226c885&lt;/code&gt; ä¸ºéƒ¨ç½²çš„åœ°å€&lt;/li&gt;
&lt;li&gt;&lt;code&gt;0xe364474bd00b7544b9393f0a2b0af2dbea143fd3&lt;/code&gt; ä¸º TimeManagerCap&lt;/li&gt;
&lt;li&gt;&lt;code&gt;0xe4ffefc480e20129ff7893d7fd550b17fda0ab0f&lt;/code&gt; ä¸º Global å¯¹è±¡&lt;/li&gt;
&lt;li&gt;&lt;code&gt;0xe572b53c8fa93602ae97baca3a94e231c2917af6&lt;/code&gt; ä¸º FoCManagerCap å¯¹è±¡&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™äº›å¯¹è±¡å°†åœ¨ä¹‹åçš„å‘½ä»¤è¡Œè°ƒç”¨å’Œå‰ç«¯é¡¹ç›®ä¸­ä½¿ç”¨åˆ°ã€‚å…¶ä»–çœç•¥çš„åˆ›å»ºçš„å¯¹è±¡ä¸º Trait å¯¹è±¡ï¼Œåœ¨ä¹‹åä¸ä¼šä½¿ç”¨åˆ°ã€‚&lt;/p&gt;
&lt;h3&gt;3.2 åˆçº¦å‘½ä»¤è¡Œè°ƒç”¨&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;è®¾ç½®ç¯å¢ƒå˜é‡&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-bash"&gt;export fox_game=0x59a85fbef4bc17cd73f8ff89d227fdcd6226c885
export global=0xe4ffefc480e20129ff7893d7fd550b17fda0ab0f
export egg_treasury=0x17db4feb4652b8b5ce9ebf6dc7d29463b08e234e
export time_cap=0xe364474bd00b7544b9393f0a2b0af2dbea143fd3
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è®¾ç½®æ—¶é—´æˆ³&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-bash"&gt;# éœ€è¦åˆ‡æ¢åˆ°æ—¶é—´æˆ³çš„ç®¡ç†åœ°å€ 0xa3e46ec682bb5082849c240d2f2d20b0f6e054aa
sui client switch --address 0xa3e46ec682bb5082849c240d2f2d20b0f6e054aa
# è®¾ç½®æ—¶é—´æˆ³
sui client call --function set_timestamp --module fox --package ${fox_game} --args ${time_cap} ${global} \&amp;quot;$(date +%s)\&amp;quot; --gas-budget 30000

# æŸ¥çœ‹å½“å‰æ—¶é—´æˆ³
curl https://fullnode.devnet.sui.io:443 -H &amp;quot;Content-Type: application/json&amp;quot; -d '{
  &amp;quot;jsonrpc&amp;quot;: &amp;quot;2.0&amp;quot;,
  &amp;quot;id&amp;quot;: 1,
  &amp;quot;method&amp;quot;: &amp;quot;sui_getObject&amp;quot;,
  &amp;quot;params&amp;quot;:[
      &amp;quot;0xe4ffefc480e20129ff7893d7fd550b17fda0ab0f&amp;quot;
  ]
}' | jq .result.details.data.fields.barn_registry

# è¾“å‡ºç»“æœï¼Œå¯ä»¥çœ‹åˆ°æ—¶é—´æˆ³å·²ç»è¢«è®¾ç½®ä¸º 1674831518
{
  &amp;quot;type&amp;quot;: &amp;quot;0x59a85fbef4bc17cd73f8ff89d227fdcd6226c885::barn::BarnRegistry&amp;quot;,
  &amp;quot;fields&amp;quot;: {
    &amp;quot;egg_per_alpha&amp;quot;: &amp;quot;0&amp;quot;,
    &amp;quot;id&amp;quot;: {
      &amp;quot;id&amp;quot;: &amp;quot;0x48136d916ea8a148ab864fdb1fc668f6e6dcf3ff&amp;quot;
    },
    &amp;quot;last_claim_timestamp&amp;quot;: &amp;quot;0&amp;quot;,
    &amp;quot;timestamp&amp;quot;: &amp;quot;1674831518&amp;quot;,
    &amp;quot;total_alpha_staked&amp;quot;: &amp;quot;0&amp;quot;,
    &amp;quot;total_chicken_staked&amp;quot;: &amp;quot;0&amp;quot;,
    &amp;quot;total_egg_earned&amp;quot;: &amp;quot;0&amp;quot;,
    &amp;quot;unaccounted_rewards&amp;quot;: &amp;quot;8518518&amp;quot;
  }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä¹‹åçš„æ¯ä¸€æ­¥æ“ä½œå‰éƒ½éœ€è¦åŒæ­¥ä¸€æ¬¡æ—¶é—´æˆ³ï¼Œä¿è¯æ•°æ®æ­£ç¡®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é“¸é€  NFT&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œé“¸é€ ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-bash"&gt;# æŸ¥çœ‹å½“å‰gas
sui client switch --address 0x659f89084673bf4a993cdea89a94dabf93a2ddb4
sui client gas

# è¾“å‡ºç»“æœ
Object ID                  |  Gas Value 
----------------------------------------------------------------------
 0x0bd32adfbfc73e8daa42eef21b4e4e6cc7081240 |    25219   
 0x2ad1e472502aefd87c3767157391ebc1f169c6b5 |   9928743  
 0x3cd2bb1e03326e5141203cc008e6d2eb44a0df05 |  10000000  
 0x5f2c80c89bedddf92f0dc32cfa16b0ecf76a4680 |  10000000  
 0x635ce8d2e9a9c0056ff1cd8591baee16fe010911 |  10000000

# Mint 1 ä¸ª NFT
sui client call --function mint --module fox --package ${fox_game} --args ${global} ${egg_treasury} \&amp;quot;1\&amp;quot; false \[0x3cd2bb1e03326e5141203cc008e6d2eb44a0df05\] \[\] --gas-budget 100000

# ç»“æœ
----- Certificate ----
Transaction Hash: 7p1nmTPYE9884gBCJL6sah2t6Vzh9P59MUeFVURXaEFx
Transaction Signature: AA==@TNx7guUd7EjEg4s8jyOf+kTkuhVqmzrZWGKzcJNM3iHqcCRk0+pzITmFth8dYM6qKnYAvT3eeSkKNDUaQF2LAA==@oC1nequkpzyJfYuKx7DqIZFNUfF66e+6DEF1Urqo/EM=
Signed Authorities Bitmap: RoaringBitmap&amp;lt;[1, 2, 3]&amp;gt;
Transaction Kind : Call
Package ID : 0x59a85fbef4bc17cd73f8ff89d227fdcd6226c885
Module : fox
Function : mint
Arguments : [&amp;quot;0xe4ffefc480e20129ff7893d7fd550b17fda0ab0f&amp;quot;, &amp;quot;0x17db4feb4652b8b5ce9ebf6dc7d29463b08e234e&amp;quot;, [1,0,0,0,0,0,0,0], &amp;quot;&amp;quot;, [&amp;quot;0x3cd2bb1e03326e5141203cc008e6d2eb44a0df05&amp;quot;], []]
Type Arguments : []
Sender: 0x659f89084673bf4a993cdea89a94dabf93a2ddb4
Gas Payment: Object ID: 0x2ad1e472502aefd87c3767157391ebc1f169c6b5, version: 0x215, digest: 0x197c624ca59151af7cd968b985062fa3e0dbf21711777d7b4602215664233c5b
Gas Price: 1
Gas Budget: 100000
----- Transaction Effects ----
Status : Success
Created Objects:
  - ID: 0x185aa8a244c74ddfe83c38618b46c744425cd7f5 , Owner: Object ID: ( 0x2ba674fcac290baa2927ff26110463f337237f0d )
  - ID: 0x6917cbcf0e6e58184a98e05ad6bbc70a75755d28 , Owner: Object ID: ( 0x2ed343ceebf792a36b2ff0e918b801e34399f4ed )
  - ID: 0x84fe8e597bcb9387b2911b5ef39b90bb111e71a2 , Owner: Account Address ( 0x659f89084673bf4a993cdea89a94dabf93a2ddb4 )
Mutated Objects:
  - ID: 0x17db4feb4652b8b5ce9ebf6dc7d29463b08e234e , Owner: Shared
  - ID: 0x2ad1e472502aefd87c3767157391ebc1f169c6b5 , Owner: Account Address ( 0x659f89084673bf4a993cdea89a94dabf93a2ddb4 )
  - ID: 0x3cd2bb1e03326e5141203cc008e6d2eb44a0df05 , Owner: Account Address ( 0x659f89084673bf4a993cdea89a94dabf93a2ddb4 )
  - ID: 0xe4ffefc480e20129ff7893d7fd550b17fda0ab0f , Owner: Shared
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å…¶ä¸­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;\&amp;quot;1\&amp;quot;&lt;/code&gt; è¡¨ç¤ºé“¸é€ çš„æ•°é‡ä¸º 1ï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;false&lt;/code&gt; è¡¨ç¤ºä¸è´¨æŠ¼ï¼Œå¦‚æœè¦é“¸é€ çš„åŒæ—¶è¿›è¡Œè´¨æŠ¼ï¼Œå¯ä»¥ä¿®æ”¹ä¸º &lt;code&gt;true&lt;/code&gt;ï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;\[0x3cd2bb1e03326e5141203cc008e6d2eb44a0df05\]&lt;/code&gt; æ˜¯ç”¨äºæ”¯ä»˜ 0.0099 SUI é“¸é€ è´¹ç”¨çš„ SUI å¯¹è±¡ï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;\[\]&lt;/code&gt; è¡¨ç¤ºç”¨äºæ”¯ä»˜ &lt;code&gt;EGG&lt;/code&gt; çš„å¯¹è±¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°ç”Ÿæˆçš„å¯¹è±¡ä¸­ï¼Œ &lt;code&gt;0x84fe8e597bcb9387b2911b5ef39b90bb111e71a2&lt;/code&gt; åœ¨åœ°å€ &lt;code&gt;0x659f89084673bf4a993cdea89a94dabf93a2ddb4&lt;/code&gt; ä¹‹ä¸‹ï¼ŒæŸ¥çœ‹å±æ€§å¯ä»¥çœ‹åˆ°å¯¹åº”çš„ type ä¸º &lt;code&gt;0x59a85fbef4bc17cd73f8ff89d227fdcd6226c885::token_helper::FoxOrChicken&lt;/code&gt; ï¼Œè¿™ä¸ªå°±æ˜¯æˆ‘ä»¬é“¸é€ å¾—åˆ°çš„ NFTï¼Œç›¸åº”çš„å…¶ä»–å±æ€§ä¹Ÿå¯ä»¥æŸ¥çœ‹åˆ°ï¼Œå‘½ä»¤è¾“å‡ºç»“æœå¯ä»¥æŸ¥çœ‹æ­¤ &lt;a href="https://gist.github.com/qiwihui/86e7385c635f88b539ed2f032018ca28"&gt;gist&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æˆ–è€…ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ &lt;code&gt;sui_getObjectsOwnedByAddress&lt;/code&gt; RPC æ¥å£å¯ä»¥æŸ¥çœ‹åœ°å€æ‰€æ‹¥æœ‰çš„å¯¹è±¡ï¼Œæ¯”å¦‚å¯¹äºåœ°å€ &lt;code&gt;0x659f89084673bf4a993cdea89a94dabf93a2ddb4&lt;/code&gt; ï¼Œå¯ä»¥æŸ¥çœ‹æ‰€æœ‰å¯¹è±¡ï¼Œè¿‡æ»¤å³å¯æ‰¾åˆ°åˆ›å»ºçš„å¯¹è±¡ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-bash"&gt;$ curl https://fullnode.devnet.sui.io:443 -H &amp;quot;Content-Type: application/json&amp;quot; -d '{
  &amp;quot;jsonrpc&amp;quot;: &amp;quot;2.0&amp;quot;,
  &amp;quot;id&amp;quot;: 1,
  &amp;quot;method&amp;quot;: &amp;quot;sui_getObjectsOwnedByAddress&amp;quot;,
  &amp;quot;params&amp;quot;:[
      &amp;quot;0x659f89084673bf4a993cdea89a94dabf93a2ddb4&amp;quot;
  ]
}'
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è´¨æŠ¼ NFT&lt;/p&gt;
&lt;p&gt;é€šè¿‡ä»¥ä¸‹å‘½ä»¤å¯¹å‰ä¸€æ­¥é“¸é€ çš„ NFT è¿›è¡Œè´¨æŠ¼ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-bash"&gt;sui client call --function add_many_to_barn_and_pack --module fox --package ${fox_game} --args ${global} \[0x84fe8e597bcb9387b2911b5ef39b90bb111e71a2\] --gas-budget 100000
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è·å–æ”¶ç›Šå’Œ æå– NFT&lt;/p&gt;
&lt;p&gt;é€šè¿‡ä»¥ä¸‹å‘½ä»¤è·å–è´¨æŠ¼æ”¶ç›Š EGGï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-bash"&gt;sui client call --function claim_many_from_barn_and_pack --module fox --package ${fox_game} --args ${global} ${egg_treasury} '[&amp;quot;0x84fe8e597bcb9387b2911b5ef39b90bb111e71a2&amp;quot;]' false --gas-budget 100000
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç­‰ 48 å°æ—¶ä¹‹åï¼Œå°† &lt;code&gt;false&lt;/code&gt; å˜ä¸º &lt;code&gt;true&lt;/code&gt;ï¼Œå¯ä»¥è¿›è¡Œ Unstakeï¼Œå°†è´¨æŠ¼çš„ NFT æå–å‡ºæ¥ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è‡³æ­¤ï¼Œå‘½ä»¤è¡Œæ“ä½œå®Œæˆã€‚&lt;/p&gt;
&lt;h2&gt;0x4 å‰ç«¯å¼€å‘&lt;/h2&gt;
&lt;h3&gt;4.1 scaffold-move å¼€å‘è„šæ‰‹æ¶&lt;/h3&gt;
&lt;p&gt;è¿™ä¸ªé¡¹ç›®åŸºäº NonceGeek DAO çš„ scaffold-move å¼€å‘è„šæ‰‹æ¶ï¼Œè¿™ä¸ªè„šæ‰‹æ¶ç›®å‰åŒ…å« Aptos å’Œ Sui ä¸¤ä¸ªå…¬é“¾çš„å‰ç«¯å¼€å‘å®ä¾‹ï¼Œå¯ä»¥å¯ä»¥åœ¨è¿™ä¸ªåŸºç¡€ä¸Šå¿«é€Ÿè¿›è¡Œ Sui çš„å‰ç«¯éƒ¨åˆ†å¼€å‘ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡è¿è¡Œä»¥ä¸‹æ­¥éª¤å¯ä»¥è®¾ç½®å¼€å‘ç¯å¢ƒï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-bash"&gt;git clone https://github.com/NonceGeek/scaffold-move.git
cd scaffold-move/scaffold-sui/
yarn
yarn dev
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;4.2 é¡¹ç›®é¡µé¢ç»“æ„&lt;/h3&gt;
&lt;p&gt;é¡¹ç›®é¡µé¢ä¸»è¦åŒ…æ‹¬ä¸‰éƒ¨åˆ†ï¼Œä½äº &lt;code&gt;src/pages&lt;/code&gt; ç›®å½•ï¼šindexï¼Œgame å’Œ whitepapersï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;indexï¼šå…¥å£é¡µé¢ï¼Œåšä¸ºæ¸¸æˆçš„å¼•å¯¼é¡µé¢ï¼›&lt;/li&gt;
&lt;li&gt;gameï¼šä¸»è¦çš„é€»è¾‘é¡µé¢ï¼Œæ¶‰åŠé“¸é€ ï¼Œè´¨æŠ¼å’Œæå–ï¼›&lt;/li&gt;
&lt;li&gt;whitepaperï¼šç™½çš®ä¹¦é¡µé¢ï¼Œä»‹ç»æ¸¸æˆæœºåˆ¶å’Œç©æ³•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æˆ‘ä»¬ä¹‹åçš„éƒ¨åˆ†ä¸»è¦èšç„¦åœ¨ game é¡µé¢ã€‚game é¡µé¢åŠŸèƒ½ä¸»è¦åŒ…æ‹¬ä¸‰éƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;èœå•æ ï¼šåŒ…å«logoï¼Œé¡µé¢å¯¼èˆªä»¥åŠé“¾æ¥é’±åŒ…ï¼›&lt;/li&gt;
&lt;li&gt;å·¦ä¾§ Mint æ ï¼šä¸»è¦å½“å‰ mint çŠ¶æ€å’Œ mint æ“ä½œï¼›&lt;/li&gt;
&lt;li&gt;å³ä¾§ Stake æ ï¼šä¸»è¦æ˜¯ Stakeï¼ŒUnstale å’Œ Collect EGG çš„æ“ä½œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src="https://user-images.githubusercontent.com/3297411/215304399-47738ec4-8dc2-4063-9d1a-fa5ab05f963b.png" alt="Untitled 2" /&gt;&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ï¼Œè´¨æŠ¼å’Œæå–æ—¶è¿›è¡Œçš„å¤šé€‰æ“ä½œï¼Œå¯ä»¥é€šè¿‡è®¾ç½®é€‰æ‹©å˜é‡è¿›è¡Œè¿‡æ»¤æ¥å®ç°ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-tsx"&gt;  const [unstakedSelected, setUnstakedSelected] = useState&amp;lt;Array&amp;lt;string&amp;gt;&amp;gt;([])
  const [stakedSelected, setStakedSelected] = useState&amp;lt;Array&amp;lt;string&amp;gt;&amp;gt;([]);
    
    // è®¾ç½®æ·»åŠ å’Œåˆ é™¤æ“ä½œ
    function addStaked(item: string) {
    setUnstakedSelected([])
    setStakedSelected([...stakedSelected, item])
  }

  function removeStaked(item: string) {
    setUnstakedSelected([])
    setStakedSelected(stakedSelected.filter(i =&amp;gt; i !== item))
  }

  function addUnstaked(item: string) {
    setStakedSelected([])
    setUnstakedSelected([...unstakedSelected, item])
  }

  function removeUnstaked(item: string) {
    setStakedSelected([])
    setUnstakedSelected(unstakedSelected.filter(i =&amp;gt; i !== item))
  }
    // ä¹‹åæ·»åŠ å…ƒç´ çš„ç‚¹å‡»äº‹ä»¶
    // å¤„ç†æœªè´¨æŠ¼çš„
  function renderUnstaked(item: any, type: string) {
    const itemIn = unstakedSelected.includes(item.objectId);
    return &amp;lt;div key={item.objectId} style={{ marginRight: &amp;quot;5px&amp;quot;, marginLeft: &amp;quot;5px&amp;quot;, border: itemIn ? &amp;quot;2px solid red&amp;quot; : &amp;quot;2px solid rgb(0,0,0,0)&amp;quot;, overflow: 'hidden', display: &amp;quot;inline-block&amp;quot; }}&amp;gt;
      &amp;lt;div className=&amp;quot;flex flex-col items-center&amp;quot;&amp;gt;
        &amp;lt;div style={{ fontSize: &amp;quot;0.75rem&amp;quot;, height: &amp;quot;1rem&amp;quot; }}&amp;gt;#{item.index}&amp;lt;/div&amp;gt;
        &amp;lt;Image src={`${item.url}`} width={48} height={48} alt={`${item.objectId}`} onClick={() =&amp;gt; itemIn ? removeUnstaked(item.objectId) : addUnstaked(item.objectId)} /&amp;gt;
      &amp;lt;/div&amp;gt;
    &amp;lt;/div&amp;gt;
  }
  // å¤„ç†è´¨æŠ¼çš„
  function renderStaked(item: any, type: string) {
    const itemIn = stakedSelected.includes(item.objectId);
    return &amp;lt;div key={item.objectId} style={{ marginRight: &amp;quot;5px&amp;quot;, marginLeft: &amp;quot;5px&amp;quot;, border: itemIn ? &amp;quot;2px solid red&amp;quot; : &amp;quot;2px solid rgb(0,0,0,0)&amp;quot;, overflow: 'hidden', display: &amp;quot;inline-block&amp;quot; }}&amp;gt;
      &amp;lt;div className=&amp;quot;flex flex-col items-center&amp;quot;&amp;gt;
        &amp;lt;div style={{ fontSize: &amp;quot;0.75rem&amp;quot;, height: &amp;quot;1rem&amp;quot; }}&amp;gt;#{item.index}&amp;lt;/div&amp;gt;
        &amp;lt;Image src={`${item.url}`} width={48} height={48} alt={`${item.objectId}`} onClick={() =&amp;gt; itemIn ? removeStaked(item.objectId) : addStaked(item.objectId)} /&amp;gt;
      &amp;lt;/div&amp;gt;
    &amp;lt;/div&amp;gt;
  }
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;4.3 è¿æ¥é’±åŒ…&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬ä½¿ç”¨ Suiet é’±åŒ…å¼€å‘çš„ &lt;code&gt;@suiet/wallet-kit&lt;/code&gt; åŒ…è¿æ¥ Sui é’±åŒ…ï¼Œä»åŒ…å¯¹åº”çš„ WalletContextState å¯ä»¥çœ‹å‡ºï¼Œ &lt;code&gt;useWallet&lt;/code&gt; åŒ…å«äº†æˆ‘ä»¬åœ¨æ„å»º App æ—¶ä¼šä½¿ç”¨åˆ°çš„åŸºæœ¬ä¿¡æ¯å’ŒåŠŸèƒ½ï¼Œæ¯”å¦‚é’±åŒ…ä¿¡æ¯ï¼Œé“¾ä¿¡æ¯ï¼Œè¿æ¥çŠ¶æ€ä¿¡æ¯ï¼Œä»¥åŠå‘é€äº¤æ˜“ï¼Œç­¾åä¿¡æ¯ç­‰ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-tsx"&gt;export interface WalletContextState {
    configuredWallets: IWallet[];
    detectedWallets: IWallet[];
    allAvailableWallets: IWallet[];
    chains: Chain[];
    chain: Chain | undefined;
    name: string | undefined;
    adapter: IWalletAdapter | undefined;
    account: WalletAccount | undefined;
    address: string | undefined;
    connecting: boolean;
    connected: boolean;
    status: &amp;quot;disconnected&amp;quot; | &amp;quot;connected&amp;quot; | &amp;quot;connecting&amp;quot;;
    select: (walletName: string) =&amp;gt; void;
    disconnect: () =&amp;gt; Promise&amp;lt;void&amp;gt;;
    getAccounts: () =&amp;gt; readonly WalletAccount[];
    signAndExecuteTransaction(transaction: SuiSignAndExecuteTransactionInput): Promise&amp;lt;SuiSignAndExecuteTransactionOutput&amp;gt;;
    signMessage: (input: {
        message: Uint8Array;
    }) =&amp;gt; Promise&amp;lt;ExpSignMessageOutput&amp;gt;;
    on: &amp;lt;E extends WalletEvent&amp;gt;(event: E, listener: WalletEventListeners[E]) =&amp;gt; () =&amp;gt; void;
}
export declare const WalletContext: import(&amp;quot;react&amp;quot;).Context&amp;lt;WalletContextState&amp;gt;;
export declare function useWallet(): WalletContextState;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åœ¨ &lt;code&gt;src/components/SuiConnect.tsx&lt;/code&gt; ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿çš„è®¾ç½®é’±åŒ…è¿æ¥åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-tsx"&gt;import {
  ConnectButton,
} from '@suiet/wallet-kit';

export function SuiConnect() {
  return (
      &amp;lt;ConnectButton&amp;gt;Connect Wallet&amp;lt;/ConnectButton&amp;gt;
  );
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä¹‹åï¼Œæˆ‘ä»¬å°†éœ€è¦ä½¿ç”¨çš„ä¿¡æ¯åœ¨ &lt;code&gt;src/pages/game.tsx&lt;/code&gt; ä¸­å¼•å…¥ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-tsx"&gt;import {
  useWallet,
} from '@suiet/wallet-kit';

export default function Home() {

  const { signAndExecuteTransaction, connected, account, status } = useWallet();

    // çœç•¥
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å…¶ä¸­ï¼Œ &lt;code&gt;signAndExecuteTransaction&lt;/code&gt; æ–¹æ³•ç”¨æ¥ç­¾åå¹¶æ‰§è¡Œäº¤æ˜“ï¼Œæ”¯æŒ &lt;code&gt;moveCall&lt;/code&gt; ï¼Œ &lt;code&gt;transferSui&lt;/code&gt;ï¼Œ &lt;code&gt;transferObject&lt;/code&gt; ç­‰äº¤æ˜“ã€‚&lt;/p&gt;
&lt;h3&gt;4.4 RPC æ¥å£è°ƒç”¨&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬ä½¿ç”¨å®˜æ–¹æä¾›çš„ &lt;code&gt;@mysten/sui.js&lt;/code&gt; åº“è°ƒç”¨ Sui çš„ RPC æ¥å£ï¼Œè¿™ä¸ªåº“æ”¯æŒäº†å¤§éƒ¨åˆ† &lt;a href="https://docs.sui.io/sui-jsonrpc"&gt;Sui JSON-RPC&lt;/a&gt;ï¼ŒåŒæ—¶ï¼Œè¿˜æä¾›äº†ä¸€äº›é¢å¤–çš„æ–¹æ³•æ–¹ä¾¿å¼€å‘ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;selectCoinsWithBalanceGreaterThanOrEqual&lt;/code&gt; ï¼šè·å–å¤§äºç­‰äºæŒ‡å®šæ•°é‡çš„coinå¯¹è±¡IDæ•°ç»„&lt;/li&gt;
&lt;li&gt;&lt;code&gt;selectCoinSetWithCombinedBalanceGreaterThanOrEqual&lt;/code&gt;ï¼šè·å–æ€»å’Œå¤§äºç­‰äºæŒ‡å®šæ•°é‡çš„coinå¯¹è±¡IDæ•°ç»„&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™ä¸¤ä¸ªæ–¹æ³•åœ¨éœ€è¦åœ¨ NFT é“¸é€ æ—¶æ”¯ä»˜ SUI æˆ–è€…å…¶ä»–ä»£å¸æ—¶ååˆ†æœ‰ç”¨ã€‚æˆ‘ä»¬åœ¨ &lt;code&gt;game.tsx&lt;/code&gt; ä¸­å¼•å…¥ JsonProvider è¿›è¡Œåˆå§‹åŒ–ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-tsx"&gt;// æ–‡ä»¶: src/pages/game.tsx
import { JsonRpcProvider } from '@mysten/sui.js';

export default function Home() {
    // æ“ä½œ client
  const provider = new JsonRpcProvider();
    // è°ƒç”¨
    const suiObjects = await provider.selectCoinSetWithCombinedBalanceGreaterThanOrEqual(account!.address, suiCost)
// å…¶ä»–çœç•¥
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å…¶ä»–æ–¹æ³•çš„ä»‹ç»å¯ä»¥å‚è€ƒåº“çš„æ–‡æ¡£ï¼Œè¿™é‡Œä¸å¤šèµ˜è¿°ã€‚&lt;/p&gt;
&lt;h3&gt;4.5 é“¸é€  NFT ç­‰ entry æ–¹æ³•&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬é¦–å…ˆçœ‹åˆ°å¦‚ä½•é“¸é€  NFTï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-tsx"&gt;// æ–‡ä»¶: src/pages/game.tsx 
  async function mint_nft() {
    let suiObjectIds = [] as Array&amp;lt;string&amp;gt;
    let eggObiectIds = [] as Array&amp;lt;string&amp;gt;
        // è·å–è¶³å¤Ÿçš„ SUI æˆ–è€… EGG ä»£å¸çš„å¯¹è±¡ID
    if (collectionSupply &amp;lt; PAID_TOKENS) {
      const suiObjects = await provider.selectCoinSetWithCombinedBalanceGreaterThanOrEqual(account!.address, suiCost)
      suiObjectIds = suiObjects.filter(item =&amp;gt; item.status === &amp;quot;Exists&amp;quot;).map((item: any) =&amp;gt; item.details.data.fields.id.id)
    } else {
      const eggObjects = await provider.selectCoinSetWithCombinedBalanceGreaterThanOrEqual(account!.address, eggCost, `${PACKAGE_ID}::egg::EGG`)
      eggObiectIds = eggObjects.filter(item =&amp;gt; item.status === &amp;quot;Exists&amp;quot;).map((item: any) =&amp;gt; item.details.data.fields.id.id)
    }
    try {
            // è°ƒç”¨ moveCall æ–¹æ³•ï¼Œæ„é€ äº¤æ˜“å¹¶ç­¾å
      const resData = await signAndExecuteTransaction({
        transaction: {
          kind: 'moveCall',
          data: mint(false, suiObjectIds, eggObiectIds),
        },
      });
            // æ£€æŸ¥ç»“æœ
      if (resData.effects.status.status !== &amp;quot;success&amp;quot;) {
        console.log('failed', resData);
      }
      // è®¾ç½® Mint äº¤æ˜“
      setMintTx('https://explorer.sui.io/transaction/' + resData.certificate.transactionDigest)
    } catch (e) {
      console.error('failed', e);
    }
  }
    
    // æ„é€  mint æ–¹æ³•æ‰€éœ€è¦çš„å‚æ•°
  function mint(stake: boolean, sui_objects: Array&amp;lt;string&amp;gt;, egg_objects: Array&amp;lt;string&amp;gt;) {
    return {
      packageObjectId: PACKAGE_ID,
      module: 'fox',
      function: 'mint',
      typeArguments: [],
      arguments: [
        GLOBAL, EGG_TREASUTY, mintAmount.toString(), stake, sui_objects, egg_objects
      ],
      gasBudget: 1000000,
    };
  }

  return (
        // å…¶ä»–éƒ¨åˆ†çœç•¥
        &amp;lt;div className=&amp;quot;text-center font-console pt-1&amp;quot; onClick={() =&amp;gt; mint_nft()}&amp;gt;Mint&amp;lt;/div&amp;gt;
    )
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å…¶ä¸­ &lt;code&gt;arguments&lt;/code&gt; å‚æ•°å¯¹åº” mint æ–¹æ³•æ‰€éœ€è¦çš„å‚æ•°ã€‚&lt;/p&gt;
&lt;p&gt;åŒç†ï¼Œå…¶ä»–çš„ entry æ–¹æ³•çš„è°ƒç”¨å’Œç­¾åä¹Ÿä¸ Mint æ–¹æ³•ç±»ä¼¼ï¼Œåˆ†åˆ«ä¸ºï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-tsx"&gt;// é“¸é€ å¹¶è´¨æŠ¼
async function mint_nft_stake()
// è´¨æŠ¼
async function stake_nft()
// æå–
async function unstake_nft()
// æ”¶é›† EGG
async function claim_egg()
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;4.6 åˆçº¦æ•°æ®è¯»å–&lt;/h3&gt;
&lt;p&gt;å¯¹äº Sui å…¬é“¾ï¼Œé™¤äº†è°ƒç”¨åˆçº¦ï¼Œå¦ä¸€å—éš¾ç‚¹æ˜¯åˆçº¦æ•°æ®çš„è¯»å–ã€‚ç›¸å¯¹äº EVM åˆçº¦ï¼ŒMoveçš„åˆçº¦æ•°æ®ç»“æ„æ›´å¤æ‚ï¼Œæ›´éš¾è¯»å–ã€‚ç”±äºåœ¨ Sui ä¸­ï¼ŒObject å¯¹è±¡è¢«åŒ…è£…åå¯èƒ½æ— æ³•è¿›è¡Œè¿½è¸ªï¼ˆè¯¦æƒ…å¯ä»¥å‚è€ƒå®˜æ–¹ &lt;a href="https://docs.sui.io/build/programming-with-objects"&gt;Object æ•™ç¨‹ç³»åˆ—&lt;/a&gt;ï¼‰ï¼Œå› æ­¤åœ¨ä¹‹å‰çš„æ•°æ®ç»“æ„è®¾è®¡ä¸­ï¼ŒPack å’Œ Barn ä¸­å­˜å‚¨çš„ NFT éœ€è¦ä½¿ç”¨èƒ½è¿›è¡Œè¿½è¸ªçš„æ•°æ®ç»“æ„ã€‚å› æ­¤ï¼ŒObjectTable è¢«åšä¸ºåŸºæœ¬çš„é”®å€¼å­˜å‚¨ç»“æ„åŒºåˆ«äºä¸å¯è¿½è¸ªçš„ Table æ•°æ®ç±»å‹ã€‚ç›¸åº”åœ°ï¼Œå¯ä»¥ä½¿ç”¨  &lt;code&gt;sui_getDynamicFieldObject&lt;/code&gt; æ¥è¯»å–å…¶ä¸­çš„æ•°æ®ï¼Œä¾‹å¦‚ï¼Œé€šè¿‡è¯»å–ä¿å­˜åœ¨ PackStaked ä¸­çš„ NFT å¯¹è±¡è´¨æŠ¼åˆ—è¡¨ï¼Œä»è€Œé€šè¿‡ &lt;code&gt;getObjectBatch&lt;/code&gt; å¯ä»¥è·å–å½“å‰åœ°å€æ‰€æœ‰çš„è´¨æŠ¼çš„ NFTã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-tsx"&gt;        // è¯»å– Pack ä¸­è´¨æŠ¼çš„ Fox NFT
        const objects: any = await sui_client.getDynamicFieldObject(packStakedObject, account!.address);
          if (objects != null) {
            const fox_staked = objects.details.data.fields.value
            const fox_stakes = await provider.getObjectBatch(fox_staked)
            const staked = fox_stakes.filter(item =&amp;gt; item.status === &amp;quot;Exists&amp;quot;).map((item: any) =&amp;gt; {
              let foc = item.details.data.fields.item
              return {
                objectId: foc.fields.id.id,
                index: parseInt(foc.fields.index),
                url: foc.fields.url,
              }
            })
            setStakedFox(staked)
          }
        }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å…¶ä¸­ï¼Œ &lt;code&gt;packStakedObject&lt;/code&gt; å¯¹è±¡IDé€šè¿‡ &lt;code&gt;GLOBAL&lt;/code&gt; å¯¹è±¡ ID è·å–å¾—åˆ°ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-tsx"&gt;            const globalObject: any = await provider.getObject(GLOBAL)

      const pack_staked = globalObject.details.data.fields.pack.fields.id.id
      setPackStakedObject(pack_staked)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¯¹äºå½“å‰åœ°å€æ‰€æ‹¥æœ‰çš„æœªè´¨æŠ¼çš„NFTï¼Œéœ€è¦é€šè¿‡è¯»å–å…¨éƒ¨å¯¹è±¡IDåè¿›è¡Œç±»å‹è¿‡æ»¤æ‰èƒ½å¾—åˆ°ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-tsx"&gt;                // è·å–æ‰€æœ‰å¯¹è±¡
                const objects = await provider.getObjectsOwnedByAddress(account!.address)
        // è¿‡æ»¤ FoxOrChicken å¯¹è±¡
                const foc = objects
          .filter(item =&amp;gt; item.type === `${PACKAGE_ID}::token_helper::FoxOrChicken`)
          .map(item =&amp;gt; item.objectId)
        const foces = await provider.getObjectBatch(foc)
                // è¿‡æ»¤å¹¶è¯»å–ä¿¡æ¯ï¼Œç„¶åæ’åº
        const unstaked = foces.filter(item =&amp;gt; item.status === &amp;quot;Exists&amp;quot;).map((item: any) =&amp;gt; {
          return {
            objectId: item.details.data.fields.id.id,
            index: parseInt(item.details.data.fields.index),
            url: item.details.data.fields.url,
            is_chicken: item.details.data.fields.is_chicken,
          }
        }).sort((n1, n2) =&amp;gt; n1.index - n2.index)
                // å­˜å‚¨
        setUnstakedFox(unstaked.filter(item =&amp;gt; !item.is_chicken))
        setUnstakedChicken(unstaked.filter(item =&amp;gt; item.is_chicken))
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æœ€åï¼Œå¯¹äºå½“å‰åœ°å€ä¸­åŒ…å«çš„ EGG ä»£å¸çš„ä½™é¢ï¼Œå¯ä»¥é€šè¿‡ &lt;code&gt;getCoinBalancesOwnedByAddress&lt;/code&gt; è·å¾—æ‰€æœ‰ä½™é¢å¯¹è±¡å¹¶è¿›è¡Œæ±‚å’Œå¾—åˆ°ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-tsx"&gt;        const balanceObjects = await provider.getCoinBalancesOwnedByAddress(account!.address, `${PACKAGE_ID}::egg::EGG`)
        const balances = balanceObjects.filter(item =&amp;gt; item.status === 'Exists').map((item: any) =&amp;gt; parseInt(item.details.data.fields.balance))
        const initialValue = 0;
        const sumWithInitial = balances.reduce(
          (accumulator, currentValue) =&amp;gt; accumulator + currentValue,
          initialValue
        )
        setEggBalance(sumWithInitial);
&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;è‡³æ­¤ï¼Œæˆ‘ä»¬å®Œæˆäº†ç‹ç‹¸æ¸¸æˆåˆçº¦å’Œå‰ç«¯ä»£ç çš„ä»‹ç»ã€‚æˆ‘ä»¬å®ç°çš„ç‹ç‹¸æ¸¸æˆè™½ç„¶åŠŸèƒ½ä¸Šåªæœ‰é“¸é€ ï¼Œè´¨æŠ¼å’Œæå–è¿™å‡ ä¸ªä¸»è¦çš„åŠŸèƒ½ï¼Œä½†æ˜¯æ¶‰åŠ NFT åˆ›å»ºä»¥åŠ Sui Move çš„è¯¸å¤šè¯­æ³•ï¼Œæ•´ä½“é¡¹ç›®å…·æœ‰ä¸€å®šçš„éš¾åº¦ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç¯‡æ–‡ç« å¸Œæœ›å¯¹æœ‰å…´è¶£äº Sui ä¸Šçš„ NFT çš„æ“ä½œçš„åŒå­¦æœ‰æ‰€å¸®åŠ©ï¼Œä¹Ÿå¸Œæœ›å¤§å®¶æå‡ºå®è´µçš„å»ºè®®å’Œæ„è§ã€‚é¡¹ç›®ç›®å‰åªå®Œæˆäº†åˆæ­¥çš„é€»è¾‘åŠŸèƒ½ï¼Œè¿˜éœ€è¦ç»§ç»­è¡¥å……æµ‹è¯•å’Œå½¢å¼éªŒè¯ï¼Œæ¬¢è¿æœ‰å…´è¶£çš„åŒå­¦æäº¤ Pull Requestã€‚&lt;/p&gt;
&lt;h2&gt;å‚è€ƒæ–‡æ¡£&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://docs.sui.io/"&gt;https://docs.sui.io/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://zhuanlan.zhihu.com/p/439236444"&gt;https://zhuanlan.zhihu.com/p/439236444&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href="https://github.com/qiwihui/blog/issues/171"&gt;View on GitHub&lt;/a&gt;&lt;/p&gt;
</content></entry><entry><title>Uniswap v3 æ— å¸¸æŸå¤±åˆ†æ</title><id>blogs/qiwihui-blog-165.md</id><updated>2024-08-18T03:45:14+00:00</updated><author><name>qiwihui</name><email>qwh005007@gmail.com</email></author><link href="https://qiwihui.com/blogs/qiwihui-blog-165.html" rel="self"/><published>2024-05-25T09:37:50+00:00</published><content type="html">&lt;h1&gt;Uniswap v3 æ— å¸¸æŸå¤±åˆ†æ&lt;/h1&gt;
&lt;h1&gt;Uniswap v3 æ— å¸¸æŸå¤±åˆ†æ&lt;/h1&gt;
&lt;h2&gt;ç›®æ ‡&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;å¯¹ Uniswap v3 æ— å¸¸æŸå¤±çš„å®šé‡åˆ†æï¼›&lt;/li&gt;
&lt;li&gt;å¦‚ä½•ä½¿ç”¨ç­–ç•¥è®© Uniswap v3 LP è·å¾—æ›´å¤§çš„æ”¶ç›Šã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;!--more--&gt;
&lt;h2&gt;Uniswap æ¦‚è§ˆ&lt;/h2&gt;
&lt;p&gt;åŸºäºæ’å®šä¹˜ç§¯çš„è‡ªåŠ¨åŒ–åšå¸‚å•†ï¼ˆAMMï¼‰ï¼Œå»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;v1 ç‰ˆæœ¬:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;2018å¹´11æœˆ&lt;/li&gt;
&lt;li&gt;è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼šä¼ ç»Ÿäº¤æ˜“æ‰€ order book ä¹°å–åŒæ–¹ä¸æ´»è·ƒå¯¼è‡´çš„é•¿æ—¶é—´æŒ‚å•ï¼Œäº¤æ˜“æ•ˆç‡ä½ä¸‹&lt;/li&gt;
&lt;li&gt;åŠŸèƒ½ï¼šETH â†â†’ ERC20 token å…‘æ¢&lt;/li&gt;
&lt;li&gt;å¸¦æ¥çš„é—®é¢˜ï¼š
&lt;ul&gt;
&lt;li&gt;token1 ä¸ token2 ä¹‹é—´çš„å…‘æ¢éœ€è¦å€ŸåŠ© ETH
&lt;ul&gt;
&lt;li&gt;USDT â†’ ETH â†’ USDC&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;v2 ç‰ˆæœ¬:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;2020å¹´5æœˆ&lt;/li&gt;
&lt;li&gt;æ–°åŠŸèƒ½
&lt;ul&gt;
&lt;li&gt;è‡ªç”±ç»„åˆäº¤æ˜“å¯¹ï¼štoken1 â†â†’ token2
&lt;ul&gt;
&lt;li&gt;token1-token2 äº¤æ˜“æ± &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;LPers æä¾›æµåŠ¨æ€§å¹¶èµšå–è´¹ç”¨&lt;/li&gt;
&lt;li&gt;ä»·æ ¼é¢„è¨€æœºï¼ˆæ—¶é—´åŠ æƒå¹³å‡ä»·æ ¼ï¼ŒTWAPï¼‰ã€é—ªç”µè´·ã€æœ€ä¼˜åŒ–äº¤æ˜“è·¯å¾„ç­‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å¸¦æ¥çš„é—®é¢˜
&lt;ul&gt;
&lt;li&gt;èµ„é‡‘åˆ©ç”¨ç‡ä½ï¼š
&lt;ul&gt;
&lt;li&gt;åœ¨ &lt;code&gt;x*y=k&lt;/code&gt; çš„æƒ…å†µä¸‹ï¼Œåšå¸‚çš„ä»·æ ¼åŒºé—´åœ¨ (0, +âˆ) çš„åˆ†å¸ƒï¼Œå½“ç”¨æˆ·äº¤æ˜“æ—¶ï¼Œäº¤æ˜“çš„é‡ç›¸æ¯”æˆ‘ä»¬çš„æµåŠ¨æ€§æ¥è¯´æ˜¯å¾ˆå°çš„&lt;/li&gt;
&lt;li&gt;å‡è®¾ ETH/DAI äº¤æ˜“å¯¹çš„å®æ—¶ä»·æ ¼ä¸º 1500 DAI/ETHï¼Œäº¤æ˜“å¯¹çš„æµåŠ¨æ€§æ± ä¸­å…±æœ‰èµ„é‡‘ï¼š4500 DAI å’Œ 3 ETHï¼Œæ ¹æ®Â &lt;code&gt;xâ‹…y=k&lt;/code&gt;ï¼Œå¯ä»¥ç®—å‡ºæ± å†…çš„ k å€¼ï¼š &lt;code&gt;k=4500Ã—3=13500&lt;/code&gt;ã€‚å‡è®¾Â xÂ è¡¨ç¤º DAIï¼Œy è¡¨ç¤º ETHï¼Œå³åˆå§‹é˜¶æ®µÂ x1=4500ï¼Œy1=3ï¼Œå½“ä»·æ ¼ä¸‹é™åˆ° 1300 DAI/ETH æ—¶ï¼š &lt;code&gt;x2â‹…y2=13500, x2/y2=1300&lt;/code&gt;ï¼Œå¾—å‡ºÂ &lt;code&gt;x2=4192.54, y2=3.22&lt;/code&gt;ï¼Œèµ„é‡‘åˆ©ç”¨ç‡ä¸ºï¼š &lt;code&gt;Î”x/x1=6.84%&lt;/code&gt;ã€‚åŒæ ·çš„è®¡ç®—æ–¹å¼ï¼Œå½“ä»·æ ¼å˜ä¸º 2200 DAI/ETH æ—¶ï¼Œèµ„é‡‘åˆ©ç”¨ç‡çº¦ä¸º &lt;code&gt;21.45%&lt;/code&gt;ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨å¤§éƒ¨åˆ†çš„æ—¶é—´å†…æ± å­ä¸­çš„èµ„é‡‘åˆ©ç”¨ä¸ä½äº 25%ï¼Œè¿™ä¸ªé—®é¢˜å¯¹äºç¨³å®šå¸æ± æ¥è¯´æ›´åŠ ä¸¥é‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src="https://user-images.githubusercontent.com/3297411/190839344-efc05df3-293a-422e-bc22-b26311154b12.png" alt="Untitled" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;v3ç‰ˆæœ¬:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;2021å¹´5æœˆ&lt;/li&gt;
&lt;li&gt;è€ƒè™‘é£é™©
&lt;ol&gt;
&lt;li&gt;ä»·æ ¼å½±å“ï¼ˆPrice impactï¼‰ï¼š
&lt;ul&gt;
&lt;li&gt;æ˜¯æŒ‡ä¸€ç¬”äº¤æ˜“å¯¹ä»·æ ¼çš„å½±å“ç¨‹åº¦ï¼Œå–å†³äºæ± å­æ·±åº¦ã€‚ æ›´é«˜çš„ä»·æ ¼å½±å“æ„å‘³ç€ï¼šæµåŠ¨æ€§æä¾›è€…æä¾›çš„æµåŠ¨æ€§ä¸è¶³ï¼Œå‘äº¤æ˜“è€…æä¾›æ›´å·®çš„æ¯”ç‡ï¼ˆæ»‘ç‚¹é«˜ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å­˜è´§é£é™©ï¼ˆInventory riskï¼‰ï¼š
&lt;ul&gt;
&lt;li&gt;LP çš„ä¸»è¦ç›®æ ‡æ˜¯éšç€æ—¶é—´çš„æ¨ç§»å¢åŠ å…¶æ€»åº“å­˜ä»·å€¼&lt;/li&gt;
&lt;li&gt;åœ¨ä»·æ ¼å˜åŒ–è¿‡ç¨‹ä¸­ï¼Œç›¸å¯¹äºé¦–é€‰ä»·å€¼å­˜å‚¨çš„èµ„äº§è€Œè¨€ï¼ŒLP æ‹¥æœ‰çš„èµ„äº§æ•°é‡æ›´å°‘ï¼Œæ¯”å¦‚å¯¹äº ETH-DAIï¼Œç”¨æˆ·æ›´å€¾å‘äº ETHï¼ˆETHä»·æ ¼å‡é«˜ï¼‰ï¼Œç›¸å¯¹äº ETHè€Œè¨€ï¼ŒLP æ‹¥æœ‰è¶Šå¤šçš„ DAIï¼Œå­˜è´§é£é™©è¶Šé«˜ï¼›&lt;/li&gt;
&lt;li&gt;æ¯”å¦‚ 100% ETH å’Œ 50%-50% ETH-DAI çš„å¯¹æ¯”ï¼ŒETHä»·æ ¼ä¸Šæ¶¨ï¼Œæ›´å¤šäººå°† DAI æ¢æˆ ETHï¼Œç›¸å¯¹åº”LPæ‰‹ä¸­ ETHå°±å°‘äº†ï¼Œé£é™©åŠ å¤§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ— å¸¸æŸå¤±
&lt;ul&gt;
&lt;li&gt;æä¾›æµåŠ¨æ€§æ—¶å‘ç”Ÿçš„èµ„é‡‘æš‚æ—¶æŸå¤±/éæ°¸ä¹…æ€§æŸå¤±ï¼›&lt;/li&gt;
&lt;li&gt;åªè¦ä»£å¸ç›¸å¯¹ä»·æ ¼æ¢å¤åˆ°å…¶åˆå§‹çŠ¶æ€ï¼Œè¯¥æŸå¤±å°±æ¶ˆå¤±äº†ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;æ–°åŠŸèƒ½
&lt;ul&gt;
&lt;li&gt;é›†ä¸­æµåŠ¨æ€§ â†’  æå‡èµ„é‡‘åˆ©ç”¨ç‡&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src="https://user-images.githubusercontent.com/3297411/190839359-483c9ed2-e79f-4be9-b489-0af0d86c62b6.png" alt="Untitled 1" /&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;- å¤šå±‚çº§æ‰‹ç»­è´¹ç‡ï¼ˆ0.05%ï¼Œ0.3%ï¼Œ1%ï¼‰ï¼Œå‡çº§çš„é¢„è¨€æœºï¼ŒåŒºé—´è®¢å•ï¼ˆrange orderï¼‰ç­‰ã€‚
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;å¸¦æ¥çš„é—®é¢˜ï¼š
&lt;ul&gt;
&lt;li&gt;ç›¸å¯¹äºv2è€Œè¨€
&lt;ul&gt;
&lt;li&gt;æ— å¸¸æŸå¤±ï¼ˆImpermanent Lossï¼‰ä»ç„¶å­˜åœ¨ï¼Œè€Œä¸”æ›´å¤§ï¼›&lt;/li&gt;
&lt;li&gt;LP çš„æƒè¡¡
&lt;ul&gt;
&lt;li&gt;ä»·æ ¼åŒºé—´è¶Šå¤§ï¼Œæ‰€è·å¾—çš„è´¹ç”¨æ”¶ç›Šå°±è¶Šä½ï¼Œ(0, +âˆ)æ—¶å’Œ v2ä¸€è‡´ã€‚&lt;/li&gt;
&lt;li&gt;ä½†å¦‚æœé€‰æ‹©ä¸€ä¸ªæ›´å°çš„ä»·æ ¼åŒºé—´ï¼Œå°±ä¼šæœ‰æ›´é«˜çš„æ— å¸¸æŸå¤±ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;æ— å¸¸æŸå¤±åˆ†æ&lt;/h2&gt;
&lt;h3&gt;Uniswap v2&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;ä¾‹å­ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å‡è®¾ ETH/DAI äº¤æ˜“å¯¹çš„å®æ—¶ä»·æ ¼ä¸º 1500 DAI/ETHï¼Œäº¤æ˜“å¯¹çš„æµåŠ¨æ€§æ± ä¸­å…±æœ‰èµ„é‡‘ï¼š4500 DAI å’Œ 3 ETHï¼Œæ ¹æ®Â &lt;code&gt;xâ‹…y=k&lt;/code&gt;ï¼Œå¯ä»¥ç®—å‡ºæ± å†…çš„ k å€¼ï¼š &lt;code&gt;k=4500Ã—3=13500&lt;/code&gt;ã€‚å‡è®¾Â xÂ è¡¨ç¤º DAIï¼Œy è¡¨ç¤º ETHï¼Œå³åˆå§‹é˜¶æ®µÂ x1=4500ï¼Œy1=3ã€‚&lt;/p&gt;
&lt;p&gt;å½“ä»·æ ¼ä¸‹é™åˆ° 1300 DAI/ETH æ—¶ï¼š &lt;code&gt;x2â‹…y2=13500, x2/y2=1300&lt;/code&gt;ï¼Œå¾—å‡ºÂ &lt;code&gt;x2=4192.54, y2=3.22&lt;/code&gt; ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœç”¨æˆ·é€‰æ‹©HODLï¼Œåˆ™ &lt;code&gt;x2'=4500ï¼Œy2'=3&lt;/code&gt;ï¼Œæˆ‘ä»¬åˆ†åˆ«è®¡ç®—ä¸¤ç§æƒ…å†µä¸‹çš„èµ„äº§ä»·å€¼ï¼ˆDAIï¼‰ï¼š&lt;/p&gt;
&lt;p&gt;LP: 4192.54 + 3.22 * 1300 = 8378.54&lt;/p&gt;
&lt;p&gt;HODL: 4500 + 3 * 1300 = 8400&lt;/p&gt;
&lt;p&gt;èµ„äº§å‡å°‘ï¼š8400 - 8378.54 = 21.46 â†’ æ— å¸¸æŸå¤±&lt;/p&gt;
&lt;p&gt;æ— å¸¸æŸå¤±ç‡ï¼š21.46 / 8400 = 0.26%&lt;/p&gt;
&lt;p&gt;å½“ä»·æ ¼å˜ä¸º 2200 DAI/ETHæ—¶ï¼Œx2=5449.77, y2=2.48ï¼Œèµ„äº§å‡å°‘ 194.23ï¼ŒæŸå¤±ç‡ä¸º 1.75%ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ¨¡å‹åˆ†æï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ ¹æ®æ’å®šä¹˜ç§¯å…¬å¼ $xy=k$ï¼Œä»¤ $k=L^2$ï¼Œå…¶ä¸­ L è¡¨ç¤ºæµåŠ¨æ€§ï¼Œåˆ™æœ‰ $xy=L^2$ï¼Œå†æ ¹æ®ä»·æ ¼ $S=x/y$ï¼Œå¯ä»¥å¾—åˆ° $x=L/\sqrt{S}$ï¼Œ$y=L\sqrt{S}$ã€‚&lt;/p&gt;
&lt;p&gt;è€ƒè™‘ LP åœ¨æµåŠ¨æ€§æ±  X-Y ä¸­æ·»åŠ æµåŠ¨æ€§ $L$ï¼Œæ± çš„åˆå§‹ä»·æ ¼ä¸º $S_0$ï¼Œæ‰€ä»¥ LP éœ€è¦å‘æµåŠ¨æ€§æ± ä¸­æä¾› $x_0=L/\sqrt{S_0}$çš„ X ä»£å¸å’Œ $y_0=L\sqrt{S_0}$ çš„ Y ä»£å¸ã€‚&lt;/p&gt;
&lt;p&gt;å½“æ± çš„ä»·æ ¼å˜ä¸º $S_1$æ—¶ï¼ŒLP çš„èµ„äº§ä»·å€¼ä¸º&lt;/p&gt;
&lt;p&gt;$$
V_{v2,pos}(L, S_1)=S_1 \cdot x_1+y_1=\frac{L}{\sqrt{S_1}}S_1+L\sqrt{S_1}=2L\sqrt{S_1}
$$&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ $x_1$å’Œ $y_1$æ˜¯LPåœ¨æ± ä¸­çš„èµ„äº§ã€‚&lt;/p&gt;
&lt;p&gt;LP åˆå§‹æ—¶çš„èµ„äº§å¦‚æœä¸€ç›´æ‹¿æ‰‹é‡Œï¼Œåˆ™ä»·å€¼ä¸º&lt;/p&gt;
&lt;p&gt;$$
V_{v2,hold}(L,S_0,S_1)=S_1 \cdot x_0 + y_0=\frac{L}{\sqrt{S_0}}S_1+L\sqrt{S_0}
$$&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ï¼Œæ— å¸¸æŸå¤±ä¸ºï¼š&lt;/p&gt;
&lt;p&gt;$$
\begin{aligned}
\mathrm{IL}&lt;em&gt;{\mathrm{v} 2}\left(S_0, S_1\right) &amp;amp;=\frac{V&lt;/em&gt;{\mathrm{v} 2, \text { pos }}-V_{\mathrm{v} 2, \text { hold }}}{V_{\mathrm{v} 2, \text { hold }}} \
&amp;amp;=\frac{2 L \sqrt{S_1}-\left(\frac{L}{\sqrt{S_0}} S_1+L \sqrt{S_0}\right)}{\frac{L}{\sqrt{S_0}} S_1+L \sqrt{S_0}} \
&amp;amp;=\left(\frac{2 \cdot \sqrt{\frac{S_1}{S_0}}}{1+\frac{S_1}{S_0}}-1\right)
\end{aligned}
$$&lt;/p&gt;
&lt;p&gt;ä»¤ $r=S_1/S_0$ï¼Œåˆ™æœ‰ï¼š&lt;/p&gt;
&lt;p&gt;$$
\mathrm{IL}_{v2} = \frac{2 \cdot \sqrt{r}}{1+r}-1
$$&lt;/p&gt;
&lt;p&gt;ç”¨ä¹‹å‰çš„ä¾‹å­è®¡ç®—ï¼Œr=1300/1500=0.87æ—¶ï¼ŒIL=0.0026=0.26%ï¼Œr=2200/1500=1.47æ—¶ï¼ŒIL=0.018=1.8%ï¼Œä¸ä¸Šè¿°è®¡ç®—ç›¸ç¬¦åˆã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å›¾åƒï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="https://user-images.githubusercontent.com/3297411/190839374-f568b419-7536-44d0-b988-13dd4982972a.png" alt="Untitled 2" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://www.desmos.com/calculator/aza5py3g95"&gt;https://www.desmos.com/calculator/aza5py3g95&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼Œå½“ $S_0=S_1$æ—¶æ— å¸¸æŸå¤±ä¸º0ï¼Œå…¶ä»–æ—¶å€™æ— å¸¸æŸå¤±éƒ½ä¸ºè´Ÿæ•°ã€‚åˆ—ä¸€ä¸ªè¡¨ï¼š&lt;/p&gt;
&lt;p&gt;| ä»·æ ¼å˜åŒ– | æ— å¸¸æŸå¤± |
| --- | --- |
| 0.25x | 20.0% |
| 0.5x | 5.7% |
| 0.75x | 1.0% |
| 1 | 0 |
| 1.25x | 0.6% |
| 1.5x | 2.0% |
| 1.75x | 3.8% |
| 2x | 5.7% |
| 3x | 13.4% |
| 4x | 20.0% |
| 5x | 25.5% |&lt;/p&gt;
&lt;h3&gt;Uniswap v3&lt;/h3&gt;
&lt;p&gt;ç”¨åŒæ ·çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬åˆ†æ Uniswap v3çš„æ— å¸¸æŸå¤±ã€‚å‡è®¾ LP å‘ä»·æ ¼åŒºé—´ $[P_a,P_b]$æä¾›æµåŠ¨æ€§  $L$ï¼Œåˆå§‹ä»·æ ¼ä¸º $P_0(\in[P_a,P_b])$ï¼Œä¹‹åä»·æ ¼å˜ä¸º $P_1(\in[P_a,P_b])$ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆæˆ‘ä»¬ä»Uniswap v3 çš„ç™½çš®ä¹¦ä¸­å¯ä»¥çŸ¥é“ï¼Œé›†ä¸­æµåŠ¨æ€§çš„èµ„äº§å‚¨å¤‡æ›²çº¿ï¼ˆæ©™è‰²ï¼‰çš„å…¬å¼ä¸ºï¼š&lt;/p&gt;
&lt;p&gt;$$
\left(x+\frac{L}{\sqrt{p_b}}\right)\left(y+L \sqrt{p_a}\right)=L^2
$$&lt;/p&gt;
&lt;p&gt;ï¼ˆæ¨å¯¼ï¼šæ›²çº¿ç›¸å½“äºv2çš„æ›²çº¿å‘å·¦å‘ä¸‹å¹³ç§»åŠ¨ï¼‰&lt;/p&gt;
&lt;p&gt;&lt;img src="https://user-images.githubusercontent.com/3297411/190839406-4880142e-70e3-4073-973f-1f9d8830449c.png" alt="Untitled 1" /&gt;&lt;/p&gt;
&lt;p&gt;å¯¹äºè™šæ‹Ÿæ›²çº¿: $x_{virtual} \cdot y_{virtual} = L^2$ï¼Œå¯ä»¥å¾—åˆ°ï¼š&lt;/p&gt;
&lt;p&gt;$$
\begin{aligned}&amp;amp;y=y_{\text {virtual }}-L \sqrt{p_a}=L\left(\sqrt{P}-\sqrt{p_a}\right) \&amp;amp;x=x_{\text {virtual }}-\frac{L}{\sqrt{p_b}}=L\left(\frac{1}{\sqrt{P}}-\frac{1}{\sqrt{p_b}}\right)\end{aligned}
$$&lt;/p&gt;
&lt;p&gt;åˆå§‹æ—¶èµ„äº§ä»·å€¼ä¸ºï¼š&lt;/p&gt;
&lt;p&gt;$$
\begin{aligned}V_{v3}(P_0) &amp;amp;=y_0+x_0 \cdot P_0 \&amp;amp;=L\left(\sqrt{P_0}-\sqrt{p_a}\right)+L\left(\sqrt{P_0}-\frac{P_0}{\sqrt{p_b}}\right) \&amp;amp;=2 L \sqrt{P_0}-L\left(\sqrt{p_a}+\frac{P_0}{\sqrt{p_b}}\right)\end{aligned}
$$&lt;/p&gt;
&lt;p&gt;åŒæ ·ï¼Œåˆ™åœ¨ä»·æ ¼ $P_1$æ—¶æµåŠ¨æ± ä¸­çš„èµ„äº§ä»·å€¼ä¸ºï¼ˆä»¤ $r=P_1/P_0$ï¼‰ï¼š&lt;/p&gt;
&lt;p&gt;$$
\begin{aligned}V_{v3,pos}(P_1) &amp;amp;=2 L \sqrt{P_1}-L\left(\sqrt{p_a}+\frac{P_1}{\sqrt{p_b}}\right) \ &amp;amp;=2 L \sqrt{rP_0}-L\left(\sqrt{p_a}+\frac{rP_0}{\sqrt{p_b}}\right)\end{aligned}
$$&lt;/p&gt;
&lt;p&gt;åœ¨ä»·æ ¼ä¸º $P_1$ æ—¶çš„ï¼Œé€‰æ‹© HODL çš„èµ„äº§ä»·å€¼ä¸ºï¼š&lt;/p&gt;
&lt;p&gt;$$
\begin{aligned}
V_{\text {v3,hold}}(P_1) &amp;amp;=y_0+x_0 P_1 \
&amp;amp;=L\left(\sqrt{P_0}-\sqrt{p_a}\right)+P_1 \cdot L\left(\frac{1}{\sqrt{P_0}}-\frac{1}{\sqrt{p_b}}\right) \&amp;amp;=L\left(\sqrt{P_0}-\sqrt{p_a}\right)+L \cdot rP _0\left(\frac{1}{\sqrt{P_0}}-\frac{1}{\sqrt{p_b}}\right) \
&amp;amp;=L \sqrt{P_0}(1+r)-L\left(\sqrt{p_a}+\frac{rP_0 }{\sqrt{p_b}}\right)
\end{aligned}
$$&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥æ— å¸¸æŸå¤±ä¸ºï¼ˆä¸å¤±ä¸€èˆ¬æ€§ï¼Œå– $P_0$ä¸º $P$ï¼‰ï¼š&lt;/p&gt;
&lt;p&gt;$$
\begin{aligned}\mathrm{IL}&lt;em&gt;{a, b}(r) &amp;amp;=\frac{V&lt;/em&gt;{pos}-V_{\text {hold }}}{V_{\text {hold }}} \&amp;amp;=\frac{2 L \sqrt{rP}-L \sqrt{P}(1+r)}{L \sqrt{P}(1+r)-L\left(\sqrt{p_a}+\frac{rP}{\sqrt{p_b}}\right)} \&amp;amp;=\frac{2 \sqrt{r}-1-r}{1+r-\sqrt{\frac{p_a}{P}}-r \sqrt{\frac{P}{p_b}}} \&amp;amp;=\operatorname{IL}(r) \cdot\left(\frac{1}{1-\frac{\sqrt{\frac{p_a}{P}}+r \sqrt{\frac{P}{p_b}}}{1+r}}\right)\end{aligned}
$$&lt;/p&gt;
&lt;p&gt;ï¼ˆ $P_1$ åœ¨ä»·æ ¼åŒºé—´ $[0,P_b]$ï¼Œ$[P_a,+\infty]$æ—¶çš„æ— å¸¸æŸå¤±ä¹ŸåŒæ ·å¯ä»¥è®¡ç®—ã€‚ï¼‰&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»·æ ¼åŒºé—´ $[P_a, P_b]$ çš„å˜åŒ–çœ‹åˆ°ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åœ¨ $P_a=P_b=P$æ—¶ï¼Œ IL = 0ï¼›&lt;/li&gt;
&lt;li&gt;å½“ $r=1$ æ—¶ï¼Œ IL = 0ï¼›&lt;/li&gt;
&lt;li&gt;ä¸ v2 çš„è”ç³»ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;$$
p_a=0, p_b \rightarrow \infty, \mathrm{IL}&lt;em&gt;{v3}=\frac{2 \cdot \sqrt{r} -1-r}{1+r}=\mathrm{IL}&lt;/em&gt;{v2}
$$&lt;/p&gt;
&lt;p&gt;è¶‹è¿‘äº $\mathrm{IL}_{v2}$ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç”»å›¾&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="https://user-images.githubusercontent.com/3297411/190839418-ebe47fa1-2446-431d-bceb-1e01ddd454a4.png" alt="Untitled 3" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://www.desmos.com/calculator/ha322rtufc"&gt;https://www.desmos.com/calculator/ha322rtufc&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;åŒæ ·æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼šå½“ä»·æ ¼åŒºé—´è¶Šå°æ—¶ï¼Œæ— å¸¸æŸå¤±è¶Šå¤§ï¼š&lt;/p&gt;
&lt;p&gt;ï¼ˆè¿™æ˜¯ä¸€ä¸ªåŠ¨å›¾ï¼‰&lt;/p&gt;
&lt;p&gt;&lt;img src="https://user-images.githubusercontent.com/3297411/190839425-25812665-4d4c-4b3a-bb0e-38378036b31d.gif" alt="Untitled" /&gt;&lt;/p&gt;
&lt;p&gt;æ•°å€¼&lt;strong&gt;æ¯”è¾ƒ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬æ¯”è¾ƒåœ¨ä¸åŒçš„ä»·æ ¼åŒºé—´ä¸‹ Uniswap v3çš„æ— å¸¸æŸå¤±ï¼š&lt;/p&gt;
&lt;img width="757" alt="Screen_Shot_2022-08-31_at_09 56 06" src="https://user-images.githubusercontent.com/3297411/190839436-dc4969bd-51d7-4a30-a86e-9d50930fdc85.png"&gt;
&lt;p&gt;å…·ä½“æ•°æ®ï¼ˆï¼‰ï¼š&lt;/p&gt;
&lt;p&gt;| ä»·æ ¼åŒºé—´% | -20% | Initial | +20% |
| --- | --- | --- | --- |
| [0%,Inf]( Uniswap v2 ) | -0.56% | 0 | -0.46% |
| [0%, 200%] | -0.86% | 0 | -0.70% |
| [25%, 175%] | -1.5% | 0 | -1.22% |
| [50%, 150%] | -2.34% | 0 | -1.91% |
| [75%, 125%] | -4.75% | 0 | -3.8% |&lt;/p&gt;
&lt;p&gt;æé—®ï¼šæ—¢ç„¶æ— å¸¸æŸå¤±æ€»æ˜¯ä¸ºè´Ÿï¼Œä¸ºä»€ä¹ˆè¿˜æ˜¯ä¼šæœ‰äººæ„¿æ„åš LPï¼Ÿ&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬çš„è®¡ç®—å¿½ç•¥äº†ä¸¤ä¸ªé—®é¢˜ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ‰‹ç»­è´¹ï¼ˆfeeï¼‰ï¼šä¸åŒçš„æ± å­æä¾›ä¸åŒçš„æ‰‹ç»­è´¹ï¼Œéœ€è¦åœ¨åŸæ¥çš„è®¡ç®—ä¸ŠåŠ ä¸Šæ‰‹ç»­è´¹ã€‚&lt;/li&gt;
&lt;li&gt;é›†ä¸­æµåŠ¨æ€§å¢åŠ äº†æ± çš„æ·±åº¦ï¼š
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ä¾‹å¦‚ï¼šETH-USDC-0.3%æ± çš„æµåŠ¨æ€§&lt;/p&gt;
&lt;p&gt;&lt;img src="https://user-images.githubusercontent.com/3297411/190839469-259db8d9-b51e-47c9-8444-06399598866e.png" alt="Untitled 4" /&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸€äº›æµè¡Œçš„ token å¯¹çš„æ·±åº¦æ¯”ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€ï¼ˆBinance, Coinbaseï¼‰æ›´é«˜ã€‚&lt;a href="https://uniswap.org/blog/uniswap-v3-dominance"&gt;link&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;large-cap: ETH/dollar&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;mid-cap - cross-chain pairs&lt;/p&gt;
&lt;p&gt;&lt;img src="https://user-images.githubusercontent.com/3297411/190839462-ae80daf8-398c-4dac-bc90-482a62fd3388.png" alt="Untitled 5" /&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç¨³å®šå¸ä¸ç¨³å®šå¸å¯¹: USDC/USDT&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;&lt;strong&gt;ä»èµ„äº§ä»·å€¼çš„è§’åº¦&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;æ¯”è¾ƒä»¥ä¸‹äº”ç§èµ„äº§æŒæœ‰ç­–ç•¥&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;100% æŒæœ‰ ETH&lt;/li&gt;
&lt;li&gt;100% æŒæœ‰ USDC&lt;/li&gt;
&lt;li&gt;50% æŒæœ‰ ETHï¼Œ50% æŒæœ‰ USDC&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ 50%ETH ä¸ 50%USDC å‚ä¸åšå¸‚ - Uniswap v2&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ 50%ETH ä¸ 50%USDC å‚ä¸åšå¸‚ - Uniswap v3&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ¯”è¾ƒè¿™äº”ç§ç­–ç•¥çš„èµ„äº§ä»·å€¼ã€‚ï¼ˆä½¿ç”¨ &lt;a href="https://defi-lab.xyz/uniswapv3simulator"&gt;https://defi-lab.xyz/uniswapv3simulator&lt;/a&gt;ï¼‰&lt;/p&gt;
&lt;p&gt;æ— æ‰‹ç»­è´¹æ—¶ï¼š&lt;/p&gt;
&lt;img width="838" alt="Untitled 6" src="https://user-images.githubusercontent.com/3297411/190839480-ae2dbd81-24c7-4692-8ec5-c682b28937ea.png"&gt;
&lt;p&gt;åŒ…å«æ‰‹ç»­è´¹æ—¶ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src="https://user-images.githubusercontent.com/3297411/190839487-0004de8e-9500-42e6-95dd-3cf5dca0e737.png" alt="Untitled 7" /&gt;&lt;/p&gt;
&lt;p&gt;Uniswap V3 æ—¢æ˜¯æŠ•èµ„è€…æ”¶ç›Šçš„æ”¾å¤§å™¨ï¼Œä¹Ÿæ˜¯é£é™©çš„æ”¾å¤§å™¨ã€‚åœ¨äº«å—æ›´é«˜æŠ•èµ„æ”¶ç›Šçš„åŒæ—¶ï¼Œä¹Ÿå¿…ç„¶è¦æ‰¿æ‹…å½“ä»·æ ¼è„±ç¦»å®‰å…¨èŒƒå›´æ—¶æ›´å¤šçš„æ— å¸¸æŸå¤±ã€‚&lt;/p&gt;
&lt;h2&gt;å¦‚ä½•é€šè¿‡ç­–ç•¥é™ä½æŸå¤±ï¼Œæˆ–è€…è¯´å¢åŠ æ”¶ç›Šï¼Ÿ&lt;/h2&gt;
&lt;h3&gt;ç­–ç•¥0ï¼šåœ¨ä¸ä¸»åŠ¨è°ƒæ•´çš„æƒ…å†µä¸‹é€‰æ‹©æ¯”v2è¡¨ç°æ›´å¥½çš„æ± å­&lt;/h3&gt;
&lt;p&gt;åœ¨ä¸ä¸»åŠ¨è°ƒæ•´æƒ…å†µä¸‹ï¼Œå…¨èŒƒå›´ï¼ˆfull rangeï¼‰çš„ Uniswap v3 å¤´å¯¸å’Œä»·æ ¼é™å®šçš„ç¨³å®šå¸å¤´å¯¸çš„æ‰‹ç»­è´¹å›æŠ¥å¹³å‡æ¯” Uniswap v2 å¥½çº¦ 54%ã€‚å…¶ä¸­&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;100 åŸºç‚¹æ‰‹ç»­è´¹çš„å…¨èŒƒå›´ v3 å¤´å¯¸æ¯” v2 å¹³å‡&lt;strong&gt;å¥½&lt;/strong&gt; ~80%ã€‚&lt;/li&gt;
&lt;li&gt;1 åŸºç‚¹ï¼ŒèŒƒå›´é™å®šçš„ v3 ç¨³å®šå¸å¯¹ï¼Œv2 ï¼Œå¹³å‡&lt;strong&gt;å¥½&lt;/strong&gt; ~160%.&lt;/li&gt;
&lt;li&gt;30 åŸºç‚¹ï¼Œå…¨èŒƒå›´ v3 å¤´å¯¸ï¼Œ v2 å¹³å‡&lt;strong&gt;å¥½&lt;/strong&gt; ~16%.&lt;/li&gt;
&lt;li&gt;5 åŸºç‚¹ï¼Œå…¨èŒƒå›´ v3 å¤´å¯¸ï¼Œv2  å¹³å‡&lt;strong&gt;å·®&lt;/strong&gt; ~68%.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šå¸¸å»ºè®® LPers é€‰æ‹© v3ã€‚&lt;a href="https://uniswap.org/blog/fee-returns"&gt;link&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;é€‰æ‹©å“ªä¸ªæ± ï¼Ÿ&lt;/p&gt;
&lt;p&gt;&lt;img src="https://user-images.githubusercontent.com/3297411/190839496-8d41b11a-d26a-479c-8441-c481f3aa26e9.png" alt="Untitled 8" /&gt;&lt;/p&gt;
&lt;p&gt;v3 è¡¨ç°æ›´å¥½çš„æ˜¯ 100 åŸºç‚¹è´¹ç‡æˆ– 1 åŸºç‚¹è´¹ç‡çš„ç¨³å®šå¸å¯¹ã€‚&lt;/p&gt;
&lt;p&gt;100 bps çš„ token å¯¹é€šå¸¸æµåŠ¨æ€§è¾ƒå·®ï¼Œéƒ¨ç½²æ—¶é—´è¾ƒæ™šä¸”æ³¢åŠ¨æ€§è¾ƒå¤§ã€‚ å¯¹äº 1-bp è´¹ç”¨ç­‰çº§ï¼Œä»£å¸å¯¹ä»·æ ¼æ³¢åŠ¨è¾ƒå°ï¼Œä½† Uniswap v3 çš„äº¤æ˜“é‡è¿œé«˜äº v2ã€‚ 1-bp æ± ä¸Šçš„é›†ä¸­æµåŠ¨æ€§å®ç°äº†è¶…è¿‡ v2 çš„é«˜å›æŠ¥ã€‚&lt;/p&gt;
&lt;h3&gt;ç­–ç•¥ä¸€ï¼šä¸»åŠ¨çš„è¢«åŠ¨ç­–ç•¥&lt;/h3&gt;
&lt;p&gt;å¦‚æœåˆå§‹æŠ•å…¥æ˜¯ 50%ETH å’Œ50%USDCï¼Œå½“ä»·æ ¼å˜åŒ–æ—¶ï¼Œæ± ä¸­å‰©ä½™çš„èµ„äº§æ¯”ä¾‹å¯èƒ½å˜æˆ 80%ETH å’Œ 20%USDCï¼Œè¿™æ—¶ä½ éœ€è¦æ‰‹åŠ¨è°ƒæ•´åº“å­˜æ¥é˜²æ­¢å‡ºç°ä¸€ç§èµ„äº§åœ¨ä¸€ä¾§è€—å°½ï¼Œå¯ä»¥æŒç»­æä¾›ä¸¤è¾¹çš„åº“å­˜ã€‚&lt;/p&gt;
&lt;p&gt;æ ¹æ®ä»·æ ¼å˜åŠ¨å‘¨æœŸæ€§åœ°å†å¹³è¡¡ï¼ˆrebalanceï¼‰ä¸¤ç§èµ„äº§ä¹‹é—´çš„æ¯”ä¾‹ã€‚&lt;/p&gt;
&lt;p&gt;åˆ©ç”¨èŒƒå›´è®¢å•ï¼ˆrange orderï¼‰è¢«åŠ¨æ‰§è¡Œçš„ï¼Œåœ¨ç°åœ¨ä»·æ ¼çš„é¢„æµ‹æ–¹å‘æ”¾ç½®ä¸€ä¸ªçª„çš„è®¢å•ï¼Œè¿™æ ·å°±é¿å…äº†swapè´¹ç”¨å’Œä»·æ ¼å½±å“ã€‚å¦‚æœä¸»åŠ¨ä½¿ç”¨ swap è¾¾åˆ° 50/50ï¼Œä¼šæœ‰ 0.3%çš„è´¹ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¦‚ä½•æ“ä½œï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å¯¹äº Uniswap ä¸Šä¸ºæŸä¸ªçŸ¿æ± ï¼Œä¾‹å¦‚ ETH/USDCï¼Œå®ƒæœ‰ä¸¤ä¸ªä¸»è¦å‚æ•°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Bï¼ˆåŸºæœ¬é˜ˆå€¼ï¼‰&lt;/li&gt;
&lt;li&gt;Rï¼ˆå†å¹³è¡¡é˜ˆå€¼ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¯¥ç­–ç•¥å§‹ç»ˆä¿æŒä¸¤ä¸ªæœ‰æ•ˆçš„èŒƒå›´è®¢å•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŸºæœ¬å®šå•ï¼šä»¥å½“å‰ä»·æ ¼ X ä¸ºä¸­å¿ƒï¼ŒèŒƒå›´ [X-B, X+B]ã€‚ å¦‚æœ B è¾ƒä½ï¼Œå®ƒå°†ä»äº¤æ˜“è´¹ç”¨ä¸­è·å¾—æ›´é«˜çš„æ”¶ç›Šã€‚&lt;/li&gt;
&lt;li&gt;å†å¹³è¡¡è®¢å•ï¼šåˆšå¥½é«˜äºæˆ–ä½äºå½“å‰ä»·æ ¼ã€‚åœ¨ [X-R, X] æˆ– [X, X+R] èŒƒå›´å†…ï¼Œå…·ä½“å–å†³äºåœ¨åŸºæœ¬è®¢å•ä¸‹è¾¾åå®ƒæŒæœ‰çš„æ›´å¤šçš„ä»£å¸æ˜¯å“ªä¸€ç§ã€‚ æ­¤è®¢å•æœ‰åŠ©äºç­–ç•¥é‡æ–°å¹³è¡¡å¹¶æ¥è¿‘ 50/50 ä»¥é™ä½åº“å­˜é£é™©ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ¯24å°æ—¶ï¼Œè¿›è¡Œå†å¹³è¡¡ï¼Œæ ¹æ®ä»·æ ¼å’Œtokenæ•°é‡æäº¤è®¢å•ã€‚å¦‚æœç­–ç•¥è¡¨ç°ä¼˜ç§€ï¼Œåˆ™æ—¶é—´åŒºé—´å¯ä»¥è¢«å‡å°‘ã€‚å†å¹³è¡¡å¹¶ä¸èƒ½ä¿è¯å®Œå…¨50/50ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä¸¾ä¾‹ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="https://user-images.githubusercontent.com/3297411/190839504-426e6004-c3f3-4101-8a08-c507915c9d20.png" alt="Untitled 9" /&gt;&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚ï¼ŒETHç›®å‰ä»·æ ¼ 150USDCï¼ŒB=50ï¼ŒR=20ï¼Œç­–ç•¥æ‹¥æœ‰èµ„é‡‘ 1ETH å’Œ160USDCã€‚åˆ™åœ¨ [100, 200] æ”¾ç½®ä¸€ä¸ªåŸºç¡€è®¢å•ï¼Œä½¿ç”¨ 1ETH å’Œ 150 USDCã€‚å‰©ä½™çš„ 10 USDC ç”¨æ¥åœ¨ [130,150] æ”¾ç½®ä¸€ä¸ªåœ¨å¹³è¡¡è®¢å•ï¼Œç”¨æ¥è´­ä¹°ETHä»¥è¾¾åˆ°50/50ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src="https://user-images.githubusercontent.com/3297411/190839510-80e1e8bd-3204-4566-a11c-b4c268246038.png" alt="Untitled 10" /&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœä»·æ ¼æå‡åˆ° 180ï¼Œ å†å¹³è¡¡ä¹‹åï¼ŒåŸºç¡€è®¢å•ä¸º [130, 230]ï¼Œè‹¥æ­¤æ—¶ç­–ç•¥æœ‰ 1.2 ETH å’Œ 90USDCï¼Œåˆ™ç­–ç•¥ä¼šä½¿ç”¨ 0.5EHT å’Œ 90USDC æ”¾å…¥åŸºç¡€è®¢å•ä¸­ï¼Œå‰©ä½™ 0.7ETH ä¼šç”¨äºåœ¨ [180, 200] ä¹‹é—´çš„å†å¹³è¡¡è®¢å•ã€‚&lt;/p&gt;
&lt;p&gt;å®é™…æ“ä½œï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href="https://dune.com/queries/78325/155734?Number%20of%20days=200"&gt;https://dune.com/queries/78325/155734?Number of days=200&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ•ˆæœ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è“è‰²æ›²çº¿&lt;/p&gt;
&lt;p&gt;&lt;img src="https://user-images.githubusercontent.com/3297411/190839522-c5c425e6-a397-4809-a96e-3a36c20ee8b5.png" alt="Untitled 11" /&gt;&lt;/p&gt;
&lt;p&gt;å®é™…æ•ˆæœï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href="https://dune.com/mxwtnb/Alpha-Vaults-Performance?Number+of+days=200&amp;amp;Number+of+days_t4072e=500"&gt;https://dune.com/mxwtnb/Alpha-Vaults-Performance?Number+of+days=200&amp;amp;Number+of+days_t4072e=500&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;ç­–ç•¥äºŒï¼šé¢„æœŸä»·æ ¼èŒƒå›´ç­–ç•¥ï¼ˆexpected price range strategiesï¼‰&lt;/h3&gt;
&lt;p&gt;ä»å†å²æ•°æ®ä¸­é¢„æµ‹æœªæ¥10åˆ†é’Ÿçš„ä»·æ ¼èµ°åŠ¿ï¼Œå¾—åˆ°ä¸€ä¸ªä»·æ ¼èŒƒå›´åŒºé—´ï¼Œåœ¨è¿™ä¸ªä»·æ ¼èŒƒå›´åŒºé—´ä¸­æä¾›æµåŠ¨æ€§ã€‚ç›´åˆ°å½“å‰ä»·æ ¼è¶…å‡ºä»·æ ¼èŒƒå›´ï¼Œé‡å¤ä¸Šè¿°è¿‡ç¨‹ï¼Œé‡æ–°é¢„æµ‹ä»·æ ¼èŒƒå›´å¹¶æ·»åŠ æµåŠ¨æ€§ã€‚è¿™ä¸ªä»·æ ¼èŒƒå›´ç§°ä¸ºâ€œé¢„æœŸä»·æ ¼èŒƒå›´â€ã€‚åŒæ—¶æˆ‘ä»¬å¯ä»¥åœ¨å½“å‰ä»·æ ¼æ²¡æœ‰å®Œå…¨è¶…å‡ºé¢„æœŸä»·æ ¼èŒƒå›´æ—¶è°ƒæ•´ä»·æ ¼åŒºé—´ï¼Œç§°è¿™ä¸ªä»·æ ¼èŒƒå›´ä¸ºâ€œç§»åŠ¨ç­–ç•¥èŒƒå›´ï¼ˆmove strategy rangesï¼‰â€ï¼Œè¿™ä¸ªèŒƒå›´æŒ‡ç¤ºäº†ä»€ä¹ˆæ—¶å€™éœ€è¦ç§»åŠ¨ã€‚&lt;/p&gt;
&lt;img width="479" alt="Untitled 12" src="https://user-images.githubusercontent.com/3297411/190839530-f02eb060-6daf-4545-8166-35ecf2e34270.png"&gt;
&lt;p&gt;&lt;strong&gt;å¦‚ä½•è®¾ç½®&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;2018å¹´3æœˆ~2020å¹´4æœˆçš„ååˆ†é’Ÿæ•°æ®å¾—å‡ºä»·æ ¼ç§»åŠ¨åˆ†å¸ƒåœ¨ [-3%, 3%] ä¹‹é—´ã€‚å¯ä»¥è®¾ç½®ç™¾åˆ†æ¯”ä½œä¸ºä»·æ ¼æ³¢åŠ¨åŒºé—´ã€‚&lt;/p&gt;
&lt;img width="501" alt="Untitled 13" src="https://user-images.githubusercontent.com/3297411/190839533-07b08d89-e42d-471c-84c3-85444226f677.png"&gt;
&lt;p&gt;&lt;strong&gt;è¿›ä¸€æ­¥ç­–ç•¥&lt;/strong&gt;ï¼šåœ¨é¢„æœŸä»·æ ¼èŒƒå›´å†…ä¸é‡‡ç”¨ä¸€è‡´çš„æµåŠ¨æ€§ï¼Œè€Œæ˜¯é‡‡ç”¨å¤šä¸ªè¿ç»­çš„æµåŠ¨æ€§å¤šå¤´ï¼Œæ¯ä¸ªå¤šå¤´å­˜å…¥ä¸åŒæ•°é‡çš„èµ„äº§ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‰ç§ç­–ç•¥ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‡åŒ€ç­–ç•¥ï¼šåœ¨ä»·æ ¼åŒºé—´å†…å‡åŒ€åˆ†å¸ƒï¼ŒUniswap v3 é»˜è®¤ï¼›&lt;/li&gt;
&lt;li&gt;æ¯”ä¾‹ç­–ç•¥ï¼šåœ¨ä»·æ ¼åŒºé—´å†…åˆ†æˆå­ä»·æ ¼åŒºé—´ï¼Œæƒé‡å¯¹åº”ä»·æ ¼å¯èƒ½çš„å˜åŒ–æ¦‚ç‡æ”¾ç½®ï¼›&lt;/li&gt;
&lt;li&gt;æœ€ä¼˜ç­–ç•¥ï¼šä½¿ç”¨å†³ç­–ç†è®ºï¼ˆæ¯”å¦‚é©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹ï¼‰ï¼Œè®¡ç®—ä¸€ä¸ªæ¨¡å‹æ¥ä¼°ç®—â€œæœ€ä½³â€èŒƒå›´æ¥æä¾›æµåŠ¨æ€§ï¼Œä½¿ç”¨ LP çš„â€œé£é™©è§„é¿â€ç¨‹åº¦ä½œä¸ºå‚æ•°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;æ¯”ä¾‹ç­–ç•¥ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Ba: é¢„æœŸä»·æ ¼èŒƒå›´&lt;/li&gt;
&lt;li&gt;Bt: ç§»åŠ¨ç­–ç•¥èŒƒå›´&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è“çº¿ä¸ºæ¦‚ç‡åˆ†å¸ƒï¼Œä½¿ç”¨å°çš„ä»·æ ¼åŒºé—´å®ç°&lt;/p&gt;
&lt;img width="509" alt="Untitled 14" src="https://user-images.githubusercontent.com/3297411/190839543-c3e52671-e05b-4f1b-8e8a-dfeed7f886d1.png"&gt;
&lt;p&gt;&lt;strong&gt;ç»“è®ºï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹äºåŒæ¶é£é™©çš„æŠ•èµ„è€…ï¼Œå‡åŒ€ç­–ç•¥æœ€ä¼˜ï¼Œå¯¹äºå…¶ä»–æ‰€æœ‰äººæ¥è¯´æ˜¯æ¬¡ä¼˜çš„ï¼›&lt;/li&gt;
&lt;li&gt;æ¯”ä¾‹ç­–ç•¥å¯¹äºå¤§éƒ¨åˆ†åŒæ¶é£é™©çš„æŠ•èµ„è€…æ¥è¯´çš„æ¥è¿‘æœ€ä¼˜çš„ï¼›&lt;/li&gt;
&lt;li&gt;å¯¹äºæœ€åŒæ¶é£é™©çš„æŠ•èµ„è€…è€Œè¨€ï¼Œå‡åŒ€ç­–ç•¥å¯è·åˆ©ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src="https://user-images.githubusercontent.com/3297411/190839545-ec74a8e6-e5bb-4ed2-8712-630db12c2226.png" alt="Untitled 15" /&gt;&lt;/p&gt;
&lt;p&gt;æ¯”ä¾‹ç­–ç•¥å¯¹äºé£é™©åå‘ LP æä¾›è€…æ˜¯æœ€ä¼˜çš„ï¼ˆ $\alpha$å¤§ ï¼‰ï¼Œè€Œå‡åŒ€åˆ†é…å¯¹äºé£é™©è§„é¿LPæä¾›è€…æ˜¯æœ€ä¼˜çš„ï¼ˆ $\alpha$ å°ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ„å‘³ç€ï¼Œåœ¨ Uniswap v3 ä¸­è¢«åŠ¨ç®¡ç†çš„å¤´å¯¸å¯èƒ½ä¸è¶³ä»¥ä»¥èµ„æœ¬æ•ˆç‡å’Œå¹³è¡¡é£é™©èµšå–è´¹ç”¨ï¼Œç§¯æçš„æµåŠ¨æ€§æä¾›ç­–ç•¥æ—¢æ˜¯æœºé‡ä¹Ÿæ˜¯æŒ‘æˆ˜ã€‚&lt;/p&gt;
&lt;h3&gt;å…¶ä»–ä¸»åŠ¨çš„æµåŠ¨æ€§ç®¡ç†&lt;/h3&gt;
&lt;p&gt;å…¶ä»–ä¸»åŠ¨ç­–ç•¥ dapp&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://xtoken.market/app/invest"&gt;xToken project&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.gelato.network/"&gt;Gelato Network&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.visor.finance/"&gt;Visor Finance team&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Charm.fiâ€™sÂ &lt;a href="https://alpha.charm.fi/"&gt;Alpha Vaults&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://mellow.finance/vault"&gt;Mellow Protocol&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src="https://user-images.githubusercontent.com/3297411/190839551-e149cbf3-10fb-46c1-9a58-5507499ac6ea.png" alt="Untitled 16" /&gt;&lt;/p&gt;
&lt;h2&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://newsletter.banklesshq.com/p/how-to-avoid-impermanent-loss"&gt;How to avoid Impermanent Loss&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://newsletter.banklesshq.com/p/10-going-bankless-with-uniswap-caleb"&gt;Going Bankless with Uniswap&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://newsletter.banklesshq.com/p/how-to-make-money-with-uniswap-v3"&gt;How to make money with Uniswap V3&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://newsletter.banklesshq.com/p/a-guide-to-uniswap-on-optimism"&gt;A Guide to Uniswap on Optimism&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;strong&gt;Uniswap Liquidity Provision: Is the Yield Worth the Risk?ï¼š&lt;/strong&gt;&lt;/strong&gt;&lt;a href="https://medium.com/gammaswap-labs/uniswap-liquidity-provision-is-the-yield-worth-the-risk-c45a4a850700"&gt;https://medium.com/gammaswap-labs/uniswap-liquidity-provision-is-the-yield-worth-the-risk-c45a4a850700&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://betterprogramming.pub/uniswap-v2-in-depth-98075c826254"&gt;https://betterprogramming.pub/uniswap-v2-in-depth-98075c826254&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://liaoph.com/uniswap-v3-1/"&gt;https://liaoph.com/uniswap-v3-1/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.theblockbeats.info/news/24654"&gt;https://www.theblockbeats.info/news/24654&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://medium.com/charmfinance/introducing-alpha-vaults-an-lp-strategy-for-uniswap-v3-ebf500b67796"&gt;https://medium.com/charmfinance/introducing-alpha-vaults-an-lp-strategy-for-uniswap-v3-ebf500b67796&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://medium.com/@DeFiScientist/rebalancing-vs-passive-strategies-for-uniswap-v3-liquidity-pools-754f033bdabc"&gt;https://medium.com/@DeFiScientist/rebalancing-vs-passive-strategies-for-uniswap-v3-liquidity-pools-754f033bdabc&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://uniswap.org/blog/fee-returns"&gt;https://uniswap.org/blog/fee-returns&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://uniswapv3.flipsidecrypto.com/"&gt;https://uniswapv3.flipsidecrypto.com/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://newsletter.banklesshq.com/p/how-to-automate-uniswap-v3-liquidity"&gt;https://newsletter.banklesshq.com/p/how-to-automate-uniswap-v3-liquidity&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://kydo.substack.com/p/palm-protocol-owned-active-liquidity"&gt;https://kydo.substack.com/p/palm-protocol-owned-active-liquidity&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href="https://github.com/qiwihui/blog/issues/165"&gt;View on GitHub&lt;/a&gt;&lt;/p&gt;
</content></entry><entry><title>Tornado Cash åŸºæœ¬åŸç†</title><id>blogs/qiwihui-blog-164.md</id><updated>2024-08-18T03:45:14+00:00</updated><author><name>qiwihui</name><email>qwh005007@gmail.com</email></author><link href="https://qiwihui.com/blogs/qiwihui-blog-164.html" rel="self"/><published>2024-05-25T09:37:50+00:00</published><content type="html">&lt;h1&gt;Tornado Cash åŸºæœ¬åŸç†&lt;/h1&gt;
&lt;p&gt;å‡è®¾åœ°å€ A å‘é€äº† 100 ETH ç»™åœ°å€ Bï¼Œç”±äºåœ¨åŒºå—é“¾ä¸Šæ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯å…¬å¼€çš„ï¼Œæ‰€ä»¥å…¨ä¸–ç•Œéƒ½çŸ¥é“åœ°å€ A å’Œåœ°å€ B è¿›è¡Œäº†ä¸€æ¬¡äº¤æ˜“ï¼Œå¦‚æœåœ°å€Aå’Œåœ°å€ B å±äºåŒä¸€ä¸ªç”¨æˆ· Aliceï¼Œåˆ™å¤§å®¶çŸ¥é“Aliceä»ç„¶æ‹¥æœ‰ 100 ETHï¼Œå¦‚æœåœ°å€Bå±äºç”¨æˆ· Bobï¼Œåˆ™å¤§å®¶çŸ¥é“ Bob ç°åœ¨æœ‰ 100ETH äº†ã€‚ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼šå¦‚ä½•åœ¨äº¤æ˜“çš„è¿‡ç¨‹ä¸­ä¿æŒéšè”½å‘¢ï¼Œæˆ–è€…è¯´éšè—å‘é€ç”¨æˆ·ä¸æ¥æ”¶ç”¨æˆ·ä¹‹å‰çš„ç»ƒä¹ ï¼Ÿé‚£å°±è¦ç”¨åˆ° Tornado Cashã€‚&lt;/p&gt;
&lt;p&gt;ç”¨æˆ·å°†èµ„é‡‘å­˜å…¥Tornado Cashï¼Œç„¶åå°†èµ„é‡‘æå–åˆ°å¦ä¸€ä¸ªåœ°å€ä¸­ï¼Œåœ¨åŒºå—é“¾ä¸Šè®°å½•ä¸Šï¼Œè¿™ä¸¤ä¸ªåœ°å€ä¹‹é—´çš„è”ç³»å°±å¤§æ¦‚ç‡æ–­å¼€äº†ã€‚é‚£ Tornado Cash æ˜¯å¦‚ä½•åšåˆ°çš„å‘¢ï¼Ÿ&lt;/p&gt;
&lt;!--more--&gt;
&lt;h2&gt;å­˜æ¬¾ï¼ˆdepositï¼‰è¿‡ç¨‹&lt;/h2&gt;
&lt;p&gt;é¦–å…ˆæˆ‘ä»¬çœ‹ä¸€ä¸‹å­˜æ¬¾è¿‡ç¨‹ã€‚ç”¨æˆ·åœ¨å­˜æ¬¾æ—¶éœ€è¦ç”Ÿäº§ä¸¤ä¸ªéšæœºæ•° secret å’Œ nullifierï¼Œå¹¶è®¡ç®—è¿™ä¸¤ä¸ªæ•°çš„ä¸€ä¸ªå“ˆå¸Œ commitment = hash(secret, nullifier)ï¼Œç„¶åç”¨æˆ·å°†éœ€è¦æ··å¸çš„é‡‘é¢ï¼ˆæ¯”å¦‚ 1 ETHï¼‰å’Œ commitment å‘é€ç»™ TC åˆçº¦çš„ deposit å‡½æ•°ï¼ŒTCåˆçº¦å°†ä¿å­˜è¿™ä¸¤ä¸ªæ•°æ®ï¼Œcommitmentä¹‹åä¼šç”¨äºæå–å­˜å…¥çš„èµ„é‡‘ã€‚&lt;/p&gt;
&lt;p&gt;åŒæ—¶ï¼Œç”¨æˆ·ä¼šå¾—åˆ°ä¸€ä¸ªå‡­è¯ï¼Œé€šè¿‡è¿™ä¸ªå‡­è¯ï¼Œç”¨æˆ·ï¼ˆæˆ–è€…ä»»ä½•äººï¼‰å°±å¯ä»¥æå–å­˜å…¥çš„èµ„é‡‘ã€‚&lt;/p&gt;
&lt;h3&gt;ä¸ºä»€ä¹ˆå­˜å…¥ 1 ETHï¼Ÿ&lt;/h3&gt;
&lt;p&gt;å¦‚æœä¸åŒçš„ç”¨æˆ·ä¼šå­˜å…¥ä¸åŒçš„é‡‘é¢ï¼Œæ¯”å¦‚ Alice å’Œ Bob å­˜å…¥ 1 ETHï¼ŒChris å­˜å…¥ 73 ETHï¼Œå½“å–å‡ºå­˜æ¬¾æ—¶ï¼ŒæŸä¸ªåœ°å€æå–äº† 73 ETHï¼Œæˆ‘ä»¬ä¼šæœ‰å¾ˆå¤§ç¨‹åº¦æ€€ç–‘è¿™ä¸ªåœ°å€å±äº Chrisã€‚å› æ­¤ï¼Œåœ¨TC åˆçº¦ä¸­è§„å®šäº†æ¯æ¬¡å­˜å…¥çš„é‡‘é¢ä¸º 1 ETHï¼Œè¿™æ ·å°±ä¸ä¼šæœ‰åœ°å€ä¸å…¶ä»–åœ°å€ä¸ä¸€è‡´ã€‚&lt;/p&gt;
&lt;p&gt;å®é™…ä¸Šï¼ŒTC æœ‰ä¸åŒé‡‘é¢çš„ ETH å­˜æ¬¾æ± ï¼Œåˆ†åˆ«ä¸º 0.1ï¼Œ1ï¼Œ10ï¼Œ100ï¼Œä»¥æ»¡è¶³ä¸åŒæ•°é‡çš„å­˜å–æ¬¾éœ€æ±‚ã€‚&lt;/p&gt;
&lt;h2&gt;å–æ¬¾ï¼ˆwithdrawï¼‰è¿‡ç¨‹&lt;/h2&gt;
&lt;p&gt;å½“è¿›è¡Œå–æ¬¾æ—¶ï¼Œä¸€ç§é”™è¯¯æ–¹æ³•æ˜¯å°†ä¹‹å‰éšæœºç”Ÿæˆçš„ secret å’Œ nullifier ä½œä¸ºå‚æ•°å‘é€ç»™åˆçº¦çš„å–æ¬¾å‡½æ•°ï¼Œåˆçº¦æ£€æŸ¥ hash(secret,nullifier) æ˜¯å¦ç­‰äºä¹‹å‰ä¿å­˜çš„ commitmentï¼Œå¦‚æœç›¸ç­‰å°±å‘é€ 1 ETHç»™å–æ¬¾è€…ã€‚ä½†æ˜¯è¿™ä¸ªè¿‡ç¨‹å°±ä½¿å¾—å–æ¬¾è€…çš„èº«ä»½æš´éœ²äº†ï¼Œå› ä¸º hash è¿‡ç¨‹æ˜¯ä¸å¯é€†çš„ï¼Œå½“æˆ‘ä»¬ä»å­˜æ¬¾æ—¥å¿—ä¸­æ‰¾åˆ°ç›¸ç­‰çš„commitmentæ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ commitment å»ºç«‹å­˜æ¬¾è€…å’Œå–æ¬¾è€…ä¹‹é—´çš„è”ç³»ï¼Œå› ä¸ºåªæœ‰è¿™ä¸ªå­˜æ¬¾è€…çŸ¥é“è·å¾— commitment çš„ secret å’Œ nullifierã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœè§£å†³è¿™ä¸ªè¿‡ç¨‹å‘¢ï¼Ÿå¦‚æœæœ‰äººæœ‰ä¸€ç§æ–¹æ³•å¯ä»¥è¯æ˜ä»–çŸ¥é“ä¸€ç»„(secret, nullifier) ä½¿å¾— hash(secret, nullifier) åœ¨åˆçº¦è®°å½•çš„commitmentåˆ—è¡¨ä¸­ï¼Œä½†æ˜¯å´ä¸å…¬å¼€è¿™ç»„(secret, nullifier) ï¼Œé‚£è¿™ä¸ªäººå°±å¯ä»¥åªç”¨å‘é€è¿™ä¸ªè¯æ˜ç»™åˆçº¦è¿›è¡ŒéªŒè¯ï¼Œå°±å¯ä»¥è¯æ˜ä»–æ‹¥æœ‰ä¹‹å‰å­˜å…¥è¿‡èµ„é‡‘ï¼Œå½“å´ä¸çŸ¥é“å¯¹åº”äºå“ªä¸€ç»„å­˜å…¥çš„èµ„é‡‘ï¼Œæ‰€ä»¥ä»ç„¶ä¿æŒåŒ¿åã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªè¯æ˜å°±æ˜¯é›¶çŸ¥è¯†è¯æ˜ï¼Œå®ƒå¯ä»¥è¯æ˜ä½ çŸ¥é“æŸä¸ªä¿¡æ¯ä½†å´ä¸ç”¨å…¬å¼€è¿™ä¸ªä¿¡æ¯ã€‚TC ä½¿ç”¨çš„é›¶çŸ¥è¯†è¯æ˜ç§°ä¸º zk-SNARKã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬æ³¨æ„åˆ°å½“ç”¨æˆ·å­˜æ¬¾å’Œå–æ¬¾æ—¶ï¼Œä½¿ç”¨äº†ä¸¤ä¸ªéšæœºæ•° secret å’Œ nullifierï¼Œnullifier çš„ä½œç”¨æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå½“ç”¨æˆ·å–æ¬¾æ—¶ï¼Œåˆçº¦å…¶å®ä¸çŸ¥é“åˆ°åº•æ˜¯è°åœ¨å–æ¬¾ï¼Œä¸ºäº†é¿å…ç”¨æˆ·å­˜å…¥ 1 ETH ç„¶åè¿›è¡Œå¤šæ¬¡æå–ï¼ŒTCè¦æ±‚å½“ç”¨æˆ·å‘é€è¯æ˜çš„åŒæ—¶å‘é€ nullifier çš„å“ˆå¸ŒnullifierHashï¼Œåœ¨zk-SNARKçš„è¯æ˜ä¸­ï¼Œä»–ä¼šæ£€æŸ¥ä¸¤ä»¶äº‹æƒ…ï¼šä¸€æ˜¯æ£€æŸ¥ hash(secret, nullifier) åœ¨ commitment çš„åˆ—è¡¨ä¸­ï¼ŒäºŒæ˜¯ nullifierHash ç­‰äº hash(nullifier)ï¼Œä¸€æ—¦éªŒè¯æˆåŠŸï¼Œåˆçº¦å°±ä¼šè®°å½•è¿™ä¸ªå“ˆå¸Œã€‚å½“åŒä¸€ä¸ªè¯æ˜ç¬¬äºŒæ¬¡è¢«æäº¤æ—¶å°±ä¼šå¤±è´¥ï¼Œå› ä¸ºå¯¹åº”çš„ nullifier å“ˆå¸Œå·²ç»ä½¿ç”¨è¿‡äº†ï¼Œè¿™æ ·å°±é¿å…äº†äºŒæ¬¡ææ¬¾ã€‚&lt;/p&gt;
&lt;h3&gt;Tornado Cash å¦‚ä½•ä¿å­˜ commitment å‘¢&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨ Merkle æ ‘ã€‚Merkleæ ‘å…·ä½“å‚è§ä¹‹å‰çš„ä»‹ç»æ–‡ç« ã€‚&lt;/p&gt;
&lt;p&gt;TC ä¼šé¦–å…ˆåˆå§‹åŒ–ä¸€ç»„å¶å­èŠ‚ç‚¹ä¸º &lt;code&gt;keccak256(&amp;quot;tornado&amp;quot;)&lt;/code&gt;ï¼Œå¹¶ä»¥è¿™äº›å¶å­èŠ‚ç‚¹æ„å»ºä¸€é¢— Merkle æ ‘ã€‚å½“ç”¨æˆ·å­˜æ¬¾æ—¶ï¼Œå¯¹åº”çš„ commitment å­˜å…¥ Merkle æ ‘çš„ç¬¬ä¸€ä¸ªå¶å­èŠ‚ç‚¹ï¼Œç„¶ååˆçº¦æ›´æ–°æ•´æ£µ Merkle æ ‘ï¼Œç„¶åæ˜¯ç¬¬äºŒä¸ªç”¨æˆ·çš„commitment å­˜å…¥ç¬¬äºŒä¸ªå¶å­èŠ‚ç‚¹å¹¶æ›´æ–°æ•´æ£µ Merkle æ ‘ï¼Œä¾æ¬¡ç±»æ¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src="https://user-images.githubusercontent.com/3297411/188539564-5178bafe-dd46-4409-8de5-fdcc194e88e4.png" alt="Untitled" /&gt;&lt;/p&gt;
&lt;p&gt;å¦‚ä½•è¯æ˜ commitment åœ¨è¿™æ£µ Merkle æ ‘ä¸­å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;&lt;img src="https://user-images.githubusercontent.com/3297411/188539594-233fbff1-9cc8-43c9-99a2-86a7045f3efe.png" alt="Untitled 1" /&gt;&lt;/p&gt;
&lt;p&gt;å‡è®¾éœ€è¦è¯æ˜c3åœ¨è¿™æ£µMerkelä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä»å¶å­èŠ‚ç‚¹ c3 åˆ°æ ¹çš„è·¯å¾„è¿‡ç¨‹ä¸­çš„å“ˆå¸Œï¼Œä½¿å¾—ä»–ä»¬ä¸ c3 ä¾æ¬¡è¿›è¡Œ hash å¯ä»¥å¾—åˆ°æ ¹å“ˆå¸Œï¼Œå³å›¾ä¸­ç»¿è‰²èŠ‚ç‚¹çš„å“ˆå¸Œåˆ—è¡¨ã€‚&lt;/p&gt;
&lt;p&gt;Tornado Cash ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æä¾›è¿™äº›èŠ‚ç‚¹å“ˆå¸Œï¼Œå¹¶é€šè¿‡ zk-SNARK ç”Ÿæˆé›¶çŸ¥è¯†è¯æ˜ï¼Œä»¥æ­¤è¯æ˜ c3 åœ¨è¿™æ£µä»¥ rootï¼ˆ&lt;code&gt;=h(h(h(c0,c1),h(c2,c3)),h(h(c4,c5), z1))&lt;/code&gt;ï¼‰ä¸ºæ ¹çš„ Merkle ä¸­ï¼Œä½†å´ä¸ç”¨å‘Šè¯‰å¤§å®¶ c3 çš„å€¼ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src="https://user-images.githubusercontent.com/3297411/188539613-fe0ccd14-c7e7-4143-847a-e71d3b475e1f.png" alt="Untitled 2" /&gt;&lt;/p&gt;
&lt;p&gt;å› æ­¤æˆ‘ä»¬å°†è¯æ˜ proof å’Œ Merkle æ ‘æ ¹ root å‘é€ç»™åˆçº¦ï¼Œä¸€æ—¦åˆçº¦éªŒè¯æˆåŠŸï¼Œæˆ‘ä»¬å°±å¯ä»¥å–å‡ºä¹‹å‰å­˜å…¥çš„å­˜æ¬¾ã€‚&lt;/p&gt;
&lt;h2&gt;solidity ä¸­çš„ zk-SNARK å®ç°&lt;/h2&gt;
&lt;p&gt;TC åˆçº¦åŒ…å«ä¸‰ä¸ªéƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å­˜æ¬¾å’Œå–æ¬¾åˆçº¦ï¼Œç”¨äºä¸ç”¨æˆ·äº¤äº’ï¼›&lt;/li&gt;
&lt;li&gt;Merkle æ ‘ï¼Œç”¨äºè®°å½•å­˜æ¬¾å“ˆå¸Œï¼›&lt;/li&gt;
&lt;li&gt;zk-SNARK éªŒè¯å™¨åˆçº¦ï¼Œç”¨äºéªŒè¯å–æ¬¾æ—¶è¯æ˜åˆæ³•ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;zk-SNARK éªŒè¯å™¨åˆçº¦ç”± circom ç¼–å†™çš„éªŒè¯ç”µè·¯é€šè¿‡ snarkjs åº“ç”Ÿæˆã€‚&lt;/p&gt;
&lt;h2&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.youtube.com/watch?v=z_cRicXX1jI"&gt;Tornado Cash - How it Works | DeFi + Zero Knowledge Proof&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href="https://github.com/qiwihui/blog/issues/164"&gt;View on GitHub&lt;/a&gt;&lt;/p&gt;
</content></entry></feed>